<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>前中台解决方案项目（上） | IZDLOYL's Blog</title><meta name="author" content="IZDLOYL"><meta name="copyright" content="IZDLOYL"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="基于 Vue3打造前台+中台通用提效解决方案1、项目架构本项目使用vite + vue3来实现前中台解决方案 2、vite 的使用vite对比webpackwebpack  webpack在开发时构建时，默认会去抓取并构建整个应用，然后才能提供服务，这就导致你的项目中，存在的任何一个错误（哪怕这个错误是在用户从来都没有进入过的页面中出现的)，它依然会影响到你的整个项目构建。因此，当项目越大时，构建">
<meta property="og:type" content="article">
<meta property="og:title" content="前中台解决方案项目（上）">
<meta property="og:url" content="http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8A%EF%BC%89/index.html">
<meta property="og:site_name" content="IZDLOYL&#39;s Blog">
<meta property="og:description" content="基于 Vue3打造前台+中台通用提效解决方案1、项目架构本项目使用vite + vue3来实现前中台解决方案 2、vite 的使用vite对比webpackwebpack  webpack在开发时构建时，默认会去抓取并构建整个应用，然后才能提供服务，这就导致你的项目中，存在的任何一个错误（哪怕这个错误是在用户从来都没有进入过的页面中出现的)，它依然会影响到你的整个项目构建。因此，当项目越大时，构建">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://source.fomal.cc/img/default_cover_4.webp">
<meta property="article:published_time" content="2024-08-19T06:41:18.462Z">
<meta property="article:modified_time" content="2024-08-26T08:54:20.048Z">
<meta property="article:author" content="IZDLOYL">
<meta property="article:tag" content="vue3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://source.fomal.cc/img/default_cover_4.webp"><link rel="shortcut icon" href="/gallery/favicon.jpg"><link rel="canonical" href="http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8A%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '前中台解决方案项目（上）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-26 16:54:20'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://source.fomal.cc/img/default_cover_4.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="IZDLOYL's Blog"><span class="site-name">IZDLOYL's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">前中台解决方案项目（上）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-19T06:41:18.462Z" title="发表于 2024-08-19 14:41:18">2024-08-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-26T08:54:20.048Z" title="更新于 2024-08-26 16:54:20">2024-08-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">27.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>126分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="前中台解决方案项目（上）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="基于-Vue3打造前台-中台通用提效解决方案"><a href="#基于-Vue3打造前台-中台通用提效解决方案" class="headerlink" title="基于 Vue3打造前台+中台通用提效解决方案"></a>基于 Vue3打造前台+中台通用提效解决方案</h2><h3 id="1、项目架构"><a href="#1、项目架构" class="headerlink" title="1、项目架构"></a>1、项目架构</h3><p>本项目使用<code>vite</code> + <code>vue3</code>来实现前中台解决方案</p>
<h3 id="2、vite-的使用"><a href="#2、vite-的使用" class="headerlink" title="2、vite 的使用"></a>2、<code>vite</code> 的使用</h3><h4 id="vite对比webpack"><a href="#vite对比webpack" class="headerlink" title="vite对比webpack"></a>vite对比webpack</h4><p><strong>webpack</strong></p>
<blockquote>
<p><code>webpack</code>在开发时构建时，默认会去抓取并构建整个应用，然后才能提供服务，这就导致你的项目中，存在的任何一个错误（哪怕这个错误是在用户从来都没有进入过的页面中出现的)，它依然会影响到你的整个项目构建。<br>因此，当项目越大时，构建的时间就会越长，项目启动速度也就会越慢。</p>
</blockquote>
<p><strong>vite</strong></p>
<blockquote>
<p>vite 不会在一开始就构建你的整个项目，而是会将应用中的模块区分为依赖和源码（项目代码)两部分，对于源码部分，它会根据路由来拆分代码模块，只会去构建一开始就必须要构建的内容。<br>同时 vite以原生 ESM 的方式为浏览器提供源码，让浏览器接管了打包的部分工作。<br>因为这样的一个机制，无论项目多大，它只会构建一开始必须要构建的内容，这就让 vite在构建时的速度大大提升了。</p>
</blockquote>
<h4 id="vite缺点"><a href="#vite缺点" class="headerlink" title="vite缺点"></a><code>vite</code>缺点</h4><p><strong><code>vite</code>既然以原生<code>ESM</code>的方式为浏览器提供源码，让浏览器接管了打包的部分工作</strong>，</p>
<p>那么假如项目中存在 <code>cormmonJS</code>的内容怎么办?是不是就意味着无法解析呢?      是的!<br>在 <code>vite</code> 的早期版本中，确实存在这个问题。比如<code>axios</code> 因为 <code>axios</code> 中使用了很多的 <code>commonJS</code>规范，这就让 <code>vite</code> 无法解析对应的内容(对应的 <code>ieeue</code>),从而会抛出一个错误。</p>
<h4 id="官方是如何解决的"><a href="#官方是如何解决的" class="headerlink" title="官方是如何解决的"></a>官方是如何解决的</h4><p>针对于这个问题, <code>vite</code>在后期提供了依赖预构建的功能。 <code>vite</code> 会先将<code>CommonJS</code>或 <code>UMD</code>发布的依赖项转换为<code>ESM</code>之后，再重新进行编译。可以理解为速度对业务的一个妥协。</p>
<h3 id="3、初始化项目"><a href="#3、初始化项目" class="headerlink" title="3、初始化项目"></a>3、初始化项目</h3><ul>
<li><p>1、全局安装<code>vite</code> 版本2.8.5</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm install <span class="literal">-g</span> vite@<span class="number">2.8</span>.<span class="number">5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>2、使用<code>vite</code>创建项目</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm init vite@latest</span><br><span class="line"><span class="comment"># npx: installed 6 in 2.285s</span></span><br><span class="line"><span class="comment"># √ Project name: ... front</span></span><br><span class="line"><span class="comment"># √ Select a framework: » vue</span></span><br><span class="line"><span class="comment"># √ Select a variant: » vue</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>3、运行项目</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="variable">$</span> npm run dev</span><br><span class="line"></span><br><span class="line">![<span class="type">image</span>-<span class="number">20220816094012941</span>](https://izdloyl<span class="literal">-blog</span>.oss<span class="literal">-cn-hangzhou</span>.aliyuncs.com/<span class="number">202408191455230</span>.jpg) </span><br><span class="line"></span><br><span class="line">可以看到，项目已经启动，但是没有 `network`地址；我们需要手动配置下</span><br><span class="line"></span><br><span class="line">package.json</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line"> <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vite --host&quot;</span>, // dev后面 加上 <span class="literal">--host</span></span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vite build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preview&quot;</span>: <span class="string">&quot;vite preview&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4、tailwindcss工具"><a href="#4、tailwindcss工具" class="headerlink" title="4、tailwindcss工具"></a>4、tailwindcss工具</h3><h4 id="传统开发css痛点"><a href="#传统开发css痛点" class="headerlink" title="传统开发css痛点"></a>传统开发<code>css</code>痛点</h4><p>针对于一些”复杂”的功能，比如响应式（媒体查询)、主题定制。如果我们想要通过传统的 html + css 的形式来进行实现，无疑是非常复杂的。</p>
<p>除了上面提到的这些之外，还有很多其他的问题，感兴趣的同学可以看一下这篇文章的介绍CSS Utility Classes and “Separation of Concerns”<br>总而言之，传统的 html + css 的模式存在着很多的问题，tailwindcss就是一个很好地解决方向。</p>
<h4 id="安装tailwindcss"><a href="#安装tailwindcss" class="headerlink" title="安装tailwindcss"></a>安装tailwindcss</h4><p>1、安装依赖</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm install <span class="literal">-D</span> tailwindcss@<span class="number">3.0</span>.<span class="number">23</span> postcss@<span class="number">8.4</span>.<span class="number">8</span> autoprefixer@<span class="number">10.4</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>2、创建配置文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npx tailwindcss init <span class="literal">-p</span></span><br><span class="line"><span class="comment"># 执行当前命令生配置文件</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 表示tailwindcss的作用范围 [src下所有目录下的所有vue/js文件， 当前index.html文件]</span></span><br><span class="line">  <span class="attr">content</span>: [<span class="string">&quot;./index.html&quot;</span>, <span class="string">&quot;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&quot;</span>,],  </span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、导入<code>tailwindcss</code>的基础指令组件</p>
<p>创建<code>src/styles/index.scss</code>文件</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入`tailwindcss`的基础指令组件</span></span><br><span class="line"><span class="keyword">@tailwind</span> base;</span><br><span class="line"><span class="keyword">@tailwind</span> components;</span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure>
<p>4、在项目的入口文件、<code>main.js</code>中引入<code>src/styles/index,scss</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./style.css&#x27;</span></span><br><span class="line">+ <span class="keyword">import</span> <span class="string">&#x27;./styles/index.scss&#x27;</span></span><br></pre></td></tr></table></figure>
<p>保存之后，运行后，会报没有<code>sass</code>依赖包的错误，所以我们需要手动安装一下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191455161.jpg" alt="image-20220816105339932"> </p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm install <span class="literal">-D</span> sass</span><br></pre></td></tr></table></figure>
<p>重启即可</p>
<blockquote>
<p>如果postcss报错的话，可以将package.json中 “type”: “module”删除掉</p>
</blockquote>
<h3 id="5、项目结构分析"><a href="#5、项目结构分析" class="headerlink" title="5、项目结构分析"></a>5、项目结构分析</h3><p>​    项目分为<strong>移动端</strong>和<strong>PC端</strong>，通过同一套代码进行实现，也就是所谓的响应式构建方案。</p>
<h4 id="移动端结构分析"><a href="#移动端结构分析" class="headerlink" title="移动端结构分析"></a>移动端结构分析</h4><p>移动端的结构相对比较简单，当我们去进行路由跳转时，它是以整个页面进行的整体路由切换。<br>那么由此可知，移动端不存在嵌套路由的概念，只需要在 APP.vue 中保留一个路由出口即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191455355.jpg" alt="image-20220816154619643"> </p>
<h4 id="PC端结构分析"><a href="#PC端结构分析" class="headerlink" title="PC端结构分析"></a>PC端结构分析</h4><p>pc端相对于移动端、多了一个固定头部的部分，所以处理起来更加复杂一点</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191455218.jpg" alt="image-20220816154910365"></p>
<p>我们需要通过两个路由出口进行表示:</p>
<ol>
<li><p><code>App.vue</code> ：一级路由出口，用作整页路由切换</p>
</li>
<li><p><code>Main.vue</code> ：二级路由出口，用作局部路由切换</p>
<p>  移动端和PC端两者的路由结构是不同的，所以<strong>需要根据当前用户所在设备的不同，构建不同的路由表</strong></p>
</li>
</ol>
<h3 id="6、项目结构"><a href="#6、项目结构" class="headerlink" title="6、项目结构"></a>6、项目结构</h3><p>首先，项目中使用了<code>vuex</code>和<code>vue-router</code>；进行安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add vuex@4.0.2 vue-router@4.0.14</span><br></pre></td></tr></table></figure>
<p>项目的整体结构如下图所示</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191455647.jpg" alt="image-20220816160615099"></p>
<h3 id="7、企业级vite配置方案"><a href="#7、企业级vite配置方案" class="headerlink" title="7、企业级vite配置方案"></a>7、企业级vite配置方案</h3><h4 id="封装判断是否是移动端方法"><a href="#封装判断是否是移动端方法" class="headerlink" title="封装判断是否是移动端方法"></a>封装判断是否是移动端方法</h4><p>​    由于<code>tailwindcss</code>是遵循移动端优先的，所以在构建项目时，遵循<strong>移动端优先</strong>的规则</p>
<p>我们规定、屏幕宽度大于或等于1280像素的为pc端，小于1280像素的为移动端</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">PC_DEVICE_WIDTH</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是移动端设备； 判断依据： 屏幕宽度小于 PC_DEVICE_WIDTH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMoboleTerminal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>, <span class="variable constant_">PC_DEVICE_WIDTH</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span> &lt; <span class="variable constant_">PC_DEVICE_WIDTH</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上面封装的方法有缺陷：当页面尺寸发生变化时，<code>isMoboleTerminal</code>的值并不会发生响应式改变；</p>
<p>这是因为<code>computed</code>重新执行的条件是，内部的响应式数据发生变化<code>computed</code>才会执行；</p>
<p>而此时内部没有响应式数据，所以并不会重新执行；所以我们可以监听屏幕的尺寸变化，并设置响应式宽度</p>
<p>使用第三方插件：<a target="_blank" rel="noopener" href="https://vueuse.org/guide/">VueUse</a> 这个插件就像<code>react hook</code>一样，提供响应式数据。</p>
<ul>
<li><p>1、首先安装<code>vueuse</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm i @vueuse/core</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、重构<code>isMoboleTerminal</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">PC_DEVICE_WIDTH</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useWindowSize &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123; width &#125; = <span class="title function_">useWindowSize</span>()</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否是移动端设备； 判断依据： 屏幕宽度小于 PC_DEVICE_WIDTH</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMoboleTerminal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> width.<span class="property">value</span> &lt; <span class="variable constant_">PC_DEVICE_WIDTH</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="配置路由、判断当前是移动端还是pc端加载对应的路由"><a href="#配置路由、判断当前是移动端还是pc端加载对应的路由" class="headerlink" title="配置路由、判断当前是移动端还是pc端加载对应的路由"></a>配置路由、判断当前是移动端还是pc端加载对应的路由</h4>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; isMoboleTerminal &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/flexible&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mobileRoutes <span class="keyword">from</span> <span class="string">&#x27;./modules/mobile-routes&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pcRoutes <span class="keyword">from</span> <span class="string">&#x27;./modules/pc-routes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">  <span class="attr">routes</span>: isMoboleTerminal.<span class="property">value</span> ? mobileRoutes : pcRoutes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<h3 id="8、vite中的一些配置"><a href="#8、vite中的一些配置" class="headerlink" title="8、vite中的一些配置"></a>8、vite中的一些配置</h3><h4 id="符号代理src路径"><a href="#符号代理src路径" class="headerlink" title="@符号代理src路径"></a>@符号代理src路径</h4><p> vite官方给出来了，解决方案：<a target="_blank" rel="noopener" href="https://vitejs.cn/config/#resolve-alias">resolve.alias</a></p>
<p>  vite.config.js</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: <span class="title function_">join</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="开发环境下跨域代理"><a href="#开发环境下跨域代理" class="headerlink" title="开发环境下跨域代理"></a>开发环境下跨域代理</h4><p> vite官方给出来了，解决方案：<a target="_blank" rel="noopener" href="https://vitejs.cn/config/#server-proxy">server.proxy</a></p>
<p>  vite.config.js</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">      <span class="attr">proxy</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;/prod-api&#x27;</span>: &#123;</span><br><span class="line">          <span class="attr">target</span>: <span class="string">&#x27; http://localhost:3000&#x27;</span>,</span><br><span class="line">          <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="9、动态设置rem并修改tailmindcss默认配置"><a href="#9、动态设置rem并修改tailmindcss默认配置" class="headerlink" title="9、动态设置rem并修改tailmindcss默认配置"></a>9、动态设置rem并修改tailmindcss默认配置</h3><p>因为我们做的页面需要在不同设备下使用、要想在不同设备下适用；这里移动端我们采用的是<strong>flex+rem</strong>布局的方式：</p>
<p>首先我们先实现下rem布局</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首次加载成功时设置html跟标签的fontSize属性值；最大基准值为40px</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useREM</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">MAX_FONT_SIZE</span> = <span class="number">40</span></span><br><span class="line">  <span class="comment">// 当文档被解析成功时调用</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> html = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>)</span><br><span class="line">    <span class="comment">// 设置屏幕基准值的标准为 屏幕的宽度 / 10</span></span><br><span class="line">    <span class="keyword">const</span> fontSize = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="number">10</span></span><br><span class="line">    html.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="title class_">Math</span>.<span class="title function_">min</span>(fontSize, <span class="variable constant_">MAX_FONT_SIZE</span>) + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在mian.js中引入并调用<code>useREM</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useREM &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/flexible&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useREM</span>()</span><br></pre></td></tr></table></figure>
<p>测试发现：<strong>字体非常大，不符合我们的预期；如下图</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191456703.jpg" alt="image-20220820094254567"> </p>
<p>解决办法： <strong>tailwindcss提供了配置文件，可以在配置文件中自定义一些样式</strong></p>
<p>在<code>tailwind.config.js</code>中进行<code>theme.extend</code>配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">content</span>: [<span class="string">&#x27;./index.html&#x27;</span>, <span class="string">&#x27;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&#x27;</span>],</span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">extend</span>: &#123;</span><br><span class="line">      <span class="attr">fontSize</span>: &#123;</span><br><span class="line">        <span class="attr">xs</span>: [<span class="string">&#x27;0.25rem&#x27;</span>, &#123; <span class="attr">lineHeight</span>: <span class="string">&#x27;0.35rem&#x27;</span> &#125;],</span><br><span class="line">        <span class="attr">sm</span>: [<span class="string">&#x27;0.35rem&#x27;</span>, &#123; <span class="attr">lineHeight</span>: <span class="string">&#x27;0.45rem&#x27;</span> &#125;],</span><br><span class="line">        <span class="attr">base</span>: [<span class="string">&#x27;0.45rem&#x27;</span>, &#123; <span class="attr">lineHeight</span>: <span class="string">&#x27;0.55rem&#x27;</span> &#125;],</span><br><span class="line">        <span class="attr">lg</span>: [<span class="string">&#x27;0.55rem&#x27;</span>, &#123; <span class="attr">lineHeight</span>: <span class="string">&#x27;0.65rem&#x27;</span> &#125;],</span><br><span class="line">        <span class="attr">xl</span>: [<span class="string">&#x27;0.65rem&#x27;</span>, &#123; <span class="attr">lineHeight</span>: <span class="string">&#x27;0.75rem&#x27;</span> &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">boxShadow</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;l-white&#x27;</span>: <span class="string">&#x27;-10px 0 10px white&#x27;</span> <span class="comment">// 自定义类名样式 使用时 shadow-l-white</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191456132.jpg" alt="image-20220820095829409"> </p>
<h3 id="10、封装通用的svg-icon"><a href="#10、封装通用的svg-icon" class="headerlink" title="10、封装通用的svg-icon"></a>10、封装通用的svg-icon</h3><p>先看一下文件目录</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191456266.jpg" alt="image-20220820110904744"> </p>
<ul>
<li><p>1、封装<code>svg-icon</code>通用组件<code>libs/svg-icon/index.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;svg aria-hidden=&quot;true&quot;&gt;</span><br><span class="line">    &lt;use :xlink:href=&quot;symbolId&quot; :fill=&quot;color&quot; :class=&quot;fillClass&quot; /&gt;</span><br><span class="line">  &lt;/svg&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  // 图标名称</span><br><span class="line">  name: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;,</span><br><span class="line">  // 颜色</span><br><span class="line">  color: &#123;</span><br><span class="line">    type: String</span><br><span class="line">  &#125;,</span><br><span class="line">  // 类名</span><br><span class="line">  fillClass: &#123;</span><br><span class="line">    type: String</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 生成图标唯一id #icon-xxx</span><br><span class="line">const symbolId = computed(() =&gt; `#icon-$&#123;props.name&#125;`)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>2、导出注册组件对象 <code>libs/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">SvgIcon</span> <span class="keyword">from</span> <span class="string">&#x27;./svg-icon/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出对象、这个对象有install方法，这样既可以通过app.use(options)来使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;svg-icon&#x27;</span>, <span class="title class_">SvgIcon</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>3、在<code>mian.js</code>中注册组件对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libs <span class="keyword">from</span> <span class="string">&#x27;@/libs&#x27;</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">use</span>(libs).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>4、安装<code>vite-plugin-svg-icons</code>插件，并配置vite</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> yarn add vite<span class="literal">-plugin-svg-icons</span> <span class="literal">-D</span></span><br></pre></td></tr></table></figure>
<p>vite.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSvgIconsPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-svg-icons&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="comment">// svg配置</span></span><br><span class="line">    <span class="title function_">createSvgIconsPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 指定需要缓存的图标文件夹</span></span><br><span class="line">      <span class="attr">iconDirs</span>: [path.<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), <span class="string">&#x27;src/assets/icons&#x27;</span>)],</span><br><span class="line">      <span class="comment">// 指定symbolId格式</span></span><br><span class="line">      <span class="attr">symbolId</span>: <span class="string">&#x27;icon-[name]&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>5、在<code>main.js</code>中注册 <code>import &#39;virtual:svg-icons-register&#39;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> libs <span class="keyword">from</span> <span class="string">&#x27;@/libs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;virtual:svg-icons-register&#x27;</span> <span class="comment">// 为固定格式</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">use</span>(libs).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>6、在组件中使用svg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg-icon</span><br><span class="line">    name=&quot;hamburger&quot;</span><br><span class="line">    class=&quot;px-1 w-4 h-4 fixed top-0 right-[-2px] z-20 shadow-l-white bg-white&quot;</span><br><span class="line">  /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191456309.jpg" alt="image-20220820111656263"> </p>
<h3 id="11、移动端navigation头部效果"><a href="#11、移动端navigation头部效果" class="headerlink" title="11、移动端navigation头部效果"></a>11、移动端navigation头部效果</h3><p>需要实现的效果如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191456764.gif" alt="20220820_144232"> </p>
<p><strong>实现思路：</strong>1. 选中的item下标: currentCategoryIndex</p>
<pre><code>       2. 所有item 元素: itemRefs
       3. ul 的横向滚动偏离位置: ulScrollLeft
       4. 最后在 currentCategoryIndex 发生改变时，获取 item 下标元素的 left 和 width，计算             sliderStyle 即可
</code></pre><ul>
<li>1、滑块绝对定位动态改变滑块的 <code>left</code> 和 <code>width</code>值, 来改变滑块的位置</li>
<li>2、left值计算公式： 滚动x距离 + 点击元素距离屏幕左边的距离</li>
<li>3、width值计算公式： 点击元素的宽度</li>
</ul>
<p><strong>实现细节：</strong></p>
<ul>
<li><p>对于获取<code>v-for</code>生成的子元素的实例，需要使用回调函数获取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul ref=&quot;ulEle&quot;&gt;</span><br><span class="line">    &lt;li v-for=&quot;item in data&quot; :ref=&quot;getEleFn&quot;&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">    import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">    // 获取普通元素的实例，可以使用ref(null）获取</span><br><span class="line">    const ulEle = ref(null)</span><br><span class="line">    //对于获取`v-for`生成的子元素的实例，需要使用回调函数获取</span><br><span class="line">	const getEleFn = (el) =&gt; &#123;</span><br><span class="line">        console.log(el)</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在初始化时，我们需要在li元素渲染完成之后触发一下重新设置一下滑块绝对定位动态改变滑块的 <code>left</code> 和 <code>width</code>值；我们可以监听渲染list的响应式数据是否改变，并且在改变后通过<code>nextTick</code>触发设置选中第一个元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听data初次数据渲染之后，将slider条设置到第一项</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> props.<span class="property">data</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      curretIndex.<span class="property">value</span> = <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>完整实例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;bg-white sticky top-0 left-0 z-10&quot;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">      ref=&quot;ulTarget&quot;</span><br><span class="line">      class=&quot;relative flex overflow-x-auto p-1 text-xs text-zinc-600 overflow-hidden&quot; </span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 顶部分类导航条 - 右侧 汉堡按钮 --&gt;</span><br><span class="line">      &lt;li</span><br><span class="line">        class=&quot;fixed top-0 right-[-1px] h-4 px-1 flex items-center bg-white z-20 shadow-l-white&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon class=&quot;w-1.5 h-1.5&quot; name=&quot;hamburger&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">      &lt;!-- 顶部分类导航条 - 黑色滑块 --&gt;</span><br><span class="line">      &lt;li </span><br><span class="line">        ref=&quot;sliderTarget&quot;</span><br><span class="line">        :style=&quot;sliderStyle&quot;</span><br><span class="line">        class=&quot;absolute h-[22px] bg-zinc-900 rounded-lg duration-200&quot;</span><br><span class="line">      &gt;&lt;/li&gt;</span><br><span class="line">      &lt;!-- 顶部分类导航条 - item --&gt;</span><br><span class="line">      &lt;li </span><br><span class="line">        v-for=&quot;(item, index) in data&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">        class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">        :class=&quot;&#123;&#x27;text-zinc-100&#x27; : currentCategoryIndex === index&#125;&quot;</span><br><span class="line">        :ref=&quot;setItemRef&quot;</span><br><span class="line">        @click=&quot;onItemClick(index)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123; item.name &#125;&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onBeforeUpdate, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; useScroll &#125; from &#x27;@vueuse/core&#x27;;</span><br><span class="line"></span><br><span class="line">// vite 构建的项目中，可以直接使用 defineProps 方法</span><br><span class="line">defineProps(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        type: Array,</span><br><span class="line">        required: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 顶部分类导航条 - 黑色滑块</span><br><span class="line">const sliderStyle = ref(&#123;</span><br><span class="line">    transform: &#x27;translateX(0px)&#x27;,</span><br><span class="line">    width: &#x27;52px&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 1、选中的item下标</span><br><span class="line">const currentCategoryIndex = ref(0)</span><br><span class="line"></span><br><span class="line">// 2、获取所有item元素</span><br><span class="line">let itemRefs = []</span><br><span class="line">const setItemRef = (el) =&gt; &#123;</span><br><span class="line">    if(el) itemRefs.push(el)</span><br><span class="line">&#125;</span><br><span class="line">// 数据改变之后， DOM 变化之前</span><br><span class="line">onBeforeUpdate(() =&gt; &#123;</span><br><span class="line">  itemRefs = [] // 重置itemRefs，防止数据发生改变，就push，导致重复数据过多</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 3、获取 ul 元素，以计算 ul 与屏幕左侧的偏移距离</span><br><span class="line">const ulTarget = ref(null)</span><br><span class="line">// 通过Vueuse -&gt; useScroll 获取响应式的 scroll 滚动距离</span><br><span class="line">const &#123; x: ulScrollLeft &#125; = useScroll(ulTarget)</span><br><span class="line"></span><br><span class="line">// 4、监听 currentCategoryIndex 发生改变 -- 获取 item 下标元素的 left 和 width，计算sliderStyle</span><br><span class="line">watch(currentCategoryIndex, (val) =&gt; &#123;</span><br><span class="line">    // 获取选中元素的 left、width</span><br><span class="line">    const &#123; left, width &#125; = itemRefs[val].getBoundingClientRect()</span><br><span class="line">    // 为 sliderStyle 设置属性</span><br><span class="line">    sliderStyle.value = &#123;</span><br><span class="line">        // 滑块位置 = ul 横向滚动位置 + 当前元素的 left 偏移量 - ul的padding</span><br><span class="line">        // transform: `translateX($&#123;ulScrollLeft.value + left - 10 + &#x27;px&#x27;&#125;)`,</span><br><span class="line">        transform: `translateX($&#123;ulScrollLeft.value + left - 10&#125;px)`,</span><br><span class="line">        width: width + &#x27;px&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// item 点击事件</span><br><span class="line">const onItemClick = (index) =&gt; &#123;</span><br><span class="line">    currentCategoryIndex.value = index</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="12、封装通用组件-popup"><a href="#12、封装通用组件-popup" class="headerlink" title="12、封装通用组件  popup"></a>12、封装通用组件  popup</h3><p>​    当点击面包屑按钮时，会有一个弹出窗口 popup自低而上弹出    </p>
<p>​      （封装为项目的通用组件  -&gt;  实现功能）</p>
<p> popup组件的功能：</p>
<ul>
<li><p>1、当 popup展开时，内容视图应该不属于任何一个组件内部，而应该直接被插入到 body下面</p>
</li>
<li><p>2、popup应该包含两部分内容，一部分为背景蒙版，一部分为内容的包裹容器</p>
</li>
<li><p>3、popup应该通过一个双向绑定进行控制展示和隐藏</p>
</li>
<li><p>4、popup展示时，滚动（顶部导航条）应该被锁定</p>
</li>
<li><p>5、内容区域应该接收所有的$attrs，并且应该通过插槽让调用方指定其内容</p>
</li>
</ul>
<p>在<code>libs/popup/index.vue</code>中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Teleport to=&quot;body&quot;&gt;</span><br><span class="line">    &lt;Transition name=&quot;popup-mask&quot; mode=&quot;out-in&quot;&gt;</span><br><span class="line">      &lt;!-- 遮罩层 --&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&quot;</span><br><span class="line">        @click=&quot;emits(&#x27;update:modelValue&#x27;, false)&quot;</span><br><span class="line">        v-if=&quot;modelValue&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/Transition&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Transition name=&quot;popup-slide&quot; mode=&quot;out-in&quot;&gt;</span><br><span class="line">      &lt;!-- 内容区域 --&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;w-screen bg-white z-50 fixed bottom-0&quot;</span><br><span class="line">        v-bind=&quot;$attrs&quot;</span><br><span class="line">        v-if=&quot;modelValue&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Transition&gt;</span><br><span class="line">  &lt;/Teleport&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useScrollLock &#125; from &#x27;@vueuse/core&#x27;;</span><br><span class="line">import &#123; watch &#125; from &#x27;vue&#x27;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  modelValue: &#123;</span><br><span class="line">    required: true,</span><br><span class="line">    type: Boolean</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">const emits = defineEmits([&#x27;update:modelValue&#x27;])</span><br><span class="line">// 锁定滚动 - 遮罩层出现后，锁定滚动// 准备进入，离开完成</span><br><span class="line">const isLocked = useScrollLock(document.body)</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    isLocked.value = val</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    immediate: true</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang=&quot;scss&quot;&gt;</span><br><span class="line">.popup-mask-enter-from,</span><br><span class="line">.popup-mask-leave-to &#123;</span><br><span class="line">  opacity: 0; // 准备进入，离开完成</span><br><span class="line">&#125;</span><br><span class="line">.popup-mask-enter-active,</span><br><span class="line">.popup-mask-leave-active &#123;</span><br><span class="line">  transition: all 0.3s; // popup组件 mask(fade)动画</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.popup-slide-enter-from,</span><br><span class="line">.popup-slide-leave-to &#123;</span><br><span class="line">  transform: translateY(100%);</span><br><span class="line">&#125;</span><br><span class="line">.popup-slide-enter-active,</span><br><span class="line">.popup-slide-leave-active &#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="双向数据绑定功能优化"><a href="#双向数据绑定功能优化" class="headerlink" title="双向数据绑定功能优化"></a><strong>双向数据绑定功能优化</strong></h4><p>使用<code>useVModel</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Teleport to=&quot;body&quot;&gt;</span><br><span class="line">    &lt;Transition name=&quot;popup-mask&quot; mode=&quot;out-in&quot;&gt;</span><br><span class="line">      &lt;!-- 遮罩层 --&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&quot;</span><br><span class="line">        @click=&quot;isVisable = false&quot;</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/Transition&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Transition name=&quot;popup-slide&quot; mode=&quot;out-in&quot;&gt;</span><br><span class="line">      &lt;!-- 内容区域 --&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;w-screen bg-white z-50 fixed bottom-0&quot;</span><br><span class="line">        v-bind=&quot;$attrs&quot;</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 插槽 --&gt;</span><br><span class="line">        &lt;slot /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Transition&gt;</span><br><span class="line">  &lt;/Teleport&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useScrollLock, useVModel &#125; from &#x27;@vueuse/core&#x27;;</span><br><span class="line">import &#123; watch &#125; from &#x27;vue&#x27;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  modelValue: &#123;</span><br><span class="line">    required: true,</span><br><span class="line">    type: Boolean</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">defineEmits([&#x27;update:modelValue&#x27;])</span><br><span class="line">// 是一个响应式数据，当 isVisable 值发生变化时，会自动触发 emit 修改 modelValue</span><br><span class="line">const isVisable = useVModel(props)</span><br><span class="line"></span><br><span class="line">// 锁定滚动 - 遮罩层出现后，锁定滚动</span><br><span class="line">const isLocked = useScrollLock(document.body)</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; props.modelValue,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    isLocked.value = val</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    immediate: true</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="通用组件注册"><a href="#通用组件注册" class="headerlink" title="通用组件注册"></a><strong>通用组件注册</strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">SvgIcon</span> <span class="keyword">from</span> <span class="string">&#x27;./svg-icon/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Popup</span> <span class="keyword">from</span> <span class="string">&#x27;./popup/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出对象、这个对象有install方法，这样既可以通过app.use(options)来使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;svg-icon&#x27;</span>, <span class="title class_">SvgIcon</span>)</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;Popup&#x27;</span>, <span class="title class_">Popup</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>使用通用组件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-popup v-model=&quot;isOpenPopup&quot;&gt;</span><br><span class="line">     &lt;menu-vue @onItemClick=&quot;onItemClick&quot;&gt;&lt;/menu-vue&gt;</span><br><span class="line">&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191456412.gif" alt="20220820_172315"> </p>
<h4 id="将点击项展示在屏幕正中央，并加上过渡效果"><a href="#将点击项展示在屏幕正中央，并加上过渡效果" class="headerlink" title="将点击项展示在屏幕正中央，并加上过渡效果"></a>将点击项展示在屏幕正中央，并加上过渡效果</h4><p><strong>实现思路</strong></p>
<ul>
<li><p>1、在list菜单列表的数据发生改变后，获取每一项如果想要展示在中间需要滚动的距离</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">菜单展示中间需要向左滚动的距离l = 每一项距离屏幕左边的距离 - 1/2屏幕的宽度 + 1/2自身的宽度 </span><br></pre></td></tr></table></figure>
</li>
<li><p>2、在点击时获取【被点击项向左滚动的距离l】，使得ul平滑滚动到指定位置（本案例使用自定义封装的平滑滚动函数）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">scrollTransition</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">exec</span> (&#123;el = <span class="variable language_">document</span>.<span class="property">body</span>, position = <span class="number">0</span>, direction = <span class="string">&#x27;v&#x27;</span>,  time = <span class="number">150</span>&#125; = options) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">    <span class="comment">// 每步的时间 ms</span></span><br><span class="line">    <span class="keyword">const</span> <span class="variable constant_">TIME_EVERY_STEP</span> = <span class="number">5</span> </span><br><span class="line">    <span class="comment">// 最大滚动距离</span></span><br><span class="line">    <span class="keyword">const</span> maxScrollSize = el.<span class="property">scrollWidth</span> - el.<span class="property">offsetWidth</span></span><br><span class="line">    <span class="comment">// 限定position的有效滚动范围</span></span><br><span class="line">    position = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(position, maxScrollSize), <span class="number">0</span>)</span><br><span class="line">    <span class="comment">// 可以分为多少步</span></span><br><span class="line">    <span class="keyword">let</span> steps = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(time / <span class="variable constant_">TIME_EVERY_STEP</span>)</span><br><span class="line">    <span class="keyword">const</span> stepSize = (position - el.<span class="property">scrollLeft</span>) / steps <span class="comment">// 每步的长度</span></span><br><span class="line">    </span><br><span class="line">    timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(el.scrollLeft , position)</span></span><br><span class="line">      <span class="keyword">if</span> (el.<span class="property">scrollLeft</span> !== <span class="title class_">Number</span>.<span class="built_in">parseInt</span>(position) &amp;&amp; position &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stepSize &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> scrollX = el.<span class="property">scrollLeft</span> + stepSize &gt;= position ? position :  el.<span class="property">scrollLeft</span> + stepSize</span><br><span class="line">          el.<span class="property">scrollLeft</span> = scrollX</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> scrollX = el.<span class="property">scrollLeft</span> + stepSize &lt;= position ? position :  el.<span class="property">scrollLeft</span> + stepSize</span><br><span class="line">          el.<span class="property">scrollLeft</span> = scrollX</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="variable constant_">TIME_EVERY_STEP</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>3、我们来处理下滑块的位置，因为滑块的位置是根据被选中项的<code>getBoundingClientRect</code>的属性值决定的；所以我们只要保证，在滑块获取<code>getBoundingClientRect</code>属性是在页面渲染之后即可；所以我们可以使用nextTick保证在页面dom元素发生变化后改变滑块的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(curretIndex, <span class="function">(<span class="params">newIndex, oldIndex</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 保证渲染之后再进行计算元素的位置, 在这里加上nextTick</span></span><br><span class="line">  <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取点击元素的距离左边屏幕的距离和元素的宽度</span></span><br><span class="line">    <span class="keyword">const</span> liEle = <span class="title class_">Array</span>.<span class="title function_">from</span>(liEles.<span class="property">value</span>)[newIndex]</span><br><span class="line">    <span class="keyword">if</span> (!liEle) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> &#123; left, width &#125; = liEle.<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">    sliderStyle.<span class="property">value</span> = &#123;</span><br><span class="line">      <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;left + ulScrollLeft.value&#125;</span>px`</span>,</span><br><span class="line">      <span class="attr">width</span>: <span class="string">`<span class="subst">$&#123;width&#125;</span>px`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>实现代码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">class</span>=<span class="string">&quot;relative z-10 text-sm bg-white flex overflow-auto p-1 text-zinc-600&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">ref</span>=<span class="string">&quot;ulEle&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;absolute top-1 h-[22.5px] bg-zinc-900 rounded-lg duration-200 z-10&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:style</span>=<span class="string">&quot;sliderStyle&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-for</span>=<span class="string">&quot;(category, index) in data&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:key</span>=<span class="string">&quot;category.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;shrink-0 px-1.5 py-0.5 last:mr-6 z-10&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;text-zinc-50&#x27;: index === curretIndex &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">click</span>=<span class="string">&quot;handleSelectCategory(index)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:ref</span>=<span class="string">&quot;storeLiEle&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;&#123; category.name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">svg-icon</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">name</span>=<span class="string">&quot;hamburger&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">class</span>=<span class="string">&quot;px-1 w-4 h-4 fixed top-0 right-[-2px] z-20 shadow-l-white bg-white&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    @<span class="attr">click</span>=<span class="string">&quot;visible = true&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">popup</span> <span class="attr">v-model</span>=<span class="string">&quot;visible&quot;</span> <span class="attr">class</span>=<span class="string">&quot;aaa&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Menu</span> <span class="attr">:categorys</span>=<span class="string">&quot;data&quot;</span> @<span class="attr">handleSelectCategory</span>=<span class="string">&quot;handleSelectCategory&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">popup</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref, watch, nextTick &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useScroll &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Menu</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/main/components/menu/index.vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; scrollTransition &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> run = <span class="title function_">scrollTransition</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">data</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">required</span>: <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 默认选中索引</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> curretIndex = <span class="title function_">ref</span>(-<span class="number">1</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> sliderStyle = <span class="title function_">ref</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">left</span>: <span class="string">&#x27;10px&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">width</span>: <span class="string">&#x27;0px&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">bottom</span>: <span class="number">0</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//  ul dom元素</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> ulEle = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// li dom元素容器</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> liEles = <span class="title function_">ref</span>(<span class="keyword">new</span> <span class="title class_">Set</span>())</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 每一项在屏幕中央时，需要向左滚动的距离</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> scrollRaces = <span class="title function_">ref</span>([])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// ulScrollLeft 向左滚动的距离</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> &#123; <span class="attr">x</span>: ulScrollLeft &#125; = <span class="title function_">useScroll</span>(ulEle)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> visible = <span class="title function_">ref</span>(<span class="literal">false</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 选中索引</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">handleSelectCategory</span> = (<span class="params">index</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  curretIndex.<span class="property">value</span> = index</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  visible.<span class="property">value</span> = <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// ulEle.value.scrollTo(scrollRaces.value[index], 0)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">run</span>(&#123; <span class="attr">el</span>: ulEle.<span class="property">value</span>, <span class="attr">position</span>: scrollRaces.<span class="property">value</span>[index], <span class="attr">direction</span>: <span class="string">&#x27;l&#x27;</span>, <span class="attr">time</span>: <span class="number">200</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 获取v-for遍历的子元素dom节点时，需要使用回调函数获取; 注意: 每次页面更新之后storeLiEle，都会重新执行一遍，这样会导致liEles中存储的都是重复的元素</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 所以可以使用Set来存储数据，避免存入重复的数据， 也可以在obBeforeUpdate前设置liEles.value的值为初始化值</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">storeLiEle</span> = (<span class="params">el</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  liEles.<span class="property">value</span>.<span class="title function_">add</span>(el)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">watch</span>(curretIndex, <span class="function">(<span class="params">newIndex, oldIndex</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 保证渲染之后再进行计算元素的位置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 获取点击元素的距离左边屏幕的距离和元素的宽度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> liEle = <span class="title class_">Array</span>.<span class="title function_">from</span>(liEles.<span class="property">value</span>)[newIndex]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (!liEle) <span class="keyword">return</span> <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> &#123; left, width, height &#125; = liEle.<span class="title function_">getBoundingClientRect</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    sliderStyle.<span class="property">value</span> = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;left + ulScrollLeft.value&#125;</span>px`</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">width</span>: <span class="string">`<span class="subst">$&#123;width&#125;</span>px`</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">height</span>: <span class="string">`<span class="subst">$&#123;height&#125;</span>px`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">immediate</span>: <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 监听data初次数据渲染之后，将slider条设置到第一项</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">watch</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="function">() =&gt;</span> props.<span class="property">data</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (props.<span class="property">data</span>.<span class="property">length</span> &lt;= <span class="number">0</span>) <span class="keyword">return</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      curretIndex.<span class="property">value</span> = <span class="number">0</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 获取1/2屏幕的宽度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> halfScreenWidth = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="number">2</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 每一项向左滚动的距离 = 每一项距离屏幕左边的距离 - 1/2屏幕的宽度 + 1/2自身的宽度 </span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      scrollRaces.<span class="property">value</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(liEles.<span class="property">value</span>).<span class="title function_">map</span>(<span class="function"><span class="params">el</span> =&gt;</span> el.<span class="title function_">getBoundingClientRect</span>().<span class="property">left</span> - halfScreenWidth + el.<span class="property">offsetWidth</span> / <span class="number">2</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;, &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">immediate</span>: <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="comment">/* ul &#123;</span></span></span></span><br><span class="line"><span class="comment"><span class="language-css"><span class="language-xml">  scroll-behavior: smooth;</span></span></span></span><br><span class="line"><span class="comment"><span class="language-css"><span class="language-xml">&#125; */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191456084.gif" alt="20220822_104005"> </p>
<h3 id="13、通用组件自动化注册"><a href="#13、通用组件自动化注册" class="headerlink" title="13、通用组件自动化注册"></a>13、通用组件自动化注册</h3><p>如果每次开发完成一个通用组件之后，都去手动进行注册，过于麻烦，所以我们期望通过 vite 提供的功能，进行通用组件的自动化注册<br>那么,如果想要完成这个功能的话，就需要使用到两个关键的知识点:</p>
<ul>
<li><p>1、<a target="_blank" rel="noopener" href="https://vitejs.cn/guide/features.html#glob-import">vite的Glob</a> 导入功能：该功能可以帮助我们在文件系统中导入多个模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> modules = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">glob</span>(<span class="string">&#x27;./dir/*.js&#x27;</span>)</span><br><span class="line"><span class="comment">// 以上将会被转译为下面的样子：</span></span><br><span class="line"><span class="keyword">const</span> modules = &#123;</span><br><span class="line">  <span class="string">&#x27;./dir/foo.js&#x27;</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./dir/foo.js&#x27;</span>),</span><br><span class="line">  <span class="string">&#x27;./dir/bar.js&#x27;</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./dir/bar.js&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>2、vue的 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/guide/components/async.html">defineAsyncComponent</a>方法：该方法可以创建一个按需加载的异步组件</li>
</ul>
<p><strong>我们先来看下现在的代码</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">SvgIcon</span> <span class="keyword">from</span> <span class="string">&#x27;./svg-icon/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Popup</span> <span class="keyword">from</span> <span class="string">&#x27;./popup/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出对象、这个对象有install方法，这样既可以通过app.use(options)来使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;m-svg-icon&#x27;</span>, <span class="title class_">SvgIcon</span>)</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;m-Popup&#x27;</span>, <span class="title class_">Popup</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>改成动态导入的形式</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动化注册组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出对象、这个对象有install方法，这样既可以通过app.use(options)来使用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="comment">// 1、获取当前路径下所有文件夹中以index.vue结尾的文件</span></span><br><span class="line">    <span class="keyword">const</span> components = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">glob</span>(<span class="string">&#x27;./*/index.vue&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [path, fn] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(components)) &#123; <span class="comment">// path: ./popup/index.vue</span></span><br><span class="line">      <span class="comment">// 2、遍历获取到的组件模块：根据path生成组件名称, defineAsyncComponent生成动态组件</span></span><br><span class="line">      <span class="keyword">const</span> componentName = <span class="string">&#x27;m-&#x27;</span> +  path.<span class="title function_">replace</span>(<span class="string">&#x27;./&#x27;</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">      <span class="comment">// 3、利用 app.component 将组件注册到app上</span></span><br><span class="line">      app.<span class="title function_">component</span>(componentName, <span class="title function_">defineAsyncComponent</span>(fn))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14、PC端基础架构"><a href="#14、PC端基础架构" class="headerlink" title="14、PC端基础架构"></a>14、PC端基础架构</h3><p>PC端 具备两个路由的出口：一级路由出口：APP.vue 中<br>                                                二级路由出口：Main.vue 中</p>
<p>当前的代码而言，仅存在一个一级路由出口，需要处理 二级路由出口：</p>
<ol>
<li>创建 src/views/layout/index.vue 文件，表示 一级路由出口 对应的组件</li>
<li><p>在 layout/components 中分别创建三个业务组件:</p>
<ol>
<li>header/index.vue: 表示P端头部区域</li>
<li>main.vue : 二级路由出口</li>
<li>floating: 右下角悬浮区域</li>
</ol>
</li>
<li><p>在 src/views/layout/index.vue 文件中，导入这三个组件</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;h-screen&quot;&gt;</span><br><span class="line">      &lt;!-- 需要在 tailwind 中定义 h-header、h-main 高度 --&gt;</span><br><span class="line">      &lt;header-vue class=&quot;h-header&quot;&gt;&lt;/header-vue&gt;</span><br><span class="line">      &lt;div class=&quot;h-main&quot;&gt;</span><br><span class="line">        &lt;main-vue&gt;&lt;/main-vue&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;floating-vue&gt;&lt;/floating-vue&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;script setup&gt;</span><br><span class="line">  import headerVue from &#x27;./components/header/index.vue&#x27;</span><br><span class="line">  import mainVue from &#x27;./components/main.vue&#x27;</span><br><span class="line">  import floatingVue from &#x27;./components/floating.vue&#x27;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在 tailwind 中定义 h-header、h-main 高度</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extend</span>: &#123;</span><br><span class="line">    <span class="comment">// PC端顶部和内容区高度</span></span><br><span class="line">     <span class="attr">height</span>: &#123;</span><br><span class="line">       <span class="attr">header</span>: <span class="string">&#x27;72px&#x27;</span>,</span><br><span class="line">       <span class="attr">main</span>: <span class="string">&#x27;calc(100vh - 72px)&#x27;</span></span><br><span class="line">     &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>PC端路由出口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/layout/index.vue&#x27;</span>),</span><br><span class="line">        <span class="attr">children</span>:[]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="header模块的简单搭建"><a href="#header模块的简单搭建" class="headerlink" title="header模块的简单搭建"></a>header模块的简单搭建</h4><p>在 layout/components/header 中分别创建三个业务组件:</p>
<ol>
<li>header-search/index.vue: 表示PC端头部搜索区域</li>
<li>header-my.vue : 个人信息展示</li>
<li>header-theme: 头部主题切换</li>
</ol>
<p>在<code>header/index.vue</code>中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;w-full bg-white  border-b border-b-zinc-200 px-2 py-1&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div class=&quot;flex items-center&quot;&gt;</span><br><span class="line">      &lt;img </span><br><span class="line">        class=&quot;h-4 cursor-pointer mr-2 guide-home&quot;</span><br><span class="line">        src=&quot;&quot; </span><br><span class="line">         @click=&quot;onToHome&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;header-search-vue class=&quot;mr-1&quot;&gt;&lt;/header-search-vue&gt;</span><br><span class="line">      &lt;header-theme-vue class=&quot;mr-1&quot;&gt;&lt;/header-theme-vue&gt;</span><br><span class="line">      &lt;header-my-vue&gt;&lt;/header-my-vue&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerSearchVue from &#x27;./header-search/index.vue&#x27;</span><br><span class="line">import headerThemeVue from &#x27;./header-theme.vue&#x27;</span><br><span class="line">import headerMyVue from &#x27;./header-my.vue&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">// router === this.$router</span><br><span class="line">const router = useRouter()</span><br><span class="line">// 点击跳转到首页</span><br><span class="line">const onToHome = () =&gt; &#123;</span><br><span class="line">  router.push(&#x27;/&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="15、封装通用组件-search"><a href="#15、封装通用组件-search" class="headerlink" title="15、封装通用组件 search"></a>15、封装通用组件 search</h3><h4 id="search-搜索框能力分析"><a href="#search-搜索框能力分析" class="headerlink" title="search 搜索框能力分析"></a>search 搜索框能力分析</h4><p>search 部分为搜索框，对于该搜索框而言把它做成通用组件, 它应该具备的功能：</p>
<ol>
<li>输入内容实现双向数据绑定</li>
<li>鼠标移入与获取焦点时的动画</li>
<li>一键清空文本功能</li>
<li>搜索触发功能</li>
<li>可控制，可填充的下拉展示区</li>
<li>监听到以下事件列表：<ol>
<li>clear：删除所有文本事件</li>
<li>input：输入事件</li>
<li>focus：获取焦点事件</li>
<li>blur：失去焦点事件</li>
<li>search：触发搜索(点击或回车)事件</li>
</ol>
</li>
</ol>
<h4 id="search-搜索框样式处理"><a href="#search-搜索框样式处理" class="headerlink" title="search 搜索框样式处理"></a>search 搜索框样式处理</h4><p><code>libs\search\index.vue</code>中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;group relative p-0.5 rounded-xl border-white duration-500 hover:bg-red-100/40&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 搜索图标 --&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        class=&quot;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] left-2&quot;</span><br><span class="line">        name=&quot;search&quot;</span><br><span class="line">        color=&quot;#707070&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- 输入框 --&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        class=&quot;block w-full h-[44px] pl-4 text-sm outline-0 bg-zinc-100 caret-zinc-400 rounded-xl text-zinc-900 tracking-wide font-semibold border border-zinc-100 duration-500 group-hover:bg-white group-hover:border-zinc-200 focus:border-red-300&quot;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        placeholder=&quot;搜索&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- 删除按钮 --&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        v-show=&quot;inputValue&quot;</span><br><span class="line">        name=&quot;input-delete&quot;</span><br><span class="line">        class=&quot;h-1.5 w-1.5 absolute translate-y-[-50%] top-[50%] right-9 duration-500 cursor-pointer&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!-- 分割线 --&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;opacity-0 h-1.5 w-[1px] absolute translate-y-[-50%] top-[50%] right-[62px] duration-500 bg-zinc-200 group-hover:opacity-100&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;!-- TODO: 搜索按钮(通用组件) --&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 下拉区 --&gt;</span><br><span class="line">    &lt;transition name=&quot;slide&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;max-h-[368px] w-full text-base overflow-auto bg-white absolute z-20 left-0 top-[56px] p-2 rounded border border-zinc-200 duration-200 hover:shadow-3xl scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot name=&quot;dropdown&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="完善search基本功能"><a href="#完善search基本功能" class="headerlink" title="完善search基本功能"></a>完善search基本功能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    ref=&quot;containerTarget&quot;</span><br><span class="line">    class=&quot;group relative p-0.5 rounded-xl border-white duration-500 hover:bg-red-100/40&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;!-- 搜索图标 --&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        class=&quot;w-1.5 h-1.5 absolute translate-y-[-50%] top-[50%] left-2&quot;</span><br><span class="line">        name=&quot;search&quot;</span><br><span class="line">        color=&quot;#707070&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- 输入框 --&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        class=&quot;block w-full h-[44px] pl-4 text-sm outline-0 bg-zinc-100 caret-zinc-400 rounded-xl text-zinc-900 tracking-wide font-semibold border border-zinc-100 duration-500 group-hover:bg-white group-hover:border-zinc-200 focus:border-blue-300&quot;</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        placeholder=&quot;搜索&quot;</span><br><span class="line">        v-model=&quot;inputValue&quot;</span><br><span class="line">        @focus=&quot;onFocusHandler&quot;</span><br><span class="line">        @blur=&quot;onBlurHandler&quot;</span><br><span class="line">        @keyup.enter=&quot;onSearchHandlder&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;!-- 删除按钮 --&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        v-show=&quot;inputValue&quot;</span><br><span class="line">        name=&quot;input-delete&quot;</span><br><span class="line">        class=&quot;h-1.5 w-1.5 absolute translate-y-[-50%] top-[50%] right-9 duration-500 cursor-pointer&quot;</span><br><span class="line">        @click=&quot;onClearClick&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!-- 分割线 --&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;opacity-0 h-1.5 w-[1px] absolute translate-y-[-50%] top-[50%] right-[62px] duration-500 bg-zinc-200 group-hover:opacity-100&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">      &lt;!-- TODO: 搜索按钮(通用组件) --&gt;</span><br><span class="line">      &lt;m-button</span><br><span class="line">          class=&quot;absolute translate-y-[-50%] top-[50%] right-1 rounded-xl duration-500 opacity-0 group-hover:opacity-100&quot;</span><br><span class="line">          icon=&quot;search&quot;</span><br><span class="line">          iconColor=&quot;#ffffff&quot;</span><br><span class="line">          @click=&quot;onSearchHandlder&quot;</span><br><span class="line">        &gt;&lt;/m-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 下拉区 --&gt;</span><br><span class="line">    &lt;transition name=&quot;slide&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;$slots.dropdown&quot;</span><br><span class="line">        v-show=&quot;isFocus&quot;</span><br><span class="line">        class=&quot;max-h-[368px] w-full text-base overflow-auto bg-white absolute z-20 left-0 top-[56px] p-2 rounded border border-zinc-200 duration-200 hover:shadow-3xl scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot name=&quot;dropdown&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 更新事件</span><br><span class="line">const EMIT_UPDATE_MODELVALUE = &#x27;update:modelValue&#x27;</span><br><span class="line">// 触发搜索（点击或回车）事件</span><br><span class="line">const EMIT_SEARCH = &#x27;search&#x27;</span><br><span class="line">// 删除所有文本事件</span><br><span class="line">const EMIT_CLEAR = &#x27;clear&#x27;</span><br><span class="line">// 输入事件</span><br><span class="line">const EMIT_INPUT = &#x27;input&#x27;</span><br><span class="line">// 获取焦点事件</span><br><span class="line">const EMIT_FOCUS = &#x27;focus&#x27;</span><br><span class="line">// 失去焦点事件</span><br><span class="line">const EMIT_BLUR = &#x27;blur&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">/**</span><br><span class="line"> * 1. 输入内容实现双向数据绑定</span><br><span class="line"> * 2. 搜索按钮在 hover 是展示</span><br><span class="line"> * 3. 一键清空文本功能</span><br><span class="line"> * 4. 触发搜索</span><br><span class="line"> * 5. 控制下拉展示区的展示</span><br><span class="line"> * 6. 事件处理</span><br><span class="line"> */</span><br><span class="line">import &#123; watch, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useVModel, onClickOutside &#125; from &#x27;@vueuse/core&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  modelValue: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 注册事件</span><br><span class="line">const emits = defineEmits([</span><br><span class="line">  EMIT_UPDATE_MODELVALUE,</span><br><span class="line">  EMIT_CLEAR,</span><br><span class="line">  EMIT_INPUT,</span><br><span class="line">  EMIT_FOCUS,</span><br><span class="line">  EMIT_BLUR,</span><br><span class="line">  EMIT_SEARCH</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">// 输入文本</span><br><span class="line">const inputValue = useVModel(props)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 清空文本</span><br><span class="line"> */</span><br><span class="line">const onClearClick = () =&gt; &#123;</span><br><span class="line">  inputValue.value = &#x27;&#x27;</span><br><span class="line">  emits(EMIT_CLEAR, &#x27;&#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 触发搜索</span><br><span class="line"> */</span><br><span class="line">const onSearchHandlder = () =&gt; &#123;</span><br><span class="line">  emits(EMIT_SEARCH, inputValue.value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 监听焦点行为</span><br><span class="line"> */</span><br><span class="line">const isFocus = ref(false)</span><br><span class="line">const onFocusHandler = () =&gt; &#123;</span><br><span class="line">  isFocus.value = true</span><br><span class="line">  emits(EMIT_FOCUS)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 失去焦点</span><br><span class="line"> */</span><br><span class="line">const onBlurHandler = () =&gt; &#123;</span><br><span class="line">  emits(EMIT_BLUR)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 点击区域外隐藏 dropdown</span><br><span class="line"> */</span><br><span class="line">const containerTarget = ref(null)</span><br><span class="line">onClickOutside(containerTarget, () =&gt; &#123;</span><br><span class="line">  isFocus.value = false</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 监听输入行为</span><br><span class="line"> */</span><br><span class="line">watch(inputValue, (val) =&gt; &#123;</span><br><span class="line">  emits(EMIT_INPUT, val)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">// 搜索框下拉区动画</span><br><span class="line">.slide-enter-active,</span><br><span class="line">.slide-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter-from,</span><br><span class="line">.slide-leave-to &#123;</span><br><span class="line">  transform: translateY(40px);</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="16、封装通用组件-button"><a href="#16、封装通用组件-button" class="headerlink" title="16、封装通用组件 button"></a>16、封装通用组件 button</h3><p>需要实现的组件如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191457602.jpg" alt="image-20220823102101628"></p>
<p>在<code>tailwind.config.js</code>中添加项目主色值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extend</span>: &#123;</span><br><span class="line">   <span class="attr">colors</span>: &#123;</span><br><span class="line">        <span class="attr">main</span>: <span class="string">&#x27;#667eb0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;hover-main&#x27;</span>: <span class="string">&#x27;#6495ED&#x27;</span></span><br><span class="line">      &#125;, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>libs\button\index.vue</code>中封装通用组件 button：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button</span><br><span class="line">    class=&quot;text-sm text-center rounded duration-150 flex justify-center items-center&quot;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      typeEnum[type],</span><br><span class="line">      sizeEnum[sizeKey].button,</span><br><span class="line">      &#123; &#x27;active:scale-105&#x27;: isActiveAnim &#125;</span><br><span class="line">    ]&quot;</span><br><span class="line">    @click.stop=&quot;onBtnClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- .stop防止冒泡 --&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;!-- 展示 loading --&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&quot;loading&quot;</span><br><span class="line">      name=&quot;loading&quot;</span><br><span class="line">      class=&quot;w-2 h-2 animate-spin mr-1&quot;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- icon 按钮 --&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&quot;icon&quot;</span><br><span class="line">      :name=&quot;icon&quot;</span><br><span class="line">      class=&quot;m-auto&quot;</span><br><span class="line">      :class=&quot;sizeEnum[sizeKey].icon&quot;</span><br><span class="line">      :color=&quot;iconColor&quot;</span><br><span class="line">      :fillClass=&quot;iconClass&quot;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 文字按钮 --&gt;</span><br><span class="line">    &lt;slot v-else /&gt;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line">// type 可选项：表示按钮风格</span><br><span class="line">const typeEnum = &#123;</span><br><span class="line">  primary: &#x27;text-white bg-zinc-800 hover:bg-zinc-900 active:bg-zinc-800&#x27;,</span><br><span class="line">  main: &#x27;text-white bg-main hover:bg-hover-main active:bg-main&#x27;,</span><br><span class="line">  info: &#x27;text-zinc-800 bg-zinc-200 hover:bg-zinc-300 active:bg-zinc-200&#x27;</span><br><span class="line">&#125;</span><br><span class="line">// size 可选项：表示按钮大小。区分文字按钮和icon按钮</span><br><span class="line">const sizeEnum = &#123;</span><br><span class="line">    // 文字按钮</span><br><span class="line">  default: &#123;</span><br><span class="line">    button: &#x27;w-8 h-4 text-base&#x27;,</span><br><span class="line">    icon: &#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">//   icon按钮</span><br><span class="line">  &#x27;icon-default&#x27;: &#123;</span><br><span class="line">    button: &#x27;w-4 h-4&#x27;,</span><br><span class="line">    icon: &#x27;w-1.5 h-1.5&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  small: &#123;</span><br><span class="line">    button: &#x27;w-7 h-3 text-base&#x27;,</span><br><span class="line">    icon: &#x27;&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x27;icon-small&#x27;: &#123;</span><br><span class="line">    button: &#x27;w-3 h-3&#x27;,</span><br><span class="line">    icon: &#x27;w-1.5 h-1.5&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const EMITS_CLICK = &#x27;click&#x27; // 常量 - 按钮点击事件</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">/**</span><br><span class="line"> * 1.构建 type 风格可选项和 size 大小可选项</span><br><span class="line"> * 2.通过 props 让开发者控制按钮</span><br><span class="line"> * 3.区分 icon button 和 text button</span><br><span class="line"> * 4.依据当前的数据，实现视图</span><br><span class="line"> * 5.处理点击事件</span><br><span class="line"> */ </span><br><span class="line"> const props = defineProps(&#123;</span><br><span class="line">  icon:  String, // icon 图标名字</span><br><span class="line">  iconColor: String, // icon 图标颜色</span><br><span class="line">  iconClass: String, // icon 图标类名（匹配 tailwind）</span><br><span class="line"></span><br><span class="line">  // 按钮风格</span><br><span class="line">  type: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;main&#x27;,</span><br><span class="line">    validator(val) &#123;</span><br><span class="line">      const keys = Object.keys(typeEnum) // 获取所有的可选的按钮风格</span><br><span class="line">      const result = keys.includes(val) // 开发者指定风格是否在可选风格中</span><br><span class="line">      if (!result) &#123; // 如果不在则给开发者提示</span><br><span class="line">        throw new Error(`你的 type 必须是 $&#123;keys.join(&#x27;、&#x27;)&#125; 中的一个`)</span><br><span class="line">      &#125;</span><br><span class="line">      return result // 返回校验结果</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 大小风格</span><br><span class="line">  size: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;default&#x27;,</span><br><span class="line">    validator(val) &#123;</span><br><span class="line">      // 获取所有的可选的大小（注意剔除 icon 开头的元素，因为我们期望开发者输入 size=&quot;default&quot;，但不期望开发者输入 size=&quot;icon-default&quot;）</span><br><span class="line">      const keys = Object.keys(sizeEnum).filter((key) =&gt; !key.includes(&#x27;icon&#x27;))</span><br><span class="line">      const result = keys.includes(val) // 开发者指定大小是否在可选大小中</span><br><span class="line">      if (!result) &#123; // 如果不在则给开发者提示</span><br><span class="line">        throw new Error(`你的 size 必须是 $&#123;keys.join(&#x27;、&#x27;)&#125; 中的一个`)</span><br><span class="line">      &#125;</span><br><span class="line">      return result // 返回校验结果</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 按钮在点击时是否需要动画</span><br><span class="line">  isActiveAnim: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: true</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 加载状态</span><br><span class="line">  loading: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// props.size  处理大小的 key 值</span><br><span class="line">const sizeKey = computed(() =&gt; &#123;</span><br><span class="line">  return props.icon ? &#x27;icon-&#x27; + props.size : props.size</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 按钮点击事件处理</span><br><span class="line"> */</span><br><span class="line"> const onBtnClick = () =&gt; &#123;</span><br><span class="line">  if (props.loading) &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  emits(EMITS_CLICK)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="17、通用组件-popover"><a href="#17、通用组件-popover" class="headerlink" title="17、通用组件 popover"></a>17、通用组件 popover</h3><p>通用组件popover应具备以下功能：</p>
<ul>
<li>1、指定两个插槽、分别插入触发内容和弹出内容</li>
<li>2、触发弹出内容的方式分为多种，<code>click</code>、<code>hover</code>、<code>focus</code>、<code>manual</code></li>
<li>3、可以设定弹出层相对于触发元素的位置 <code>bottom</code>,<code>bottom-start</code>, <code>bottom-end</code>, <code>top</code>, <code>top-start</code>, <code>top-end</code></li>
<li>4、将弹出层指定挂载到body元素上、并且当页面滚动和页面尺寸发生变化时、弹出层也应虽则触发元素的位置改变而改变</li>
<li>5、弹出层展示和隐藏时要有过渡效果</li>
</ul>
<p><strong>实现思路</strong></p>
<ul>
<li>1、对用户指定的属性值进行校验</li>
<li>2、当页面挂载之后获取父元素的 <strong>宽度</strong>、<strong>高度</strong>、<strong>距离屏幕左边left</strong>、<strong>距离屏幕顶边top</strong></li>
<li>3、当触发弹出元素显示后，立即获取显示元素的<strong>宽度</strong>、<strong>高度</strong>， 结合触发元素的属性与显示的位置，计算出弹出元素应该显示到的位置 left, top</li>
<li>4、当页面滚动/尺寸发生改变、重新计算生成新的显示到的位置 left, top</li>
<li>5、根据触发方式对应的显示和隐藏弹出元素；（注意： 在hover触发下、鼠标触发元素触发弹出元素显示后、然后再移动到显示元素上时，我们需要处理一下，避免弹出层先隐藏再展示的bug; 处理方法可以使用<code>setTimeout</code>延时修改元素的隐藏、在定时器触发之前、如果触发元素的显示、则先清理定时器）</li>
</ul>
<h4 id="基础功能实现"><a href="#基础功能实现" class="headerlink" title="基础功能实现"></a>基础功能实现</h4><p>新建<code>libs\popover\index.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;relative&quot; @mouseleave=&quot;onMouseleave&quot; @mouseenter=&quot;onMouseenter&quot;&gt;</span><br><span class="line">      &lt;div ref=&quot;referenceTarget&quot;&gt;</span><br><span class="line">        &lt;!-- 具名插槽：触发弹层的视图 --&gt;</span><br><span class="line">        &lt;slot name=&quot;reference&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 气泡展示动画 --&gt;</span><br><span class="line">      &lt;transition name=&quot;slide&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          v-show=&quot;isVisable&quot;</span><br><span class="line">          ref=&quot;contentTarget&quot;</span><br><span class="line">          class=&quot;absolute p-1 z-20 bg-white dark:bg-zinc-900 border rounded-md dark:border-zinc-700&quot;</span><br><span class="line">          :style=&quot;contentStyle&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;!-- 匿名插槽：弹出层视图中展示的内容 --&gt;</span><br><span class="line">          &lt;slot /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/transition&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 延迟关闭时长</span><br><span class="line">const DELAY_TIME = 100</span><br><span class="line"></span><br><span class="line">const PROP_TOP_LEFT = &#x27;top-left&#x27;</span><br><span class="line">const PROP_TOP_RIGHT = &#x27;top-right&#x27;</span><br><span class="line">const PROP_BOTTOM_LEFT = &#x27;bottom-left&#x27;</span><br><span class="line">const PROP_BOTTOM_RIGHT = &#x27;bottom-right&#x27;</span><br><span class="line"></span><br><span class="line">// 定义指定位置的 Enum</span><br><span class="line">const placementEnum = [</span><br><span class="line">  PROP_TOP_LEFT,</span><br><span class="line">  PROP_TOP_RIGHT,</span><br><span class="line">  PROP_BOTTOM_LEFT,</span><br><span class="line">  PROP_BOTTOM_RIGHT</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, watch, nextTick &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  // 控制气泡弹出位置，并给出开发者错误的提示</span><br><span class="line">  placement: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;bottom-left&#x27;,</span><br><span class="line">    validator(val) &#123;</span><br><span class="line">      const result = placementEnum.includes(val)</span><br><span class="line">      if (!result) &#123;</span><br><span class="line">        throw new Error(</span><br><span class="line">          `你的 placement 必须是 $&#123;placementEnum.join(&#x27;、&#x27;)&#125; 中的一个`</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      return result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 控制 menu 展示</span><br><span class="line">const isVisable = ref(false)</span><br><span class="line"></span><br><span class="line">// 控制延迟关闭</span><br><span class="line">let timeout = null</span><br><span class="line">/**</span><br><span class="line"> * 鼠标移入的触发行为</span><br><span class="line"> */</span><br><span class="line"> const onMouseenter = () =&gt; &#123;</span><br><span class="line">  isVisable.value = true</span><br><span class="line">  // 再次触发时，清理延时装置</span><br><span class="line">  if (timeout) &#123;</span><br><span class="line">    clearTimeout(timeout)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 鼠标移出的触发行为</span><br><span class="line"> */</span><br><span class="line">const onMouseleave = () =&gt; &#123;</span><br><span class="line">  // 延时装置</span><br><span class="line">  timeout = setTimeout(() =&gt; &#123;</span><br><span class="line">    isVisable.value = false</span><br><span class="line">    timeout = null</span><br><span class="line">  &#125;, DELAY_TIME)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 计算元素尺寸</span><br><span class="line"> */</span><br><span class="line"> const referenceTarget = ref(null)</span><br><span class="line">const contentTarget = ref(null)</span><br><span class="line">const useElementSize = (target) =&gt; &#123;</span><br><span class="line">  if (!target) return &#123;&#125;</span><br><span class="line">  return &#123;</span><br><span class="line">    width: target.offsetWidth,</span><br><span class="line">    height: target.offsetHeight</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 计算弹层位置</span><br><span class="line"> */</span><br><span class="line">const contentStyle = ref(&#123;</span><br><span class="line">  top: 0,</span><br><span class="line">  left: 0</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 监听展示的变化，在展示时计算气泡位置</span><br><span class="line"> */</span><br><span class="line">watch(isVisable, (val) =&gt; &#123;</span><br><span class="line">  if (!val) &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  // 等待渲染成功之后</span><br><span class="line">  nextTick(() =&gt; &#123;</span><br><span class="line">    switch (props.placement) &#123;</span><br><span class="line">      // 左上</span><br><span class="line">      case PROP_TOP_LEFT:</span><br><span class="line">        contentStyle.value.top = 0</span><br><span class="line">        contentStyle.value.left =</span><br><span class="line">          -useElementSize(contentTarget.value).width + &#x27;px&#x27;</span><br><span class="line">        break</span><br><span class="line">      // 右上</span><br><span class="line">      case PROP_TOP_RIGHT:</span><br><span class="line">        contentStyle.value.top = 0</span><br><span class="line">        contentStyle.value.left =</span><br><span class="line">          useElementSize(referenceTarget.value).width + &#x27;px&#x27;</span><br><span class="line">        break</span><br><span class="line">      // 左下</span><br><span class="line">      case PROP_BOTTOM_LEFT:</span><br><span class="line">        contentStyle.value.top =</span><br><span class="line">          useElementSize(referenceTarget.value).height + &#x27;px&#x27;</span><br><span class="line">        contentStyle.value.left =</span><br><span class="line">          -useElementSize(contentTarget.value).width + &#x27;px&#x27;</span><br><span class="line">        break</span><br><span class="line">      // 右下</span><br><span class="line">      case PROP_BOTTOM_RIGHT:</span><br><span class="line">        contentStyle.value.top =</span><br><span class="line">          useElementSize(referenceTarget.value).height + &#x27;px&#x27;</span><br><span class="line">        contentStyle.value.left =</span><br><span class="line">          useElementSize(referenceTarget.value).width + &#x27;px&#x27;</span><br><span class="line">        break</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">// slide 展示动画</span><br><span class="line">.slide-enter-active,</span><br><span class="line">.slide-leave-active &#123;</span><br><span class="line">  transition: opacity 0.3s, transform 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter-from,</span><br><span class="line">.slide-leave-to &#123;</span><br><span class="line">  transform: translateY(20px);</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="组件使用：主题切换"><a href="#组件使用：主题切换" class="headerlink" title="组件使用：主题切换"></a>组件使用：主题切换</h4><p>在<code>constants\index.js</code>中添加主题常量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 暗黑主题 - 极夜黑</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_DARK</span> = <span class="string">&#x27;dark&#x27;</span></span><br><span class="line"><span class="comment">// 浅色主题 - 极简白</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_LIGHT</span> = <span class="string">&#x27;light&#x27;</span></span><br><span class="line"><span class="comment">// 系统主题 - 跟随系统</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">THEME_SYSTEM</span> = <span class="string">&#x27;system&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在<code>view\layout\components\header\header-theme.vue</code>中使用popover组件实现主题切换功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover&gt;</span><br><span class="line">    &lt;!-- 具名插槽：触发弹层的视图 --&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        :name=&quot;svgIconName&quot;</span><br><span class="line">        class=&quot;guide-theme w-4 h-4 p-1 cursor-pointer rounded-sm duration-200 outline-none hover:bg-zinc-100/60 dark:hover:bg-zinc-900&quot;</span><br><span class="line">        fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;!-- 匿名插槽：弹出层视图中展示的内容 --&gt;</span><br><span class="line">    &lt;div class=&quot;w-[140px] overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;flex items-center p-1 cursor-pointer rounded hover:bg-zinc-100/60 dark:hover:bg-zinc-800&quot;</span><br><span class="line">        v-for=&quot;item in themeArr&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">        @click=&quot;onItemClick(item)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&quot;item.icon&quot;</span><br><span class="line">          class=&quot;w-1.5 h-1.5 mr-1&quot;</span><br><span class="line">          fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;span class=&quot;text-zinc-800 dark:text-zinc-300 text-sm&quot;&gt;</span><br><span class="line">          &#123;&#123; item.name &#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; THEME_DARK, THEME_LIGHT, THEME_SYSTEM &#125; from &#x27;@/constants&#x27;</span><br><span class="line"></span><br><span class="line">// 构建渲染数据源</span><br><span class="line">const themeArr = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: &#x27;0&#x27;,</span><br><span class="line">    type: THEME_LIGHT,</span><br><span class="line">    icon: &#x27;theme-light&#x27;,</span><br><span class="line">    name: &#x27;极简白&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: &#x27;1&#x27;,</span><br><span class="line">    type: THEME_DARK,</span><br><span class="line">    icon: &#x27;theme-dark&#x27;,</span><br><span class="line">    name: &#x27;极夜黑&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: &#x27;2&#x27;,</span><br><span class="line">    type: THEME_SYSTEM,</span><br><span class="line">    icon: &#x27;theme-system&#x27;,</span><br><span class="line">    name: &#x27;跟随系统&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="鼠标慢速移动时，处理气泡消失问题"><a href="#鼠标慢速移动时，处理气泡消失问题" class="headerlink" title="鼠标慢速移动时，处理气泡消失问题"></a>鼠标慢速移动时，处理气泡消失问题</h4><p>​    气泡消失是因为在 reference 与 气泡 之间存在间隙，当鼠标移动到这个间隙处时，就会触发mouseleave 鼠标移出事件，那么此时isVisable 就会变为 false。</p>
<p>可以利用 <strong>类似于防抖（debounce）</strong>概念<br>    <strong>鼠标刚离开时，不立刻修改 isVisable，而是延迟一段时间，如果在这段时间之内，再次触发了鼠标移入事件，则不再修改 isViable</strong></p>
<p>1.定义延迟关闭时长</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 延迟关闭时长</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DELAY_TIME</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>2.通过定时器，处理延迟关闭</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制延迟关闭</span></span><br><span class="line"><span class="keyword">let</span> timeout = <span class="literal">null</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鼠标移入的触发行为</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">const</span> <span class="title function_">onMouseenter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 再次触发时，清理延时装置</span></span><br><span class="line">  <span class="keyword">if</span> (timeout) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(timeout)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 鼠标移出的触发行为</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onMouseleave</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 延时装置</span></span><br><span class="line">  timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    isVisable.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    timeout = <span class="literal">null</span></span><br><span class="line">  &#125;, <span class="variable constant_">DELAY_TIME</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="组件使用：个人中心"><a href="#组件使用：个人中心" class="headerlink" title="组件使用：个人中心"></a>组件使用：个人中心</h4><p>在<code>view\layout\components\header\header-my.vue</code>中实现用户中心显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover class=&quot;flex items-center&quot; placement=&quot;bottom-left&quot;&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;guide-my relative flex items-center p-0.5 rounded-sm cursor-pointer duration-200 outline-none hover:bg-zinc-100 dark:hover:bg-zinc-900&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      </span><br><span class="line">        &lt;!-- 用户头像 --&gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          class=&quot;w-3 h-3 rounded-sm&quot;</span><br><span class="line">          src=&quot;https://cn.bing.com/images/search?view=detailV2&amp;ccid=aVWH7Tes&amp;id=3FC731F85EB45885B3A3BEB73C3F77C7393FEC3C&amp;thid=OIP.aVWH7TesrK94UHrFv6aksAHaHa&amp;mediaurl=https%3a%2f%2fstatic.aisnogames.com%2faisnoweb%2fcn%2faisno%2faisno-web%2faisno.png&amp;exph=474&amp;expw=474&amp;q=%e6%ad%a6%e5%99%a8%e8%bf%b7%e9%80%94%e5%a4%b4%e5%83%8f&amp;simid=608015766186321973&amp;FORM=IRPRST&amp;ck=E3B149C9B8FE258A8F818BBC7A663998&amp;selectedIndex=64&amp;itb=0&amp;ajaxhist=0&amp;ajaxserp=0&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 用户头像右边下箭头 --&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          class=&quot;h-1.5 w-1.5 ml-0.5&quot;</span><br><span class="line">          name=&quot;down-arrow&quot;</span><br><span class="line">          fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- vip 标记 --&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&quot;vip&quot;</span><br><span class="line">          class=&quot;w-1.5 h-1.5 absolute right-[16px] bottom-0&quot;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 气泡框 --&gt;</span><br><span class="line">    &lt;div class=&quot;w-[140px] overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;flex items-center p-1 cursor-pointer rounded hover:bg-zinc-100/60 dark:hover:bg-zinc-800&quot;</span><br><span class="line">        v-for=&quot;item in menuArr&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&quot;item.icon&quot;</span><br><span class="line">          class=&quot;w-1.5 h-1.5 mr-1&quot;</span><br><span class="line">          fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;span class=&quot;text-zinc-800 dark:text-zinc-300 text-sm&quot;&gt;</span><br><span class="line">          &#123;&#123; item.title&#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">// 构建 menu 数据源</span><br><span class="line">const menuArr = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: 0,</span><br><span class="line">    title: &#x27;个人资料&#x27;,</span><br><span class="line">    icon: &#x27;profile&#x27;,</span><br><span class="line">    path: &#x27;/profile&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: 1,</span><br><span class="line">    title: &#x27;升级 VIP&#x27;,</span><br><span class="line">    icon: &#x27;vip-profile&#x27;,</span><br><span class="line">    path: &#x27;/member&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: 2,</span><br><span class="line">    title: &#x27;退出登录&#x27;,</span><br><span class="line">    icon: &#x27;logout&#x27;,</span><br><span class="line">    path: &#x27;&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="18、响应式下-navigationBar-的实现"><a href="#18、响应式下-navigationBar-的实现" class="headerlink" title="18、响应式下 navigationBar 的实现"></a>18、响应式下 navigationBar 的实现</h3><h4 id="实现方案分析"><a href="#实现方案分析" class="headerlink" title="实现方案分析"></a>实现方案分析</h4><p>通常情况下 复杂功能的响应式处理，一般有三种处理方案:</p>
<ol>
<li>一套代码处理多端：<ol>
<li>优势：代码量相对比较少</li>
<li>劣势：耦合性强，不利于后期维护</li>
</ol>
</li>
<li>多套代码分别处理各端：<ol>
<li>优势：逻辑清晰</li>
<li>劣势：可能会产生很多重复的逻辑</li>
</ol>
</li>
<li>结合以上两种方案，<strong>抽离公用逻辑，封装私有逻辑</strong>：<ol>
<li>优势：结合以上两点优势</li>
<li>劣势：需要对业务和逻辑足够清楚<br>项目 navigationBar 通过第三种方式来去进行实现。</li>
</ol>
</li>
</ol>
<p>一个功能由两部分组成：数据 和 视图</p>
<ol>
<li>数据<br> 移动端和 PC端的数据是一样的，这一块是完全可以复用的。目前的数据是通过 <code>src/views/main/components/navigation/index.vue</code> 获取，然后进行传递的。那么进行数据的复用，如果一直进行数据传递的话，未免有些过于复杂了。所以对于数据，可以直接通过<code>vuex</code>来封装这一系列的 <strong>获取、切换</strong> 行为。</li>
<li><p>视图<br> 移动端和 PC端的视图在展示中的逻辑具备较大差异，为了综合可维护性，视图逻辑部分我们期望单独封装到各自的组件中来进行处理。</p>
<p>navigationBar 的公有和私有部分：</p>
<ol>
<li>数据为公有数据，可以在 vuex 中进行抽离处理。</li>
<li>视图为私有部分，需要在各自的组件中进行单独处理。</li>
</ol>
</li>
</ol>
<h4 id="在vuex中封装数据"><a href="#在vuex中封装数据" class="headerlink" title="在vuex中封装数据"></a>在<code>vuex</code>中封装数据</h4><ol>
<li><code>store\index.js</code>完成vuex初始化</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&#x27;./modules/category&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    category</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<ol>
<li><code>main.js</code>中注册</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useREM</span>()</span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">use</span>(store).<span class="title function_">use</span>(mLibs).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>新建<code>store\modules\category.js</code>处理 navigationBar 中的数据 categorys</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getCategory &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/category&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ALL_CATEGORY_ITEM</span>, <span class="variable constant_">CATEGORY_NOMAR_DATA</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// navigationBar 展示的数据源</span></span><br><span class="line">    <span class="attr">categorys</span>: <span class="variable constant_">CATEGORY_NOMAR_DATA</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为 categorys 赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">setCategorys</span>(<span class="params">state, categorys</span>) &#123;</span><br><span class="line">      state.<span class="property">categorys</span> = [<span class="variable constant_">ALL_CATEGORY_ITEM</span>, ...categorys]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取 category 数据，并自动保存到 vuex 中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">useCategoryData</span>(<span class="params">context</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; categorys &#125; = <span class="keyword">await</span> <span class="title function_">getCategory</span>()</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;setCategorys&#x27;</span>, categorys)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><code>store\getters.js</code>实现简单访问</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 简单访问</span></span><br><span class="line">    <span class="attr">categorys</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">category</span>.<span class="property">categorys</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>将<code>mobile\index.vue</code>和<code>navigation\index.vue</code>使用categorys数据的地方更换为<code>$store.getters.categorys</code></p>
<p><code>navigation\index.vue</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;mobileNavigationVue v-if=&quot;isMobileTerminal&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import mobileNavigationVue from &#x27;./mobile/index.vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">const store = useStore()</span><br><span class="line">// 触发 category 数据获取动作</span><br><span class="line">store.dispatch(&#x27;category/useCategoryData&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><code>mobile\index.vue</code>：</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;bg-white sticky top-0 left-0 z-10&quot;&gt;</span><br><span class="line">    &lt;ul</span><br><span class="line">        ref=&quot;ulTarget&quot;</span><br><span class="line">        class=&quot;relative flex overflow-x-auto p-1 text-xs text-zinc-600 overflow-hidden&quot; </span><br><span class="line">    &gt; </span><br><span class="line">        &lt;!-- 顶部分类导航条 - item --&gt;</span><br><span class="line">        &lt;li </span><br><span class="line">            v-for=&quot;(item, index) in $store.getters.categorys&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            class=&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span><br><span class="line">            :class=&quot;&#123;&#x27;text-zinc-100&#x27; : currentCategoryIndex === index&#125;&quot;</span><br><span class="line">            :ref=&quot;setItemRef&quot;</span><br><span class="line">            @click=&quot;onItemClick(index)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">            &#123;&#123; item.name &#125;&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;!-- 顶部导航条右侧 汉堡按钮 - 弹出层 --&gt;</span><br><span class="line">    &lt;m-popup v-model=&quot;isVisable&quot;&gt;</span><br><span class="line">        &lt;MenuVue @onItemClick=&quot;onItemClick&quot;&gt;&lt;/MenuVue&gt;</span><br><span class="line">    &lt;/m-popup&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onBeforeUpdate, watch &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; useScroll &#125; from &#x27;@vueuse/core&#x27;;</span><br><span class="line">import MenuVue from &#x27;@/view/main/components/menu/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="PC端下的基本展示"><a href="#PC端下的基本展示" class="headerlink" title="PC端下的基本展示"></a>PC端下的基本展示</h4><p><code>navigation\pc\index.vue</code>中实现基本布局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;bg-white dark:bg-zinc-800 duration-500 sticky top-0 left-0 w-full z-10&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;ul</span><br><span class="line">        class=&quot;w-[800px] relative flex flex-wrap justify-center overflow-x-auto px-[10px] py-1 text-xs text-zinc-600 duration-300 overflow-hidden mx-auto&quot;</span><br><span class="line">        :class=&quot;[isOpenCategoty ? &#x27;h-[206px]&#x27; : &#x27;h-[56px]&#x27;]&quot;</span><br><span class="line">      &gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- lg 下展开箭头 --&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&quot;absolute right-1 bottom-1 z-20 p-1 rounded cursor-pointer duration-200 hover:bg-zinc-200 dark:hover:bg-zinc-900&quot;</span><br><span class="line">          @click=&quot;triggerState&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            :name=&quot;isOpenCategoty ? &#x27;fold&#x27; : &#x27;unfold&#x27;&quot;</span><br><span class="line">            class=&quot;w-1 h-1&quot;</span><br><span class="line">            fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- category item --&gt;</span><br><span class="line">        &lt;li</span><br><span class="line">          v-for=&quot;(item, index) in $store.getters.categorys&quot;</span><br><span class="line">          :key=&quot;item.id&quot;</span><br><span class="line">          class=&quot;shrink-0 px-1.5 py-0 z-10 duration-200 last:mr-4 text-zinc-900 dark:text-zinc-500 dark:hover:text-zinc-300 text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900 rounded mr-1 mb-1&quot;</span><br><span class="line">          :class=&quot;&#123;</span><br><span class="line">            &#x27;text-zinc-900 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-900&#x27;:</span><br><span class="line">              $store.getters.currentCategoryIndex === index</span><br><span class="line">          &#125;&quot;</span><br><span class="line">          @click=&quot;onItemClick(item)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; item.name &#125;&#125;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;script setup&gt;</span><br><span class="line">  import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">  import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">  </span><br><span class="line">  const store = useStore()</span><br><span class="line">  </span><br><span class="line">  /**</span><br><span class="line">   * 状态切换处理 - 展开 收起</span><br><span class="line">   */</span><br><span class="line">  const isOpenCategoty = ref(false)</span><br><span class="line">  const triggerState = () =&gt; &#123;</span><br><span class="line">    isOpenCategoty.value = !isOpenCategoty.value</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  /**</span><br><span class="line">   * 选中状态处理 - 高亮</span><br><span class="line">   */</span><br><span class="line">  const currentCategoryIndex = ref(0)</span><br><span class="line">  const onItemClick = (index) =&gt; &#123;</span><br><span class="line">    currentCategoryIndex.value = index</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>在<code>navigation\index.vue</code>进行按需渲染</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;mobileNavigationVue v-if=&quot;isMobileTerminal&quot; /&gt;</span><br><span class="line">    &lt;pcNavigationVue v-else /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import mobileNavigationVue from &#x27;./mobile/index.vue&#x27;</span><br><span class="line">import pcNavigationVue from &#x27;./pc/index.vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line"></span><br><span class="line">const store = useStore()</span><br><span class="line">// 触发 category 数据获取动作</span><br><span class="line">store.dispatch(&#x27;category/useCategoryData&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><code>layout\components\main.vue</code>中指定pc端下二级路由出口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>在<code>router\modules\pc-route.js</code>中添加路由路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/layout/index.vue&#x27;</span>),</span><br><span class="line">        <span class="attr">children</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">                <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/main/index.vue&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="解决闪烁问题"><a href="#解决闪烁问题" class="headerlink" title="解决闪烁问题"></a>解决闪烁问题</h4><p>​    在用户刷新页面时，PC端<code>navigationBar</code>会出现闪动的情况，即一开始只出现<code>全部</code>,随之（获取完数据）才会展示<code>全部</code>和所有分类。</p>
<p><strong>问题原因</strong>：<code>navigationBar</code>的数据是从服务端来进行获取的，在最初渲染页面时，一开始展示的是<code>vuex</code>中保存的最初的<code>category</code>数据，而最初的<code>category</code>数据只有一个<code>全部</code>，展示完之后就会尝试从服务端获取数据，在数据获取完成之后，才会展示所有内容。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li><p>让 categorys 具备一个初始化数据</p>
</li>
<li><p>从服务端获取数据，替换初始化数据</p>
</li>
<li><p>为了防止初始化数据太老，把每次获取到的新数据，都作为下一<br> 次的初始化数据</p>
<p>第三步方案：每次从接口得到的数据，进行缓存。在下次运行时，把缓存的数据作为初始值</p>
</li>
</ol>
<p>在<code>constants\index.js</code>中构建<code>category</code>的初始化数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// category 的本地构建数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ALL_CATEGORY_ITEM</span> = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;全部&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//  category 的初始化数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">CATEGORY_NOMAR_DATA</span> = [</span><br><span class="line">    <span class="variable constant_">ALL_CATEGORY_ITEM</span>,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">&#x27;web_app_icon&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;UI/UX&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">&#x27;design&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;平面&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">&#x27;illustration&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;插画/漫画&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">&#x27;photography&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;摄影&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">&#x27;games&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;游戏&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="string">&#x27;anime&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;动漫&#x27;</span> &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;industrial_design&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;工业设计&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;industrial_design&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;建筑设计&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;industrial_design&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;人文艺术&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;industrial_design&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;家居/家装&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>
<p><code>store\modules\category.js</code>中将<code>categorys: ALL_CATEGORY_ITEM</code>修改为<code>categorys: CATEGORY_NOMAR_DATA</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getCategory &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/category&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ALL_CATEGORY_ITEM</span>, <span class="variable constant_">CATEGORY_NOMAR_DATA</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 独立作用域</span></span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// navigationBar 展示的数据源</span></span><br><span class="line">    <span class="attr">categorys</span>: <span class="variable constant_">CATEGORY_NOMAR_DATA</span></span><br><span class="line">  &#125;),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据上述解决方案中的第三步，使用<code>vuex-persistedstate</code>  将每次从接口得到的数据，进行缓存。在下次运行时，把缓存的数据作为初始值</p>
<p>第三方插件：<a target="_blank" rel="noopener" href="https://github.com/robinvdvleuten/vuex-persistedstate">vuex-persistedstate</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm install <span class="literal">--save</span> vuex<span class="literal">-persistedstate</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&#x27;./modules/category&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createPersistedState <span class="keyword">from</span> <span class="string">&#x27;vuex-persistedstate&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    category</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;imooc-front&#x27;</span>, <span class="comment">// 保存到 localStorage 中的 key</span></span><br><span class="line">      <span class="attr">paths</span>: [<span class="string">&#x27;category&#x27;</span>]<span class="comment">// 需要保存的模块</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<h3 id="19、实现主题切换"><a href="#19、实现主题切换" class="headerlink" title="19、实现主题切换"></a>19、实现主题切换</h3><p>原理： <strong>通过类名的切换使html元素在不同类名下展示不同的样式（主题）</strong></p>
<p><strong>实现思路</strong>：（此方案基于tailwindcss插件）</p>
<ul>
<li><p>1、将当前主题类型存储在vuex中</p>
</li>
<li><p>2、当切换主题时修改vuex中的主题类型</p>
</li>
<li><p>3、监听主题类型的变化： theme-light 、 theme-dark 、theme-system、给html标签动态设置class的属性值</p>
</li>
<li><p>4、html的class属性值变化后会匹配到对应主题的class、从而展示出来对应的主题的颜色</p>
</li>
<li><p>5、给标签设置两套的类名：白色一套、暗色一套</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bg-zinc-300 dark:bg-zinc-900&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="极简白和极夜黑"><a href="#极简白和极夜黑" class="headerlink" title="极简白和极夜黑"></a>极简白和极夜黑</h4><p>vuex中配置<code>store\modules\theme.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">THEME_LIGHT</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 当前主题模式</span></span><br><span class="line">    <span class="attr">themeType</span>: <span class="variable constant_">THEME_LIGHT</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">//  切换主题模式</span></span><br><span class="line">    <span class="title function_">changeThemeType</span>(<span class="params">state, newTheme</span>) &#123;</span><br><span class="line">      state.<span class="property">themeType</span> = newTheme</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>store\index.js</code>中注册<code>theme</code>模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&#x27;./modules/category&#x27;</span></span><br><span class="line"><span class="keyword">import</span> theme <span class="keyword">from</span> <span class="string">&#x27;./modules/theme&#x27;</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&#x27;./getters&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createPersistedState <span class="keyword">from</span> <span class="string">&#x27;vuex-persistedstate&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    category,theme</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;imooc-front&#x27;</span>, <span class="comment">// 保存到 localStorage 中的 key</span></span><br><span class="line">      <span class="attr">paths</span>: [<span class="string">&#x27;category&#x27;</span>, <span class="string">&#x27;theme&#x27;</span>]<span class="comment">// 需要保存的模块</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<p>在<code>store\getter.js</code>中创建当前主题的快捷访问</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 简单访问</span></span><br><span class="line">    <span class="attr">categorys</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">category</span>.<span class="property">categorys</span>,</span><br><span class="line">    <span class="attr">theme</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">theme</span>.<span class="property">themeType</span>, <span class="comment">//当前主题</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.监听主题的切换行为<br>2.根据行为保存当前需要展示的主题到 vuex 中<br>3.根据 vuex 中保存的当前主题，展示 header-theme 下的显示图标<br>4.根据 vuex 中保存的当前主题，修改 html的 class</p>
<p><strong>header-theme.vue</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover placement=&quot;bottom-left&quot;&gt;</span><br><span class="line">    &lt;!-- 具名插槽：触发弹层的视图 --&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        :name=&quot;svgIconName&quot;</span><br><span class="line">        class=&quot;guide-theme w-4 h-4 p-1 cursor-pointer rounded-sm duration-200 outline-none hover:bg-zinc-100/60 dark:hover:bg-zinc-900&quot;</span><br><span class="line">        fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 匿名插槽：弹出层视图中展示的内容 --&gt;</span><br><span class="line">    &lt;div class=&quot;w-[140px] overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;flex items-center p-1 cursor-pointer rounded hover:bg-zinc-100/60 dark:hover:bg-zinc-800&quot;</span><br><span class="line">        v-for=&quot;item in themeArr&quot;</span><br><span class="line">        :key=&quot;item.id&quot;</span><br><span class="line">        @click=&quot;onItemClick(item)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          :name=&quot;item.icon&quot;</span><br><span class="line">          class=&quot;w-1.5 h-1.5 mr-1&quot;</span><br><span class="line">          fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;span class=&quot;text-zinc-800 dark:text-zinc-300 text-sm&quot;&gt;</span><br><span class="line">          &#123;&#123; item.name &#125;&#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; THEME_DARK, THEME_LIGHT, THEME_SYSTEM &#125; from &#x27;@/constants&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">// 构建渲染数据源</span><br><span class="line">const themeArr = [</span><br><span class="line">  &#123;</span><br><span class="line">    id: &#x27;0&#x27;,</span><br><span class="line">    type: THEME_LIGHT,</span><br><span class="line">    icon: &#x27;theme-light&#x27;,</span><br><span class="line">    name: &#x27;极简白&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: &#x27;1&#x27;,</span><br><span class="line">    type: THEME_DARK,</span><br><span class="line">    icon: &#x27;theme-dark&#x27;,</span><br><span class="line">    name: &#x27;极夜黑&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    id: &#x27;2&#x27;,</span><br><span class="line">    type: THEME_SYSTEM,</span><br><span class="line">    icon: &#x27;theme-system&#x27;,</span><br><span class="line">    name: &#x27;跟随系统&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">// 1.监听主题的切换行为</span><br><span class="line">// 2.根据行为保存当前需要展示的主题到 vuex 中</span><br><span class="line">// 3.根据 vuex 中保存的当前主题，展示 header-theme 下的显示图标</span><br><span class="line">// 4.根据 vuex 中保存的当前主题，修改 html的 class</span><br><span class="line"></span><br><span class="line">// 控制图标展示</span><br><span class="line">const store = useStore()</span><br><span class="line">const svgIconName = computed(() =&gt; &#123;</span><br><span class="line">  // 根据当前的 themeType 返回当前的选中 icon</span><br><span class="line">  const findTheme = themeArr.find((theme) =&gt; &#123;</span><br><span class="line">    return theme.type === store.getters.themeType</span><br><span class="line">  &#125;)</span><br><span class="line">  return findTheme?.icon || themeArr[0].type</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// menu 切换事件</span><br><span class="line">const onItemClick = (theme) =&gt; &#123;</span><br><span class="line">  store.commit(&#x27;theme/changeThemeType&#x27;, theme.type)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>在<strong>utils/theme.js</strong>中创建工具类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">THEME_LIGHT</span>, <span class="variable constant_">THEME_DARK</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化主题</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1.当主题发生改变时，或者当进入系统时，可以进行 html class 的配置</span></span><br><span class="line">  <span class="title function_">watch</span>(<span class="function">() =&gt;</span> </span><br><span class="line">    store.<span class="property">getters</span>.<span class="property">themeType</span>, </span><br><span class="line">    <span class="function">(<span class="params">theme</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// html 的 class</span></span><br><span class="line">      <span class="keyword">let</span> themeClassName = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">switch</span> (theme) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="attr">THEME_LIGHT</span>:</span><br><span class="line">          themeClassName = <span class="string">&#x27;light&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="attr">THEME_DARK</span>:</span><br><span class="line">          themeClassName = <span class="string">&#x27;dark&#x27;</span></span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 修改 html 的 class</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>).<span class="property">className</span> = themeClassName</span><br><span class="line">  	&#125;, &#123;</span><br><span class="line">      <span class="attr">immediate</span>: <span class="literal">true</span> <span class="comment">// 初始执行一次</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="跟随系统变更主题"><a href="#跟随系统变更主题" class="headerlink" title="跟随系统变更主题"></a>跟随系统变更主题</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia">Window.matchMedia()</a>方法返回一个新的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaQueryList"><code>MediaQueryList</code></a> 对象，表示指定的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries">媒体查询 (en-US)</a>字符串解析后的结果。返回的<code>MediaQueryList</code> 可被用于判定<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a>是否匹配媒体查询，或者监控一个<code>document</code> 来判定它匹配了或者停止匹配了此媒体查询。</p>
<p>可以使用返回的媒体查询来执行即时检查和事件驱动检查，以查看文档是否与媒体查询匹配。</p>
<p>要执行一次瞬时检查以查看文档是否与媒体查询匹配，请查看<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaQueryList/matches"><code>matches</code></a>属性的值，当 document 满足媒体查询条件的时候将会返回<code>true</code>。</p>
<p>想要生成跟随系统的主题变更，就需要 <strong>监听系统的主题变化</strong>。可以利用<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia">Window.matchMedia()</a>方法，该方法接收一个 <code>mediaQueryString</code>(<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries">媒体查询 (en-US)</a>解析的字符串)，该字符串可以传递 prefers-color-scheme，即 <code>window.matchMedia(&#39;(prefers-color-scheme: dark)&#39;)</code>方法<br>该方法可以返回一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaQueryList"><code>MediaQueryList</code></a>  对象：</p>
<ol>
<li><p>该对象存在一个 shange 事件，可以监听 主题发生变更 的行为。</p>
</li>
<li><p>同时存在一个 matches 属性，该属性为 boolean 性的值:</p>
<ol>
<li><p>true ：深色主题</p>
</li>
<li><p>false ：浅色主题</p>
</li>
</ol>
</li>
</ol>
<p>那么据此，可生成以下代码。在<code>src/utils/theme.js</code> 中:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; watch &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">THEME_LIGHT</span>, <span class="variable constant_">THEME_DARK</span>, <span class="variable constant_">THEME_SYSTEM</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听系统主题变更</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> matchMedia</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">watchSystemThemeChange</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 仅需初始化一次即可</span></span><br><span class="line">  <span class="keyword">if</span> (matchMedia) <span class="keyword">return</span></span><br><span class="line">  matchMedia = <span class="variable language_">window</span>.<span class="title function_">matchMedia</span>(<span class="string">&#x27;(prefers-color-scheme: dark)&#x27;</span>)</span><br><span class="line">  <span class="comment">// 监听主题变更</span></span><br><span class="line">  matchMedia.<span class="property">onchange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">changeTheme</span>(<span class="variable constant_">THEME_SYSTEM</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 变更主题</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; theme 主题的标记常量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeTheme</span> = (<span class="params">theme</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> themeClassName = <span class="string">&#x27;&#x27;</span> <span class="comment">// html 的 class</span></span><br><span class="line">  <span class="keyword">switch</span> (theme) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_LIGHT</span>:</span><br><span class="line">      themeClassName = <span class="string">&#x27;light&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_DARK</span>:</span><br><span class="line">      themeClassName = <span class="string">&#x27;dark&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="attr">THEME_SYSTEM</span>:</span><br><span class="line">      <span class="comment">// 调用方法，监听系统主题变化</span></span><br><span class="line">      <span class="title function_">watchSystemThemeChange</span>()</span><br><span class="line">      themeClassName = matchMedia.<span class="property">matches</span> ? <span class="string">&#x27;dark&#x27;</span> : <span class="string">&#x27;light&#x27;</span></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 修改 html 的 class</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;html&#x27;</span>).<span class="property">className</span> = themeClassName</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化主题</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1.当主题发生改变时，或者当进入系统时，可以进行 html class 的配置</span></span><br><span class="line">  <span class="title function_">watch</span>(<span class="function">() =&gt;</span> </span><br><span class="line">    store.<span class="property">getters</span>.<span class="property">themeType</span>,</span><br><span class="line">    changeTheme,</span><br><span class="line">    &#123; <span class="comment">// 初始执行一次</span></span><br><span class="line">      <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="20、实现瀑布流布局"><a href="#20、实现瀑布流布局" class="headerlink" title="20、实现瀑布流布局"></a>20、实现瀑布流布局</h3><h4 id="构建基础列表展示"><a href="#构建基础列表展示" class="headerlink" title="构建基础列表展示"></a>构建基础列表展示</h4><p><code>api\pexels.js</code>获取图片列表数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取图片数据列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPexelsList</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pexels/list&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建<code>view\main\components\list</code>下的<code>item.vue</code>和<code>index.vue</code></p>
<p><code>index.vue</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;item-vue v-for=&quot;item in pexelsList&quot; :key=&quot;item.id&quot; :data=&quot;item&quot;&gt;&lt;/item-vue&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; getPexelsList &#125; from &#x27;@/api/pexels&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import itemVue from &#x27;./item.vue&#x27;</span><br><span class="line"></span><br><span class="line">// 构建数据请求</span><br><span class="line">let query = &#123;</span><br><span class="line">  page: 1,</span><br><span class="line">  size: 20,</span><br><span class="line">  categoryId: &#x27;&#x27;,</span><br><span class="line">  searchText: &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 加载数据的方法</span><br><span class="line">const pexelsList = ref([]) // 数据源</span><br><span class="line">const getPexelsData = async () =&gt; &#123;</span><br><span class="line">  const res = await getPexelsList(query)</span><br><span class="line">  pexelsList.value = res.list</span><br><span class="line">&#125;</span><br><span class="line">getPexelsData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p><code>item.vue</code>：单个图片的样式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;bg-white dark:bg-zinc-900 xl:dark:bg-zinc-800 rounded pb-1&quot; h-[280px] w-[230px]&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;relative w-full rounded cursor-zoom-in group&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 图片 --&gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          class=&quot;w-full rounded bg-transparent&quot;</span><br><span class="line">          :src=&quot;data.photo&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;!-- 遮罩层 --&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&quot;hidden opacity-0 w-full h-full bg-zinc-900/50 absolute top-0 left-0 rounded duration-300 group-hover:opacity-100 xl:block&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;!-- 图片内按钮 - 分享 --&gt;</span><br><span class="line">          &lt;m-button class=&quot;absolute top-1.5 left-1.5&quot; @click=&quot;onShareClick&quot;&gt;</span><br><span class="line">            分享</span><br><span class="line">          &lt;/m-button&gt;</span><br><span class="line">          &lt;!-- 图片内按钮 - 点赞 --&gt;</span><br><span class="line">          &lt;m-button</span><br><span class="line">            class=&quot;absolute top-1.5 right-1.5&quot;</span><br><span class="line">            type=&quot;info&quot;</span><br><span class="line">            icon=&quot;heart&quot;</span><br><span class="line">            iconClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;!-- 图片内按钮 - 下载 --&gt;</span><br><span class="line">          &lt;m-button</span><br><span class="line">            class=&quot;absolute bottom-1.5 left-1.5 bg-zinc-100/70&quot;</span><br><span class="line">            type=&quot;info&quot;</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            icon=&quot;download&quot;</span><br><span class="line">            iconClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">            @click=&quot;onDownload&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;!-- 图片内按钮 - 全屏 --&gt;</span><br><span class="line">          &lt;m-button</span><br><span class="line">            class=&quot;absolute bottom-1.5 right-1.5 bg-zinc-100/70&quot;</span><br><span class="line">            type=&quot;info&quot;</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            icon=&quot;full&quot;</span><br><span class="line">            iconClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">            @click=&quot;onImgFullScreen&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 标题 --&gt;</span><br><span class="line">      &lt;p</span><br><span class="line">        class=&quot;text-sm mt-1 font-bold text-zinc-900 dark:text-zinc-300 line-clamp-2 px-1&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123; data.title &#125;&#125;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;!-- 作者：头像 姓名 --&gt;</span><br><span class="line">      &lt;div class=&quot;flex items-center mt-1 px-1&quot;&gt;</span><br><span class="line">        &lt;img v-lazy class=&quot;h-2 w-2 rounded-full&quot; :src=&quot;data.avatar&quot; alt=&quot;&quot; /&gt;</span><br><span class="line">        &lt;span class=&quot;text-sm text-zinc-500 ml-1&quot;&gt;</span><br><span class="line">            &#123;&#123; data.author &#125;&#125;</span><br><span class="line">    	&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">defineProps(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        type: Object,</span><br><span class="line">        required: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>在<code>view\main\index.vue</code>导入<code>item.vue</code>和<code>index.vue</code>组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div </span><br><span class="line">      class=&quot;h-full overflow-auto bg-white dark:bg-zinc-800 duration-500 scrollbar-thin scrollbar-thumb-transparent xl:scrollbar-thumb-zinc-200 xl:dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&quot;</span><br><span class="line">      ref=&quot;containerTarget&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;navigationVue /&gt;</span><br><span class="line">      &lt;div class=&quot;max-w-screen-xl mx-auto relative m-1 xl:mt-4&quot;&gt;</span><br><span class="line">        &lt;list-vue&gt;&lt;/list-vue&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import navigationVue from &#x27;./components/navigation/index.vue&#x27;</span><br><span class="line">import listVue from &#x27;./components/list/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="瀑布流组件构建分析"><a href="#瀑布流组件构建分析" class="headerlink" title="瀑布流组件构建分析"></a>瀑布流组件构建分析</h4><p>目前图片列表组件展示存在的问题就是：<strong>每个 item 应该横向排列，第二行的 item 顺序连接到当前最短的列中</strong>，而这个就是构建瀑布流的核心逻辑。<br>想要实现这个核心逻辑，每个 item 就不能使用正常的布局方式，而必须使用 absolute 绝对布局，并通过 top 和left 来手动控制位置,</p>
<p>那么我们期望，将来这个通用组件可以这样使用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall</span><br><span class="line">  :data=&quot;&quot; //数据源</span><br><span class="line">  :nodeKey=&quot;&quot; // 唯一标识的Key</span><br><span class="line">  :column=&quot;&quot; // 渲染的列数</span><br><span class="line">  :picturePreReading=&quot;&quot; // 是否需要图片预渲染(在不知道图片的高度的情况下)</span><br><span class="line">&gt;</span><br><span class="line">  &lt;template v-slot=&quot;&#123; item, width &#125;&quot;&gt;</span><br><span class="line">    // 对应的item </span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/m-waterfall&gt;</span><br></pre></td></tr></table></figure>
<p>综合起来，整个的一个瀑布流组件的构建需要分成几部分：</p>
<ol>
<li>通过 props 传递关键数据(部分)<ol>
<li>data：数据源</li>
<li>nodeKey：唯一标识</li>
<li>column：渲染的列数</li>
<li>picturePreReading：是否需要图片预渲染</li>
</ol>
</li>
<li>瀑布流渲染机制:通过 absolute 配合 relative 完成布局，布局逻辑为：<strong>每个 item 应该横向排列，第二行的item 顺序连接到当前最短的列中</strong></li>
<li>通过 <strong>作用域插槽</strong> 将每个 item 中涉及到的关键数据，传递到 item 视图中</li>
</ol>
<h4 id="获取容器宽度和列宽"><a href="#获取容器宽度和列宽" class="headerlink" title="获取容器宽度和列宽"></a>获取容器宽度和列宽</h4><ol>
<li>创建<code>libs\waterfall\index.vue</code>组件，并创建如下<code>props</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">// 数据源</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 唯一标识的 key</span></span><br><span class="line">  <span class="attr">nodeKey</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 列数</span></span><br><span class="line">  <span class="attr">column</span>: &#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 列间距</span></span><br><span class="line">  <span class="attr">columnSpacing</span>: &#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 行间距</span></span><br><span class="line">  <span class="attr">rowSpacing</span>: &#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 是否需要进行图片预读取</span></span><br><span class="line">  <span class="attr">picturePreReading</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>构建对应的基础视图</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;relative&quot;</span><br><span class="line">    ref=&quot;containerTarget&quot;</span><br><span class="line">    :style=&quot;&#123;</span><br><span class="line">      height: containerHeight + &#x27;px&#x27; // 因为是 relative 布局，需要主动指定高度</span><br><span class="line">    &#125;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 因为列数不确定，需要根据列数计算每列的宽度，所以等待列宽计算完成，并且有了数据源之后进行渲染 --&gt;</span><br><span class="line">    &lt;template v-if=&quot;columnWidth &amp;&amp; data.length&quot;&gt;</span><br><span class="line">      &lt;!-- 通过动态的 style 来去计算对应的列宽、left、top --&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;m-waterfall-item absolute duration-300&quot;</span><br><span class="line">        :style=&quot;&#123;</span><br><span class="line">          width: columnWidth + &#x27;px&#x27;,</span><br><span class="line">          left: item._style?.left + &#x27;px&#x27;,</span><br><span class="line">          top: item._style?.top + &#x27;px&#x27;</span><br><span class="line">        &#125;&quot;</span><br><span class="line">        v-for=&quot;(item, index) in data&quot;</span><br><span class="line">        :key=&quot;nodeKey ? item[nodeKey] : index&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;slot :item=&quot;item&quot; :width=&quot;columnWidth&quot; :index=&quot;index&quot; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;!-- 可以给一个加载中的描述，没有也无所谓 --&gt;</span><br><span class="line">    &lt;div v-else&gt;加载中...&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>根据以上的基础视图，我们需要生成对应的：<pre><code>1. `containerHeight`：总高度
2. `columnWidth`：列宽
3. `item._style.left`：每个item 对应的 left
4. `item._style.right`：每个item 对应的 right
</code></pre></li>
<li>要计算 <strong>总高度</strong>，需要计算出 <strong>每一列的高度</strong>，最高的一列为 <strong>总高度</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 容器的总高度 = 最高的这一列的高度</span></span><br><span class="line"><span class="keyword">const</span> containerHeight = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">// 记录每列高度的容器。key：所在列  val：列高</span></span><br><span class="line"><span class="keyword">const</span> columnHeightObj = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建记录各列的高度的对象。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useColumnHeightObj</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  columnHeightObj.<span class="property">value</span> = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; props.<span class="property">column</span>; i++) &#123;</span><br><span class="line">    columnHeightObj.<span class="property">value</span>[i] = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>要计算列宽，那么首先需要有容器的总宽度：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 容器实例</span></span><br><span class="line"><span class="keyword">const</span> containerTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="comment">// 容器总宽度(不包含 padding、margin、border)</span></span><br><span class="line"><span class="keyword">const</span> containerWidth = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">// 容器左边距，计算 item left 时，需要使用定位</span></span><br><span class="line"><span class="keyword">const</span> containerLeft = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算容器宽度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useContainerWidth</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; paddingLeft, paddingRight &#125; = <span class="title function_">getComputedStyle</span>(containerTarget.<span class="property">value</span>, <span class="literal">null</span>)</span><br><span class="line">  <span class="comment">// 容器左边距</span></span><br><span class="line">  containerLeft.<span class="property">value</span> = <span class="built_in">parseFloat</span>(paddingLeft)</span><br><span class="line">  <span class="comment">// 容器宽度</span></span><br><span class="line">  containerWidth.<span class="property">value</span> =</span><br><span class="line">    containerTarget.<span class="property">value</span>.<span class="property">offsetWidth</span> - <span class="built_in">parseFloat</span>(paddingLeft) - <span class="built_in">parseFloat</span>(paddingRight)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>计算列宽</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算列宽 = （容器的宽度 - 所有的列间距宽度）/ 列数</span></span><br><span class="line"><span class="keyword">const</span> columnWidth = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="comment">// 列间距合计</span></span><br><span class="line"><span class="keyword">const</span> columnSpacingTotal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 如果是5列，则存在 4 个列间距</span></span><br><span class="line">  <span class="keyword">return</span> (props.<span class="property">column</span> - <span class="number">1</span>) * props.<span class="property">columnSpacing</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开始计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useColumnWidth</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useContainerWidth</span>() <span class="comment">// 获取容器宽度</span></span><br><span class="line">  <span class="comment">// 计算：列宽 = （容器的宽度 - 所有的列间距宽度）/ 列数</span></span><br><span class="line">  columnWidth.<span class="property">value</span> = (containerWidth.<span class="property">value</span> - columnSpacingTotal.<span class="property">value</span>) / props.<span class="property">column</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">useColumnWidth</span>() <span class="comment">// 计算列宽</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>此时，在 <code>src/views/main/components/ist/index.vue</code>中使用该组件，可以打印出计算的值</li>
</ol>
<h4 id="区分图片预加载"><a href="#区分图片预加载" class="headerlink" title="区分图片预加载"></a>区分图片预加载</h4><p>想要计算每列的 left、right ，需要拿到每个 item 的高度，只有有了每个 item 高，才可以判断下一列的第一个 item 的位置。<br>同时根据<code>pitturePreReading</code>又可以分为两种情况：</p>
<pre><code>1. 需要图片预加载时：图片高度未知
1. 不需要图片预加载时：图片高度已知
</code></pre><p><strong>需要图片预加载时</strong></p>
<ol>
<li>图片高度未知</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// item 高度集合</span></span><br><span class="line"><span class="keyword">let</span> itemHeights = []</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听图片加载完成</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">waitImgComplate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  itemHeights = []</span><br><span class="line">  <span class="comment">// 拿到所有元素</span></span><br><span class="line">  <span class="keyword">let</span> itemElements = [...<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;m-waterfall-item&#x27;</span>)]</span><br><span class="line">  <span class="comment">// 获取所有元素的 img 标签</span></span><br><span class="line">  <span class="keyword">const</span> imgElements = <span class="title function_">getImgElements</span>(itemElements)</span><br><span class="line">  <span class="comment">// 获取所有 img 标签的图片</span></span><br><span class="line">  <span class="keyword">const</span> allImgs = <span class="title function_">getAllImg</span>(imgElements)</span><br><span class="line">  <span class="title function_">onComplateImgs</span>(allImgs).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 图片加载完成，获取高度</span></span><br><span class="line">    itemElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">      itemHeights.<span class="title function_">push</span>(el.<span class="property">offsetHeight</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">useItemLocation</span>()<span class="comment">// 渲染位置</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>以上使用到了多个工具方法，可以创建 <code>src/libs/waterfalt/utils.js</code> 模块进行处理：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 itemElement 中抽离出所有的 imgElements</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getImgElements</span> = (<span class="params">itemElements</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> imgElements = []</span><br><span class="line">    itemElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">      imgElements.<span class="title function_">push</span>(...el.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;img&#x27;</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> imgElements</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 生成所有的图片链接数组</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getAllImg</span> = (<span class="params">imgElements</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> imgElements.<span class="title function_">map</span>(<span class="function">(<span class="params">imgElement</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> imgElement.<span class="property">src</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 监听图片数组加载完成（通过 promise 完成）</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">onComplateImgs</span> = (<span class="params">imgs</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> promiseAll = []<span class="comment">// promise 集合</span></span><br><span class="line">    <span class="comment">// 循环 imgs, 构建 promiseAll</span></span><br><span class="line">    imgs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">img, index</span>) =&gt;</span> &#123;</span><br><span class="line">      promiseAll[index] = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 处理 img 加载情况</span></span><br><span class="line">        <span class="keyword">const</span> imageObj = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">        imageObj.<span class="property">src</span> = img</span><br><span class="line">        imageObj.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(&#123; img, index &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(promiseAll)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><strong>不需要图片预加载时</strong>：</p>
<ol>
<li>图片高度已知</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图片不需要预加载时，计算 item 高度</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemHeight</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  itemHeights = []</span><br><span class="line">  <span class="comment">// 拿到所有元素</span></span><br><span class="line">  <span class="keyword">let</span> itemElements = [...<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;m-waterfall-item&#x27;</span>)]</span><br><span class="line">  <span class="comment">// 计算 item 高度</span></span><br><span class="line">  itemElements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 依据传入数据计算出的 img 高度</span></span><br><span class="line">    itemHeights.<span class="title function_">push</span>(el.<span class="property">offsetHeight</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="title function_">useItemLocation</span>()<span class="comment">// 渲染位置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>渲染位置：在<code>useItemLocation</code>方法中，打印所有的图片高度</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为每个 item 生成位置属性</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemLocation</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(itemHeights)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="计算定位item位置"><a href="#计算定位item位置" class="headerlink" title="*计算定位item位置"></a>*计算定位item位置</h4><ol>
<li>在 <code>useItemLocation</code> 方法中为每个item 定位位置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为每个 item 生成位置属性</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useItemLocation</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 遍历数据源</span></span><br><span class="line">  props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">_style</span>) <span class="keyword">return</span> <span class="comment">// 避免重复计算</span></span><br><span class="line">    item.<span class="property">_style</span> = &#123;&#125; <span class="comment">// 生成 _style 属性</span></span><br><span class="line">    item.<span class="property">_style</span>.<span class="property">left</span> = <span class="title function_">getItemLeft</span>() <span class="comment">// left</span></span><br><span class="line">    item.<span class="property">_style</span>.<span class="property">top</span> = <span class="title function_">getItemTop</span>() <span class="comment">// top</span></span><br><span class="line">    </span><br><span class="line">    <span class="title function_">increasingHeight</span>(index) <span class="comment">// 指定列高度自增</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 指定容器高度</span></span><br><span class="line">  containerHeight.<span class="property">value</span> = <span class="title function_">getMaxHeight</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建 <code>getItemLeft</code> 方法：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回下一个 item 的 left</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getItemLeft</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 最小高度所在的列 * (列宽 + 间距)</span></span><br><span class="line">  <span class="keyword">const</span> column = <span class="title function_">getMinHeightColumn</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    column * (columnWidth.<span class="property">value</span> + props.<span class="property">columnSpacing</span>) + containerLeft.<span class="property">value</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在 <code>utils</code> 中创建 <code>getMinHeightcolumn</code> 方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回列高对象中的最小高度所在的列</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMinHeightColumn</span> = (<span class="params">columnHeightObj</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> minHeight = <span class="title function_">getMinHeight</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(columnHeightObj).<span class="title function_">find</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> columnHeightObj[key] === minHeight</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建 <code>getItemTop</code> 方法:</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回下一个 item 的 top</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getItemTop</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 列高对象中的最小的高度</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">getMinHeight</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在 <code>utils</code> 中创建<code>getMinHeight</code>方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回列高对象中的最小的高度</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMinHeight</span> = (<span class="params">columnHeightObj</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> columnHeightArr = <span class="title class_">Object</span>.<span class="title function_">values</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(...columnHeightArr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建 <code>increasingHeight</code> 方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定列高度自增</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">increasingHeight</span> = (<span class="params">index</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 最小高度所在的列</span></span><br><span class="line">  <span class="keyword">const</span> minHeightColumn = <span class="title function_">getMinHeightColumn</span>(columnHeightObj.<span class="property">value</span>)</span><br><span class="line">  <span class="comment">// 该列高度自增</span></span><br><span class="line">  columnHeightObj.<span class="property">value</span>[minHeightColumn] +=</span><br><span class="line">    itemHeights[index] + props.<span class="property">rowSpacing</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在 <code>utils</code> 中创建 <code>getMaxHeight</code> 方法，作为容器高度</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回列高对象中的最大的高度</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getMaxHeight</span> = (<span class="params">columnHeightObj</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> columnHeightArr = <span class="title class_">Object</span>.<span class="title function_">values</span>(columnHeightObj)</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">max</span>(...columnHeightArr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8.在组件销毁时，清除所有的<code>_style</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在组件销毁时，清除所有的 _style</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">delete</span> item.<span class="property">_style</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="解决瀑布流展示不全"><a href="#解决瀑布流展示不全" class="headerlink" title="解决瀑布流展示不全"></a>解决瀑布流展示不全</h4><p>运行项目可以发现最底部的瀑布流元素无法展示完全。</p>
<p>出现这个问题的原因是因为在 <code>src/views/layout/index.vue</code> 中的 <code>h-main</code> 的高度，被子组件内部的 <code>h-full</code> 的<code>class</code> 给冲掉了。<br>为了防止以后还出现这样的情况，需要在 <code>src/views/layout/index.vue</code>中为 <code>main-vue</code> 外层包一个 <code>div</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;h-main&quot;&gt;</span><br><span class="line">  &lt;main-vue&gt;&lt;/main-vue&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h4 id="适配移动端，动态列"><a href="#适配移动端，动态列" class="headerlink" title="适配移动端，动态列"></a>适配移动端，动态列</h4><p>目前，瀑布流组件可以适配 PC 端，但是移动端，还存在一些问题，所以说，我们需要让我们的 瀑布流 组件可以适配移动端场景。</p>
<p>适配移动端，关键在于：</p>
<p><strong>列数的变化</strong></p>
<p>在<code>view/main/components/list/index.vue</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:column = <span class="string">&quot;isMobileTerminal ? 2 : 5&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>列宽和定位</strong></p>
<p>在<strong>列宽发生变化</strong>时，重新执行计算列宽：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 适应移动端：监听列数变化（2 || 5），重新构建瀑布流</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">useColumnWidth</span>() <span class="comment">// 重新计算列宽</span></span><br><span class="line">    <span class="comment">// 重置所有的定位数据，因为 data 中进行了深度监听，所以该操作会触发 data 的 watch</span></span><br><span class="line">    props.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      item.<span class="property">_style</span> = <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, <span class="number">100</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听列数变换</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> props.<span class="property">column</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>) &#123;</span><br><span class="line">      <span class="comment">// 在 picturePreReading 为 true 的前提下，需要首先为列宽滞空，列宽滞空之后，会取消瀑布流渲染</span></span><br><span class="line">      columnWidth.<span class="property">value</span> = <span class="number">0</span></span><br><span class="line">      <span class="comment">// 等待页面渲染之后，重新执行计算。否则在 item 没有指定过高度的前提下，计算出的 item 高度会不正确</span></span><br><span class="line">      <span class="title function_">reset</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>此时，在<code>src/views/main/components/list/index.vue</code> 中修改 <code>picturePreReading</code><br>为<code>true</code> ，表示等待图片硕加载。则 双端切换可以正常实现。</p>
<p>处理两个样式问题：</p>
<ol>
<li><p>移动端下<code>navigationBar</code>定位，在<code>App.vue</code>中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 一级路由出口 --&gt;</span><br><span class="line">&lt;!-- 设置导航条吸顶效果 --&gt;</span><br><span class="line">&lt;div class=&quot;h-screen fixed top-0 left-0 w-screen&quot;&gt;</span><br><span class="line">  &lt;router-view /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>移动端下列表的横向<code>padding</code>，<code>view/main/components/list/index.vue</code>中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-waterfall</span><br><span class="line">	...</span><br><span class="line">	class = &quot;w-full px-1&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="优化无需图片预加载时"><a href="#优化无需图片预加载时" class="headerlink" title="优化无需图片预加载时"></a>优化无需图片预加载时</h4><p>当设置<code>:picturePreReading=&quot;false&quot;</code>，不进行图片预加载时，在切换PC端和移动端时会出现图片重叠现象（图片高度计算出现错误）</p>
<p><strong>问题原因</strong>：不进行图片预加载时，会直接获取当前<code>item</code>的高度，因为没有等待图片加载完成，此时的高度是不包含图片的高度，从而使整个<code>item</code>高度计算错误。</p>
<p>服务端返回的图片接口数据是包含图片宽高<code>photoHeight</code>、<code>photoWidth</code>的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&quot;Uğurcan Özmen&quot;</span>,</span><br><span class="line">    <span class="attr">authorLike</span>: <span class="string">&quot;https://www.pexels.com/zh-cn/@ugurcan-ozmen-61083217&quot;</span>,</span><br><span class="line">    <span class="attr">avatar</span>: <span class="string">&quot;https://images.pexels.com/users/avatars/61083217/ugurcan-ozmen-235.jpeg?auto=compress&amp;fit=crop&amp;h=60&amp;w=60&quot;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;8051987&quot;</span>,</span><br><span class="line">    <span class="attr">photo</span>: <span class="string">&quot;https://images.pexels.com/photos/8051987/pexels-photo-8051987.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=1&amp;w=500&quot;</span></span><br><span class="line">    <span class="attr">photoHeight</span>: <span class="number">625</span>, <span class="comment">// 图片高度</span></span><br><span class="line">    <span class="attr">photoWidth</span>: <span class="number">500</span>, <span class="comment">//  图片宽度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>view/main/components/liat/index.vue</code>的作用域插槽返回了图片的宽度，将它传入<code>itemVue</code>里：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template v-slot=&quot;&#123; item, width &#125;&quot;&gt;</span><br><span class="line">  &lt;itemVue :data=&quot;item&quot; :width=&quot;width&quot; /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>在<code>list/item.vue</code>中接收传入的宽度：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">    ...,</span><br><span class="line">    <span class="attr">width</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>并利用宽度生成网页图片高度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;img</span><br><span class="line">  ....</span><br><span class="line">  :style=&quot;&#123;</span><br><span class="line">    // 计算后的图片高度 = （计算得到宽度/图片真实宽度）* 图片真实高度</span><br><span class="line">    height: (width / data.photoWidth) * data.photoHeight + &#x27;px&#x27;</span><br><span class="line">  &#125;&quot;</span><br></pre></td></tr></table></figure>
<p>重新监听列数变换，增加图片不进行预加载的情况：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> props.<span class="property">column</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">picturePreReading</span>) &#123;</span><br><span class="line">      <span class="comment">// 在 picturePreReading 为 true 的前提下，需要首先为列宽滞空，列宽滞空之后，会取消瀑布流渲染</span></span><br><span class="line">      columnWidth.<span class="property">value</span> = <span class="number">0</span></span><br><span class="line">      <span class="comment">// 等待页面渲染之后，重新执行计算。否则在 item 没有指定过高度的前提下，计算出的 item 高度会不正确</span></span><br><span class="line">      <span class="title function_">nextTick</span>(reset)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 在 picturePreReading 为 false</span></span><br><span class="line">      <span class="title function_">reset</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>下面梳理一下整个瀑布流的构建过程：</p>
<ul>
<li>1.瀑布流的核心就是：通过<code>relative</code> 和<code>absolute</code>定位的方式，来控制每个 <code>item</code> 的位置</li>
<li>2．影响瀑布流高度的主要元素，通常都是<code>img</code>标签</li>
<li><p>3.有些服务端会返回<strong>关键img的高度</strong>，有些不会，所以需要分别处理：</p>
<ul>
<li><ol>
<li>当服务端<strong>不返回</strong>高度时：需要等待 <code>img</code> 加载完成之后，再来计算高度，然后通过得到的高度计算定位。否则则会出现高度计算不准确导致定位计算不准确的问题。</li>
</ol>
</li>
</ul>
<ul>
<li><ol>
<li>当服务端<strong>返回</strong>高度时：开发者则必须利用此高度为 <code>item</code> 进行高度设定。一旦 <code>item</code>具备指定高度，那么就不需要等待 <code>img</code>加载的过程，这样效率更高，并且可以业务的逻辑会变得更加简单。</li>
</ol>
</li>
</ul>
</li>
<li>4.当进行响应式切换时，同样需要区分对应场景：<ul>
<li><ol>
<li>当服务端<strong>不返回</strong>高度时：需要<strong>重新执行整个渲染流程</strong>，虽然会耗费一些性能，但可以最大可能的避免出现逻辑错误。让组件拥有更强的普适性。</li>
</ol>
</li>
<li><ol>
<li>当服务端<strong>返回</strong>高度时：同样需要重新计算<strong>列宽</strong>和<strong>定位</strong>，但因为 <code>item</code>具备明确的高度，所以可以直接拿到具体的高度，而无需重复整个渲染流程，从而可以实现更多的交互逻辑。比如：位移动画、将来的图片懒加载占位…</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="21、通用组件-infinite"><a href="#21、通用组件-infinite" class="headerlink" title="21、通用组件  infinite"></a>21、通用组件  <code>infinite</code></h3><p>对于首页中的瀑布流而言，是需要进行长列表展示的，也就说它是一个分页的数据。那么对于这种分页功能而言，应该如何进行实现</p>
<ol>
<li><strong>长列表的实现原理</strong></li>
</ol>
<p>长列表分页加载，其实指的就是：<strong>当滚动到列表底部时，加载数据</strong></p>
<p>要想实现这个功能，需要做的核心的一点就是<strong>能够监听到列表滚动到底部</strong></p>
<p>监听到列表滚动到底部，可以利用<code>IntersectionObserver</code>，该接口可以判断：<strong>目标元素与其祖先元素或顶级文档视窗(<code>viewport</code>)的交叉状态（是否可见）</strong></p>
<p>利用这个特性，把一个元素<strong>置于列表底部</strong>，当这个元素可见时则表示<strong>列表滚动到了底部</strong>。</p>
<p>由于原生的<code>IntersectionObserver</code>使用起来比较复杂，所以<code>vueuse</code>提供了<code>useIntersectionObserver</code>方法。</p>
<ol>
<li><strong>如何使用</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;infinite-list</span><br><span class="line">	v-model=<span class="string">&quot;&quot;</span>       <span class="comment">// 当前是否处于加载状态</span></span><br><span class="line">  :isFinished=<span class="string">&quot;&quot;</span>   <span class="comment">// 数据是否全部加载完成</span></span><br><span class="line">  @onLoad=<span class="string">&quot;&quot;</span>       <span class="comment">// 加载下一页数据的触发事件</span></span><br><span class="line">&gt;</span><br><span class="line">	list列表</span><br><span class="line">&lt;/infinite-list&gt;</span><br></pre></td></tr></table></figure>
<h4 id="构建长列表组件"><a href="#构建长列表组件" class="headerlink" title="构建长列表组件"></a>构建长列表组件</h4><ol>
<li>创建<code>libs/infinite/index.vue</code>组件</li>
<li>构建<code>props</code>与<code>emits</code>，并处理双向数据绑定逻辑</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useVModel, useIntersectionObserver &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">// 是否处于加载状态</span></span><br><span class="line">  <span class="attr">modelValue</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 数据是否全部加载完成</span></span><br><span class="line">  <span class="attr">isFinished</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;onLoad&#x27;</span>, <span class="string">&#x27;update:modelValue&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理 loading 状态</span></span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">useVModel</span>(props)</span><br></pre></td></tr></table></figure>
<ol>
<li>构建对应视图和插槽逻辑</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">     &lt;!-- 内容 --&gt;</span><br><span class="line">     &lt;slot /&gt;</span><br><span class="line">    &lt;div ref=&quot;laodingTarget&quot; class=&quot;h-6 py-4&quot;&gt;</span><br><span class="line">      &lt;!-- 加载更多 --&gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        v-show=&quot;loading&quot;</span><br><span class="line">        class=&quot;w-4 h-4 mx-auto animate-spin&quot;</span><br><span class="line">        name=&quot;infinite-load&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;!-- 没有更多数据了 --&gt;</span><br><span class="line">      &lt;p v-if=&quot;isFinished&quot; class=&quot;text-center text-base text-zinc-400&quot;&gt;</span><br><span class="line">        已经没有更多数据了!</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>利用 <a target="_blank" rel="noopener" href="https://vueuse.org/core/useIntersectionObserver/">useIntersectionObserver</a> 方法，监听元素可见行为，用于判断列表滚动到底部</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动的元素</span></span><br><span class="line"><span class="keyword">const</span> laodingTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="title function_">useIntersectionObserver</span>(laodingTarget, <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当加载更多的视图可见时，同时 loading 为 false，同时 数据尚未全部加载完</span></span><br><span class="line">    <span class="comment">// 处理加载更多的逻辑</span></span><br><span class="line">    <span class="keyword">if</span>(isIntersecting &amp;&amp; !loading.<span class="property">value</span> &amp;&amp; !props.<span class="property">isFinished</span>)&#123;</span><br><span class="line">        <span class="comment">// 修改加载数据标记</span></span><br><span class="line">        loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 触发加载更多行为</span></span><br><span class="line">        <span class="title function_">emits</span>(<span class="string">&#x27;onLoad&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="结合瀑布流组件的使用"><a href="#结合瀑布流组件的使用" class="headerlink" title="结合瀑布流组件的使用"></a>结合瀑布流组件的使用</h4><p>通过应用<code>infinite</code>组件 结合<code>waterfall</code>组件构建长列表瀑布流效果</p>
<ol>
<li>在<code>view/main/components/list/index.vue</code>中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 长列表处理 --&gt;</span><br><span class="line">    &lt;m-infinite</span><br><span class="line">      v-model=&quot;isLoading&quot;</span><br><span class="line">      :isFinished=&quot;isFinished&quot;</span><br><span class="line">      @onLoad=&quot;getPexelsData&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-waterfall</span><br><span class="line">        ...</span><br><span class="line">      &lt;/m-waterfall&gt;</span><br><span class="line">    &lt;/m-infinite&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">...</span><br><span class="line">// 构建数据请求</span><br><span class="line">let query = &#123;</span><br><span class="line">  page: 1,</span><br><span class="line">  size: 20</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 长列表组件属性</span><br><span class="line">const isLoading = ref(false)  // 数据是否在加载中</span><br><span class="line">const isFinished = ref(false) // 数据是否全部加载完成</span><br><span class="line"></span><br><span class="line">// 加载数据的方法</span><br><span class="line">const pexelsList = ref([]) // 数据源</span><br><span class="line">const getPexelsData = async () =&gt; &#123;</span><br><span class="line">  // 数据全部加载完成则 return</span><br><span class="line">  if (isFinished.value) &#123;</span><br><span class="line">      return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 完成第一次请求之后，后续请求让 page 自增</span><br><span class="line">  if (pexelsList.value.length) &#123;</span><br><span class="line">      query.page += 1</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 触发接口请求</span><br><span class="line">  const res = await getPexelsList(query)</span><br><span class="line">  // 初始请求清空数据源</span><br><span class="line">  if (query.page === 1) &#123;</span><br><span class="line">      pexelsList.value = res.list</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      pexelsList.value.push(...res.list)</span><br><span class="line">  &#125;</span><br><span class="line">  // 判断数据是否全部加载完成</span><br><span class="line">  if (pexelsList.value.length === res.total) &#123;</span><br><span class="line">      isFinished.value = true</span><br><span class="line">  &#125;</span><br><span class="line">  // 修改 loading 标记</span><br><span class="line">  isLoading.value = false</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>当loading图标显示时，加载更多的瀑布流数据</p>
<h4 id="解决首次数据无法铺满全屏的问题"><a href="#解决首次数据无法铺满全屏的问题" class="headerlink" title="解决首次数据无法铺满全屏的问题"></a>解决首次数据无法铺满全屏的问题</h4><p>当更改数据请求<code>size=5</code>时，刷新页面，会触发一次接口请求，页面只显示一行图片数据，且鼠标滚动也无法触发下一页请求，导致首次数据加载无法铺满全屏。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构建数据请求</span></span><br><span class="line"><span class="keyword">let</span> query = &#123;</span><br><span class="line">  <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">size</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>原因：</strong>当首次加载数据无法铺满全屏的时候，<code>isIntersecting</code>判断（检测是否可见的变量）虽然为<code>true</code>，但是它只会被触发一次，也就是<code>setIntersectionObserver</code>里的回调只会触发一次，不会再一次触发对应的<code>loading</code>，从而出现上述问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useIntersectionObserver</span>(laodingTarget, <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 当加载更多的视图可见时， loading 为 false， 数据尚未全部加载完</span></span><br><span class="line">  <span class="keyword">if</span>(isIntersecting &amp;&amp; !loading.<span class="property">value</span> &amp;&amp; !props.<span class="property">isFinished</span>)&#123;</span><br><span class="line">     loading.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// 修改加载数据标记</span></span><br><span class="line">     <span class="title function_">emits</span>(<span class="string">&#x27;onLoad&#x27;</span>) <span class="comment">// 触发加载更多行为</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>解决方法：</strong>判断<code>isIntersecting</code>方法在<code>loading</code>发生变化后重新进行一次判断</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> targetIsIntersecting = <span class="title function_">ref</span>(<span class="literal">false</span>) <span class="comment">// 记录当前是否在底部（是否交叉）</span></span><br><span class="line"><span class="title function_">useIntersectionObserver</span>(laodingTarget, <span class="function">(<span class="params">[&#123; isIntersecting &#125;]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取当前交叉状态</span></span><br><span class="line">  targetIsIntersecting.<span class="property">value</span> = isIntersecting</span><br><span class="line">  <span class="title function_">emitLoad</span>() <span class="comment">// 触发 load</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发 load</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">emitLoad</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 当加载更多的视图可见时，加载更多数据</span></span><br><span class="line">  <span class="keyword">if</span> (targetIsIntersecting.<span class="property">value</span> &amp;&amp; !loading.<span class="property">value</span> &amp;&amp; !props.<span class="property">isFinished</span>) &#123;</span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// 修改加载数据标记</span></span><br><span class="line">    <span class="title function_">emits</span>(<span class="string">&#x27;onLoad&#x27;</span>) <span class="comment">// 触发加载更多行为</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 loading 的变化，解决数据加载完成后，首屏未铺满的问题</span></span><br><span class="line"><span class="title function_">watch</span>(loading, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 触发 load，延迟处理，等待 渲染和 useIntersectionObserver 的再次触发</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">emitLoad</span>()</span><br><span class="line">  &#125;, <span class="number">100</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="22、实现图片懒加载指令"><a href="#22、实现图片懒加载指令" class="headerlink" title="22、实现图片懒加载指令"></a>22、实现图片懒加载指令</h3><p><strong>使用图片懒加载的原因：</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191506497.jpg" alt="image-20220827101927965"></p>
<p>这个是在项目中截取的图片、可以看到在初始化时，加载了76张图片、而实际首屏在可视范围内也就只展示了10多张图片；剩余的60来张图片完全没有必要在可视范围外加载，我们需要当图片在可视范围内再加载对应的图片</p>
<p><strong>图片懒加载的优点：</strong>减少服务器带宽、资源；提升用户首屏加载速度、用户体验</p>
<p><strong>图片懒加载实现原理：</strong></p>
<p>图片懒加载指：<strong>当图片不可见时，不加载图片。当图片可见时，才去加载图片。</strong></p>
<p><strong>可以监听所有图片是否被可见，如果图片处于不可见状态，那么就不加载图片，如果图片处于可见状态，那么开始加载图片。</strong><br>而这个功能的实现关键就是 <strong><code>IntersectionObserver</code></strong>。</p>
<h4 id="实现懒加载v-lazy指令"><a href="#实现懒加载v-lazy指令" class="headerlink" title="实现懒加载v-lazy指令"></a>实现懒加载<code>v-lazy</code>指令</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191506484.jpg" alt="image-20220827110753001"> </p>
<p>创建<code>src/directives/modules/lazy/index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useIntersectionObserver <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="comment">// 处理图片懒加载</span></span><br><span class="line"><span class="comment">// 1、在元素挂载到页面中的钩子函数中、保存img的src</span></span><br><span class="line"><span class="comment">// 2、将img的src属性置为 空 或者置位默认图片</span></span><br><span class="line"><span class="comment">// 3、监听图片是否在可视范围内？ 在可视范围内将img保存在src重新复制到img上 并 取消监听</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// 1、拿到当前 img 标签的 src</span></span><br><span class="line">    <span class="keyword">const</span> imgSrc = el.<span class="property">src</span></span><br><span class="line">    <span class="comment">// 2、将img的src属性置为 空 或者置位默认图片</span></span><br><span class="line">    el.<span class="property">src</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">//  3、监听图片是否在可视范围内</span></span><br><span class="line">    <span class="keyword">const</span> &#123; stop &#125; = <span class="title function_">useIntersectionObserver</span>(el, <span class="function">(<span class="params">&#123; isIntersecting &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isIntersecting) &#123;</span><br><span class="line">        el.<span class="property">src</span> = imgSrc <span class="comment">// 3. 当图片可见时,加载图片</span></span><br><span class="line">        <span class="title function_">stop</span>() <span class="comment">// 4. 停止监听</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="指令的自动注册"><a href="#指令的自动注册" class="headerlink" title="指令的自动注册"></a>指令的自动注册</h4><p>完成指令的自动注册需要利用 [Glob导入(import.meta.globEager)][[(<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/features#glob-import">https://cn.vitejs.dev/guide/features#glob-import</a>)] 和 [Object.entries][(<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/entries">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/entries</a>)] 功能</p>
<p>创建<code>src/directives/index.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局指令注册</span></span><br><span class="line"><span class="comment"> * https://cn.vitejs.dev/guide/features.html#glob-import</span></span><br><span class="line"><span class="comment"> * import.meta.globEager 为同步导入</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">install</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> directives = <span class="keyword">import</span>.<span class="property">meta</span>.<span class="title function_">globEager</span>(<span class="string">&#x27;./modules/*.js&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(directives)) &#123;</span><br><span class="line">      <span class="comment">// 拼接组件注册的 name</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(key) <span class="comment">// ./modules/lazy.js</span></span><br><span class="line">      <span class="keyword">const</span> arr = key.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> directiveName = arr[arr.<span class="property">length</span> - <span class="number">1</span>].<span class="title function_">replace</span>(<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">      app.<span class="title function_">directive</span>(directiveName, value.<span class="property">default</span>) <span class="comment">// 完成注册</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>main.js</code>中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> directives <span class="keyword">from</span> <span class="string">&#x27;@/directives&#x27;</span> <span class="comment">// + 引入注册指令模块</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;virtual:svg-icons-register&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">use</span>(store).<span class="title function_">use</span>(libs)</span><br><span class="line">    .<span class="title function_">use</span>(directives) <span class="comment">// + 注册指令</span></span><br><span class="line">    .<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="指定图片彩色占位符"><a href="#指定图片彩色占位符" class="headerlink" title="指定图片彩色占位符"></a>指定图片彩色占位符</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191507552.jpg" alt="image-20220827110753001"></p>
<p>当图片加载比较慢的时候，会出现图片区域显示空白的情况，给每个图片设置个随机颜色来作为图片加载完成前的填充，使其更加美观。</p>
<p>在<code>utils/color.js</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成随机色值</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">randomRGB</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>)</span><br><span class="line">  <span class="keyword">const</span> g = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>)</span><br><span class="line">  <span class="keyword">const</span> b = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">255</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>, <span class="subst">$&#123;g&#125;</span>, <span class="subst">$&#123;b&#125;</span>)`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>view/main/components/list/item.vue</code>中使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;bg-white dark:bg-zinc-900 xl:dark:bg-zinc-800 rounded pb-1&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;relative w-full rounded cursor-zoom-in group&quot;</span><br><span class="line">        :style=&quot;&#123; backgroundColor: randomRGB() &#125;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        ...</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; randomRGB &#125; from &#x27;@/utils/color&#x27;</span><br><span class="line">...</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="23、多组件联动"><a href="#23、多组件联动" class="headerlink" title="23、多组件联动"></a>23、多组件联动</h3><p>在实际开发中，经常会遇到多个组件之间互相进行联动的场景。这样的场景通常应该怎么去进行处理</p>
<p>多组件联动，通常指的是：<strong>多个组件之间，存在一个或多个共享的数据。当数据发生改变时，执行对应的逻辑</strong>。<br>那么把这一句话拆分开来看，就是两部分：</p>
<pre><code>1. 多组件之间需要共享数据
2. 监听数据变化，并执行对应逻辑
</code></pre><p><strong>多组件之间需要共享数据</strong></p>
<ol>
<li>组件之间的数据传递 —- 常见于层级关系比较清晰的多组件之中<ol>
<li>父传子</li>
<li>子传父</li>
<li>…</li>
</ol>
</li>
<li>依赖注入： [Provide/Inject][[(<a target="_blank" rel="noopener" href="https://cn.vuejs.org/guide/components/provide-inject.html">https://cn.vuejs.org/guide/components/provide-inject.html</a>)] —- 嵌套层级比较深，并且子组件只需要父组件的部分内容</li>
<li>全局状态管理工具：vuex —- 以上两种情况都不适用的情况下</li>
</ol>
<p>针对于本项目的场景，层级关系比较复杂，并且需要进行复杂的逻辑操作，那么此时，多组件之间共享数据的策略就需要通过<code>vuex</code>来实现。</p>
<p><strong>监听数据变化的方式</strong></p>
<p>当组件之间共享的数据发生变化时，需要执行对应的逻辑操作。首当其冲就需要监听到数据的变化。</p>
<p>在 vue 中监听数据变化的方式，首推就是 watch。</p>
<p>本项目共享的数据需要被保存到 vuex 中，所以就需要通过 watch 监听到 vuex 中共享数据的变化，然后在监听到变化时，执行对应的业务逻辑。</p>
<p>依据以上所说的内容，整体实现逻辑应该为：</p>
<ol>
<li>创建共享数据对应的 vuex 模块</li>
<li>在 getters 中建立对应的快捷访问计算属性</li>
<li>在对应的业务组件中，监听 getters，并执行对应逻辑</li>
</ol>
<h4 id="NavigationBar对应list"><a href="#NavigationBar对应list" class="headerlink" title="NavigationBar对应list"></a><code>NavigationBar</code>对应<code>list</code></h4><p>当 navigationBar 中的 item 发生切换时，切换对应的 list 中的展示数据，而切换的关键就在于<strong>共享数据的变化，引起的逻辑变化</strong>。在这样的场景中，共享数据指的就是<strong>被选中项</strong>。</p>
<p>无论是 <code>PC端</code> 下还是 <code>移动端</code> 下，被选中项都是在组件内部进行处理的，这不符合最初逻辑。我们期望共享的数据可以在 <code>vuex</code> 中被维护。</p>
<ol>
<li>创建<code>store/modules/app.js</code>，该模块下的数据<strong>不会</strong>被缓存：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ALL_CATEGORY_ITEM</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 当前选中的分类</span></span><br><span class="line">    <span class="attr">currentCategory</span>: <span class="variable constant_">ALL_CATEGORY_ITEM</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="comment">// 切换选中分类</span></span><br><span class="line">    <span class="title function_">changeCurrentCategory</span>(<span class="params">state, newCategory</span>) &#123;</span><br><span class="line">      state.<span class="property">currentCategory</span> = newCategory</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/getters.js</code>中</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isMobileTerminal &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/flexible&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//简单访问：navigationBar 数据源</span></span><br><span class="line">  <span class="attr">categorys</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">category</span>.<span class="property">categorys</span>,</span><br><span class="line">  <span class="comment">// 当前主题</span></span><br><span class="line">  <span class="attr">themeType</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">theme</span>.<span class="property">themeType</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// category选中项</span></span><br><span class="line">  <span class="attr">currentCategory</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">app</span>.<span class="property">currentCategory</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// category选中项下标</span></span><br><span class="line">  <span class="attr">currentCategoryIndex</span>: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getters.<span class="property">categorys</span>.<span class="title function_">findIndex</span>(</span><br><span class="line">      <span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">id</span> === getters.<span class="property">currentCategory</span>.<span class="property">id</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>PC端</code>和<code>移动端</code>分别触发</li>
</ol>
<p><code>pc/index.js</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">class</span>=<span class="string">&quot;bg-white dark:bg-zinc-800 duration-500 sticky top-0 left-0 w-full z-10&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  &gt;</span></span></span><br><span class="line"><span class="language-xml">    ......</span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- category item --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in $store.getters.categorys&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;shrink-0 px-1.5 py-0 z-10 duration-200 last:mr-4 text-zinc-900 dark:text-zinc-500 dark:hover:text-zinc-300 text-base font-bold h-4 leading-4 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-900 rounded mr-1 mb-1&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:class</span>=<span class="string">&quot;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        &#x27;text-zinc-900 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-900&#x27;:</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">        $store.getters.currentCategoryIndex === index</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">      &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">click</span>=<span class="string">&quot;onItemClick(item)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;&#123; item.name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">...... </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 选中状态处理 - 高亮</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">item</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  store.<span class="title function_">commit</span>(<span class="string">&#x27;app/changeCurrentCategory&#x27;</span>, item)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><code>mobile/index.js</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bg-white dark:bg-zinc-900 sticky top-0 left-0 z-10&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    ......</span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 顶部分类导航条 - item --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in $store.getters.categorys&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">class</span>=<span class="string">&quot;shrink-0 px-1.5 py-0.5 z-10 duration-200 last:mr-4&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:class</span>=<span class="string">&quot;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">					 &#x27;text-zinc-100&#x27; :</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">            $store.getters.currentCategoryIndex === index</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">				 &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:ref</span>=<span class="string">&quot;setItemRef&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          @<span class="attr">click</span>=<span class="string">&quot;onItemClick(item)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;&#123; item.name &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     ......</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">......</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">......</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">watch</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="function">() =&gt;</span> store.<span class="property">getters</span>.<span class="property">currentCategoryIndex</span>, </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 获取选中元素的 left、width</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> &#123; left, width &#125; = itemRefs[val].<span class="title function_">getBoundingClientRect</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 为 sliderStyle 设置属性</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        sliderStyle.<span class="property">value</span> = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">transform</span>: <span class="string">`translateX(<span class="subst">$&#123;ulScrollLeft.value + left - <span class="number">10</span>&#125;</span>px)`</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">width</span>: width + <span class="string">&#x27;px&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// item 点击事件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">index</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    store.<span class="title function_">commit</span>(<span class="string">&#x27;app/changeCurrentCategory&#x27;</span>, item)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    isVisable.<span class="property">value</span> = <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">......</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>list/index.vue</code>中进行监听<code>currentCategory</code> 的变化</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 选中状态发生改变 -- 通过此方法修改 query 请求参数，重新发起请求</span></span><br><span class="line"> <span class="keyword">const</span> <span class="title function_">resetQuery</span> = (<span class="params">newQuery</span>) =&gt; &#123;</span><br><span class="line">  query = &#123; ...query, ...newQuery &#125;</span><br><span class="line">  <span class="comment">// 重置状态</span></span><br><span class="line">  isFinished.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  pexelsList.<span class="property">value</span> = []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 currentCategory 的变化 -- 选中状态发生改变</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> store.<span class="property">getters</span>.<span class="property">currentCategory</span>,</span><br><span class="line">  <span class="function">(<span class="params">currentCategory</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 重置请求参数</span></span><br><span class="line">    <span class="title function_">resetQuery</span>(&#123;</span><br><span class="line">      <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">categoryId</span>: currentCategory.<span class="property">id</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="searchBar对应list"><a href="#searchBar对应list" class="headerlink" title="searchBar对应list"></a><code>searchBar</code>对应<code>list</code></h4><p>对于 searchBar区域而言，目前还没有处理完成，所以需要先把searchBar区域的处理流程捋清楚，然后再处理对应的联动。<br>对于 searchBar 区域目前还缺少三部分的内容处理：</p>
<pre><code>1. 搜索提示
2. 搜索历史
3. 推荐主题
所以接下来的处理顺序为：
1. 搜索提示
2. 搜索历史
3. 推荐主题
4. search 触发时的 list 联动
</code></pre><h4 id="获取搜索提示"><a href="#获取搜索提示" class="headerlink" title="获取搜索提示"></a>获取搜索提示</h4><ol>
<li>在<code>api/pexels.js</code>中新增获取搜索提示接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取搜索提示</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getHint</span> = (<span class="params">q</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pexels/hint&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      q</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/header/header-search/hint.vue</code>中发起接口请求获取数据。并渲染视图</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-for=&quot;(item, index) in hintData&quot;</span><br><span class="line">        :key=&quot;index&quot;</span><br><span class="line">        class=&quot;py-1 pl-1 text-base font-bold text-zinc-500 rounded cursor-pointer duration-300 hover:bg-zinc-200 dark:hover:bg-zinc-900&quot;</span><br><span class="line">        @click=&quot;onItemClick(item)&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;script&gt;</span><br><span class="line">  const EMITS_ITEM_CLICK = &#x27;itemClick&#x27;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;script setup&gt;</span><br><span class="line">  import &#123; getHint &#125; from &#x27;@/api/pexels&#x27;</span><br><span class="line">  import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">  </span><br><span class="line">  // 接收搜索数据</span><br><span class="line">  const props = defineProps(&#123;</span><br><span class="line">    searchText: &#123; // 搜索文本</span><br><span class="line">      type: String,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  // 声明item 被点击触发事件</span><br><span class="line">  const emits = defineEmits([EMITS_ITEM_CLICK])</span><br><span class="line">  </span><br><span class="line">  // 获取搜索提示数据</span><br><span class="line">  const hintData = ref([])</span><br><span class="line">  const getHintData = async () =&gt; &#123;</span><br><span class="line">    if (!props.searchText) return</span><br><span class="line">    const &#123; result &#125; = await getHint(props.searchText)</span><br><span class="line">    hintData.value = result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 监听搜索文本的变化，并获取对应提示数据</span><br><span class="line">  watch(() =&gt; props.searchText, getHintData, &#123;</span><br><span class="line">    immediate: true</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  // item 点击事件</span><br><span class="line">  const onItemClick = (item) =&gt; &#123;</span><br><span class="line">    emits(EMITS_ITEM_CLICK, item)</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<ol>
<li>在父组件<code>view/layout/components/header/header-search/index.vue</code>进行搜索提示的展示</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;w-full guide-search&quot;&gt;</span><br><span class="line">    &lt;m-search v-model=&quot;inputValue&quot;&gt;</span><br><span class="line">      &lt;template #dropdown&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;!-- 搜索提示 --&gt;</span><br><span class="line">          &lt;hintVue</span><br><span class="line">            v-show=&quot;inputValue&quot;</span><br><span class="line">            :searchText=&quot;inputValue&quot;</span><br><span class="line">            @itemClick=&quot;onSearchHandler&quot;</span><br><span class="line">          &gt;&lt;/hintVue&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import hintVue from &#x27;./hint.vue&#x27;</span><br><span class="line"></span><br><span class="line">const inputValue = ref(&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">// 搜索的回调事件</span><br><span class="line">const onSearchHandler = (val) =&gt; &#123;</span><br><span class="line">  inputValue.value = val</span><br><span class="line">  if (val) &#123;</span><br><span class="line">    store.commit(&#x27;search/addHistory&#x27;, val) // 保存历史记录</span><br><span class="line">    // console.log(&#x27;触发 searchText 变化&#x27;)</span><br><span class="line">    store.commit(&#x27;app/changeSearchText&#x27;, val) // 触发 searchText 变化</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="处理防抖功能"><a href="#处理防抖功能" class="headerlink" title="处理防抖功能"></a>处理防抖功能</h4><p>目前的 searchBar 中，当输入内容时，会触发搜索提示功能。但是当搜索一个单词，比<br>如：mac ，却进行了三次的搜索（m、ma、mac）。这明显是不合理的。<br>所以如果想要让这个搜索变得更加合理，那么就需要使用到 <strong>防抖</strong> 这样的功能。</p>
<p>防抖(<code>debounce</code>)指：<strong>当触发一个事件时，不去立刻执行，而是延迟一段时间，该事件变为等待执行事件。如果在这段时间之内，该事件被再次触发，则上次等待执行的事件取消，本次触发的事件变为等待执行事件。循环往复，直到某一个等待事件被执行为止</strong></p>
<p>目前在 <code>view/layout/components/header/header-search/hint.vue</code> 中，是通过 <code>watch</code> 监听输入内容的变化，所以当输入内容发生变化时，就会立刻触发 <code>getHintData</code> 事件。</p>
<p>此时所需要做的防抖处理，就需要在<code>watch</code> 中进行。不过这样的防抖 watch 不需要自己进行实现， <code>vueuse</code> 中提供了对应的 <a target="_blank" rel="noopener" href="https://vueuse.org/shared/watchDebounced/">watchDebounced</a> ，可以直接利用这个 <code>API</code> 直接实现防抖的<code>watch</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; getHint &#125; from &#x27;@/api/pexels&#x27;</span><br><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; watchDebounced &#125; from &#x27;@vueuse/core&#x27;</span><br><span class="line">......</span><br><span class="line">// 监听搜索文本的变化，并获取对应提示数据</span><br><span class="line">watchDebounced(() =&gt; props.searchText, getHintData, &#123;</span><br><span class="line">  immediate: true,</span><br><span class="line">  debounce: 500 // 每次事件触发时，延迟的时间</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="实现关键字的高亮"><a href="#实现关键字的高亮" class="headerlink" title="实现关键字的高亮"></a>实现关键字的高亮</h4><p>在<code>view/layout/components/header/header-search/hint.vue</code>中将输入的正常搜索文本替换成带<code>html</code>标签的文本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-for=&quot;(item, index) in hintData&quot;</span><br><span class="line">      :key=&quot;index&quot;</span><br><span class="line">      class=&quot;py-1 pl-1 text-base font-bold text-zinc-500 rounded cursor-pointer duration-300 hover:bg-zinc-200 dark:hover:bg-zinc-900&quot;</span><br><span class="line">      @click=&quot;onItemClick(item)&quot;</span><br><span class="line">      v-html=&quot;highlightText(item)&quot;</span><br><span class="line">    &gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">......</span><br><span class="line">// 处理关键字高亮</span><br><span class="line">const highlightText = (text) =&gt; &#123;</span><br><span class="line">  // 生成高亮标签</span><br><span class="line">  const highlightStr = `&lt;span class=&quot;text-zinc-900 dark:text-zinc-200&quot;&gt;$&#123;props.searchText&#125;&lt;/span&gt;`</span><br><span class="line">  // 构建正则表达式，从《显示文本中》找出与《用户输入文本相同的内容》，使用《高亮标签》进行替换</span><br><span class="line">  const reg = new RegExp(props.searchText, &#x27;gi&#x27;)</span><br><span class="line">  return text.replace(reg, highlightStr) // 替换</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="搜索历史"><a href="#搜索历史" class="headerlink" title="搜索历史"></a>搜索历史</h4><ol>
<li>在<code>store/modules/search.js</code>中</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">historys</span>: []</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 新增</span></span><br><span class="line"><span class="comment">       * 1. 新增的历史记录位于头部</span></span><br><span class="line"><span class="comment">       * 2. 不可出现重复的记录</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="title function_">addHistory</span>(<span class="params">state, newHistory</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> isFindIndex = state.<span class="property">historys</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item === newHistory)</span><br><span class="line">        <span class="comment">// 剔除旧数据</span></span><br><span class="line">        <span class="keyword">if</span> (isFindIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">          state.<span class="property">historys</span>.<span class="title function_">splice</span>(isFindIndex, <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        state.<span class="property">historys</span>.<span class="title function_">unshift</span>(newHistory)<span class="comment">// 新增记录</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 删除指定历史记录数据</span></span><br><span class="line">      <span class="title function_">deleteHistory</span>(<span class="params">state, index</span>) &#123;</span><br><span class="line">        state.<span class="property">historys</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 删除所有历史记录</span></span><br><span class="line">      <span class="title function_">deleteAllHistory</span>(<span class="params">state</span>) &#123;</span><br><span class="line">        state.<span class="property">historys</span> = []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/index.js</code>中完成<code>search</code>模块对应的注册</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"><span class="keyword">import</span> search <span class="keyword">from</span> <span class="string">&#x27;./modules/search&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    category,</span><br><span class="line">    theme,</span><br><span class="line">    app,</span><br><span class="line">    search</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">      <span class="comment">// 保存到 localStorage 中的 key</span></span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;imooc-front&#x27;</span>,</span><br><span class="line">      <span class="comment">// 需要保存的模块</span></span><br><span class="line">      <span class="attr">paths</span>: [<span class="string">&#x27;category&#x27;</span>, <span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;search&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/getters.js</code>新增<code>search</code>的快速访问</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">// 搜索记录历史</span></span><br><span class="line">  <span class="attr">historys</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">search</span>.<span class="property">historys</span>,</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/header/header-search/history.vue</code>渲染历史记录的页面视图</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;&quot;&gt;</span><br><span class="line">      &lt;!-- 最近搜索文本 --&gt;</span><br><span class="line">      &lt;div class=&quot;flex items-center text-xs mb-1 text-zinc-400&quot;&gt;</span><br><span class="line">        &lt;span&gt;最近搜索&lt;/span&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&quot;delete&quot;</span><br><span class="line">          class=&quot;w-2.5 h-2.5 ml-1 p-0.5 cursor-pointer duration-300 rounded-sm hover:bg-zinc-100&quot;</span><br><span class="line">          fillClass=&quot;fill-zinc-400&quot;</span><br><span class="line">          @click=&quot;onDeleteAllClick&quot;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 搜索历史内容 --&gt;</span><br><span class="line">      &lt;div class=&quot;flex flex-wrap&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          v-for=&quot;(item, index) in $store.getters.historys&quot;</span><br><span class="line">          :key=&quot;index&quot;</span><br><span class="line">          class=&quot;mr-2 mb-1.5 flex items-center cursor-pointer bg-zinc-100 px-1.5 py-0.5 text-zinc-900 text-sm font-bold rounded-sm duration-300 hover:bg-zinc-200&quot;</span><br><span class="line">          @click=&quot;onItemClick(item)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; item &#125;&#125;&lt;/span&gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&quot;input-delete&quot;</span><br><span class="line">            class=&quot;w-2.5 h-2.5 p-0.5 ml-1 duration-300 rounded-sm hover:bg-zinc-100&quot;</span><br><span class="line">            @click.stop=&quot;onDeleteClick(index)&quot;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;script&gt;</span><br><span class="line">  const EMITS_ITEM_CLICK = &#x27;itemClick&#x27;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;script setup&gt;</span><br><span class="line">  import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">  import &#123; confirm &#125; from &#x27;@/libs&#x27;</span><br><span class="line">  </span><br><span class="line">  const emits = defineEmits([EMITS_ITEM_CLICK])</span><br><span class="line">  const store = useStore()</span><br><span class="line">  </span><br><span class="line">  // 删除所有搜索历史记录</span><br><span class="line">  const onDeleteAllClick = () =&gt; &#123;</span><br><span class="line">    store.commit(&#x27;search/deleteAllHistory&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // 删除单个搜索历史记录</span><br><span class="line">  const onDeleteClick = (index) =&gt; &#123;</span><br><span class="line">    store.commit(&#x27;search/deleteHistory&#x27;, index)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // item 单个搜索历史记录的点击事件</span><br><span class="line">  const onItemClick = (item) =&gt; &#123;</span><br><span class="line">    emits(EMITS_ITEM_CLICK, item)</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">  &lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在父组件<code>view/layout/components/header/header-search/index.vue</code>中导入使用</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;w-full guide-search&quot;&gt;</span><br><span class="line">    &lt;m-search v-model=&quot;inputValue&quot; @search=&quot;onSearchHandler&quot;&gt;</span><br><span class="line">      &lt;template #dropdown&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;!-- 搜索提示 --&gt;</span><br><span class="line">          &lt;hintVue</span><br><span class="line">            v-show=&quot;inputValue&quot;</span><br><span class="line">            :searchText=&quot;inputValue&quot;</span><br><span class="line">            @itemClick=&quot;onSearchHandler&quot;</span><br><span class="line">          &gt;&lt;/hintVue&gt;</span><br><span class="line">          &lt;!-- 最近搜索 --&gt;</span><br><span class="line">          &lt;historyVue</span><br><span class="line">            v-show=&quot;!inputValue&quot;</span><br><span class="line">            @itemClick=&quot;onSearchHandler&quot;</span><br><span class="line">          &gt;&lt;/historyVue&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import hintVue from &#x27;./hint.vue&#x27;</span><br><span class="line">import historyVue from &#x27;./history.vue&#x27;</span><br><span class="line"></span><br><span class="line">const store = useStore()</span><br><span class="line">const inputValue = ref(&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">// 搜索的回调事件</span><br><span class="line">const onSearchHandler = (val) =&gt; &#123;</span><br><span class="line">  inputValue.value = val</span><br><span class="line">  if (val) &#123;</span><br><span class="line">    store.commit(&#x27;search/addHistory&#x27;, val) // 保存历史记录</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="构建热门精选模块"><a href="#构建热门精选模块" class="headerlink" title="构建热门精选模块"></a>构建热门精选模块</h4><ol>
<li>在<code>api/pexels.js</code>中定义热门精选主题的接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取推荐主题</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getThemes</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pexels/themes&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/header/header-search/theme.vue</code>中发起接口请求获取数据。并渲染视图</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;text-xs mb-1 text-zinc-400&quot;&gt;热门精选&lt;/div&gt;</span><br><span class="line">    &lt;!-- 第一列大图 --&gt;</span><br><span class="line">    &lt;div class=&quot;flex h-[140px]&quot; v-if=&quot;themeData.list.length&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;relative rounded w-[260px] cursor-pointer&quot;</span><br><span class="line">        :style=&quot;&#123; backgroundColor: randomRGB() &#125;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          class=&quot;h-full w-full object-cover rounded&quot;</span><br><span class="line">          v-lazy</span><br><span class="line">          :src=&quot;themeData.big.photo&quot;</span><br><span class="line">          alt=&quot;&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;p</span><br><span class="line">          class=&quot;absolute bottom-0 left-0 w-full h-[45%] flex items-center backdrop-blur rounded px-1 text-white text-xs duration-300 hover:backdrop-blur-none&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          # &#123;&#123; themeData.big.title &#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 2，3，4列两行小图 --&gt;</span><br><span class="line">      &lt;div class=&quot;flex flex-wrap flex-1 max-w-[860px]&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          v-for=&quot;item in themeData.list&quot;</span><br><span class="line">          :key=&quot;item.id&quot;</span><br><span class="line">          class=&quot;h-[45%] w-[260px] text-white text-xs relative ml-1.5 mb-1.5 rounded&quot;</span><br><span class="line">          :style=&quot;&#123; backgroundColor: randomRGB() &#125;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img</span><br><span class="line">            class=&quot;w-full h-full object-cover rounded&quot;</span><br><span class="line">            v-lazy</span><br><span class="line">            :src=&quot;item.photo&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;p</span><br><span class="line">            class=&quot;backdrop-blur absolute top-0 left-0 w-full h-full flex items-center px-1 rounded cursor-pointer duration-300 hover:backdrop-blur-none&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            # &#123;&#123; item.title &#125;&#125;</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; getThemes &#125; from &#x27;@/api/pexels&#x27;</span><br><span class="line">import &#123; randomRGB &#125; from &#x27;@/utils/color&#x27;</span><br><span class="line"></span><br><span class="line">// 热门精选主题数据</span><br><span class="line">const themeData = ref(&#123;</span><br><span class="line">  big: &#123;&#125;,</span><br><span class="line">  list: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 获取 热门精选 数据</span><br><span class="line">const getThemeData = async () =&gt; &#123;</span><br><span class="line">  const &#123; themes &#125; = await getThemes()</span><br><span class="line">  themeData.value = &#123;</span><br><span class="line">    big: themes[0],</span><br><span class="line">    list: themes.splice(1, themes.length)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">getThemeData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在父组件<code>view/layout/components/header/header-search/index.vue</code>进行搜索框内热门精选的展示</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;w-full guide-search&quot;&gt;</span><br><span class="line">          .....</span><br><span class="line">          &lt;!-- 推荐主题 --&gt;</span><br><span class="line">          &lt;themeVue v-show=&quot;!inputValue&quot;&gt;&lt;/themeVue&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-search&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">......</span><br><span class="line">import themeVue from &#x27;./theme.vue&#x27;</span><br><span class="line">.....</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="searchBar与list的联动"><a href="#searchBar与list的联动" class="headerlink" title="searchBar与list的联动"></a>searchBar与list的联动</h4><ol>
<li>在<code>store/modules/app.js</code>中</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">ALL_CATEGORY_ITEM</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="comment">// app模块中的数据不会被缓存</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">currentCategory</span>: <span class="variable constant_">ALL_CATEGORY_ITEM</span>, </span><br><span class="line">    <span class="attr">searchText</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 搜索的文本</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// 修改 searchText</span></span><br><span class="line">    <span class="title function_">changeSearchText</span>(<span class="params">state, newSearchText</span>) &#123;</span><br><span class="line">      state.<span class="property">searchText</span> = newSearchText</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/getters.js</code>新增快捷访问</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">........</span><br><span class="line">  <span class="comment">// 搜索文本</span></span><br><span class="line">  <span class="attr">searchText</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">app</span>.<span class="property">searchText</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/componentx/header/header-search/index.vue</code>中触发搜索<code>changeSearchText</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">......</span><br><span class="line">// 搜索的回调事件</span><br><span class="line">const onSearchHandler = (val) =&gt; &#123;</span><br><span class="line">  inputValue.value = val</span><br><span class="line">  if (val) &#123;</span><br><span class="line">    store.commit(&#x27;search/addHistory&#x27;, val)</span><br><span class="line">    store.commit(&#x27;app/changeSearchText&#x27;, val) // 触发 searchText 变化</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/main/components/list/index.vue</code>中监听搜索内容项<code>searchText</code>的变化</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">......</span><br><span class="line">// 监听搜索内容项searchText的变化</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; store.getters.searchText,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    // 重置请求参数</span><br><span class="line">    resetQuery(&#123;</span><br><span class="line">      page: 1,</span><br><span class="line">      searchText: val</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="24、通用组件-confirm"><a href="#24、通用组件-confirm" class="headerlink" title="24、通用组件 confirm"></a>24、通用组件 <code>confirm</code></h3><p>想要搞明白这一点，就需要了解一些比较冷僻的知识点，那就是渲染函数，在渲染函数中，需要了解如下概念：</p>
<ul>
<li><p><strong>虚拟<code>dom</code></strong>：通过<code>js</code>来描述<code>dom</code></p>
</li>
<li><p><strong><code>vnode</code>虚拟节点</strong>：告诉<code>vue</code>页面上需要渲染什么样子的节点</p>
</li>
<li><p><strong><code>h</code>函数:</strong> 用来创建<code>vnode</code>的函数，接受三个参数(要渲染的 <code>dom</code>，<code>attrs对象</code>，子元素)</p>
</li>
<li><p><strong><code>render</code></strong>函数：可以根据<code>vnode</code>来渲染<code>dom</code></p>
</li>
</ul>
<p><strong>通过<code>h</code>函数可以生成一个<code>vnode</code>，该 <code>vnode</code> 可以通过 <code>render</code>函数被渲染</strong></p>
<p>所以据此我们就可以得出 <code>confirm</code> 组件的实现思路：</p>
<ol>
<li>创建一个<code>confirm</code>组件</li>
<li>创建一个<code>index.js</code>模块，在该模块中<strong>返回一个 <code>promise</code></strong></li>
<li>同时利用<code>h</code>函数生成<code>confirm.vue</code>的<code>vnode</code></li>
<li>最后利用<code>render</code>函数，渲染<code>vnode</code>到 <code>body</code>中</li>
</ol>
<h4 id="构建confirm组件"><a href="#构建confirm组件" class="headerlink" title="构建confirm组件"></a>构建<code>confirm</code>组件</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191508046.jpeg" alt="image-20220830160243841"> </p>
<p>说明： </p>
<p><code>confirm/index.vue</code>：是confirm组件<br><code>confirm/index.js</code>：是confirm导出的函数，通过调用函数可以触发confirm显示</p>
<blockquote>
<p>在封装之前，需要明确当前要封装的组件，和<code>Vue</code>主程序的组件是不一样的；可以把它和主程序看做是两个不同的程序、所以它不能直接从主程序注册的组件中拿过来使用、也不能获取到主程序的<code>app</code></p>
</blockquote>
<p><strong>封装细节：</strong></p>
<ol>
<li>创建<code>libs/confirm/index.vue</code>组件，并创建对应的<code>props</code>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">// 标题</span></span><br><span class="line">  <span class="attr">title</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 描述</span></span><br><span class="line">  <span class="attr">content</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 取消按钮文本</span></span><br><span class="line">  <span class="attr">cancelText</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;取消&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 确定按钮文本</span></span><br><span class="line">  <span class="attr">confirmText</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;确定&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 取消按钮事件</span></span><br><span class="line">  <span class="attr">cancelHandler</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 确定按钮事件</span></span><br><span class="line">  <span class="attr">confirmHandler</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 关闭 confirm 的回调</span></span><br><span class="line">  <span class="attr">close</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Function</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>因为最终<code>confirm</code>组件是通过方法进行调用的，会导致 <strong>自动导入的组件无法使用</strong>，所以需要手动导入需要使用到的通用组件：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为将来confirm 组件会以方法调用的形式展示，需要主动导入组件</span></span><br><span class="line"><span class="keyword">import</span> mButton <span class="keyword">from</span> <span class="string">&#x27;../button/index.vue&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>创建对应样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 蒙版 --&gt;</span><br><span class="line">    &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">        @click=&quot;close&quot;</span><br><span class="line">        class=&quot;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">    &lt;!-- 提示内容 --&gt;</span><br><span class="line">    &lt;transition name=&quot;up&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">        class=&quot;w-[80%] fixed top-1/3 left-[50%] translate-x-[-50%] z-50 px-2 py-1.5 rounded-sm border dark:border-zinc-600 cursor-pointer bg-white dark:bg-zinc-800 xl:w-[35%]&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 标题 --&gt;</span><br><span class="line">        &lt;div class=&quot;text-lg font-bold text-zinc-900 dark:text-zinc-200 mb-2&quot;&gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 内容文本 --&gt;</span><br><span class="line">        &lt;div class=&quot;text-base text-zinc-900 dark:text-zinc-200 mb-2&quot;&gt;</span><br><span class="line">          &#123;&#123; content &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 底部 取消 &amp; 确认 按钮 --&gt;</span><br><span class="line">        &lt;div class=&quot;flex justify-end&quot;&gt;</span><br><span class="line">          &lt;mButton type=&quot;info&quot; class=&quot;mr-2&quot; @click=&quot;onCancelClick&quot;&gt;</span><br><span class="line">            &#123;&#123; cancelText&#125;&#125;</span><br><span class="line">          &lt;/mButton&gt;</span><br><span class="line">          &lt;mButton type=&quot;primary&quot; @click=&quot;onConfirmClick&quot;&gt;</span><br><span class="line">            &#123;&#123; confirmText &#125;&#125;</span><br><span class="line">          &lt;/mButton&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.fade-enter-active,</span><br><span class="line">.fade-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.fade-enter-from,</span><br><span class="line">.fade-leave-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">// up动画</span><br><span class="line">.up-enter-active,</span><br><span class="line">.up-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line">// 准备进入，离开完成</span><br><span class="line">.up-enter-from,</span><br><span class="line">.up-leave-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translate3d(-50%, 100px, 0);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建展示控制方法，由于<code>confirm</code>是有动画的、并且将来要将confirm对应的<code>vnode</code>通过<code>render</code>函数挂载到真实<code>dom</code>上；所以<strong>要先等组件挂载到页面上之后再控制confirm显示</strong>；同样，<strong>要等到关闭动画执行完之后再将真实dom从页面上移除</strong>。所以在<code>mounted</code>时，让内容展示：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// confirm 提示框的展示</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>) <span class="comment">// 控制显示处理</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">show</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理动画(render 函数的渲染，会直接进行)</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">show</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>处理关闭控制方法，同样因为动画需要展示，所以需要预留动画执行时间：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭动画执行时间</span></span><br><span class="line"><span class="keyword">const</span> duration = <span class="string">&#x27;0.5s&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// confirm 关闭，保留动画执行时长</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  <span class="comment">//延迟一段时间进行关闭，等待动画完全关闭之后，再去触发props.close()</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">close</span>) &#123;</span><br><span class="line">      props.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="built_in">parseInt</span>(duration.<span class="title function_">replace</span>(<span class="string">&#x27;0.&#x27;</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) * <span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>利用 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/api/sfc-css-features.html#v-bind-in-css">状态驱动css概念</a> 绑定响应式数据到<code>css</code>中</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=<span class="string">&quot;scss&quot;</span> scoped&gt;</span><br><span class="line">.<span class="property">fade</span>-enter-active,</span><br><span class="line">.<span class="property">fade</span>-leave-active &#123;</span><br><span class="line">  <span class="attr">transition</span>: all v-<span class="title function_">bind</span>(duration);</span><br><span class="line">&#125;</span><br><span class="line">........</span><br><span class="line"><span class="comment">// up动画</span></span><br><span class="line">.<span class="property">up</span>-enter-active,</span><br><span class="line">.<span class="property">up</span>-leave-active &#123;</span><br><span class="line">  <span class="attr">transition</span>: all v-<span class="title function_">bind</span>(duration);</span><br><span class="line">&#125;</span><br><span class="line">.......</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>取消按钮和确定按钮的点击事件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 取消按钮的点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onCancelClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">cancelHandler</span>) &#123;</span><br><span class="line">    props.<span class="title function_">cancelHandler</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确定按钮的点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onConfirmClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">confirmHandler</span>) &#123;</span><br><span class="line">    props.<span class="title function_">confirmHandler</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="api调用函数"><a href="#api调用函数" class="headerlink" title="api调用函数"></a><code>api</code>调用函数</h4><p><strong>函数的作用</strong>：</p>
<ul>
<li>1、当函数被调用时<code>confirm</code>组件展示</li>
<li>2、函数的返回值为<code>promise</code>对象、<ul>
<li>2.1、当用户点击取消按钮时、promise状态为<code>拒绝</code>状态</li>
<li>2.2、当用户点击确认按钮时、promise状态为<code>成功</code>状态</li>
</ul>
</li>
<li>3、<code>title</code>和<code>content</code>至少有一个、当<code>title</code>有时<code>content</code>没有时，把<code>title</code>的值赋值给<code>content</code>，<code>title</code>的值置为空</li>
</ul>
<p><strong>实现的一些api说明：</strong></p>
<p><strong>h函数</strong>：<a target="_blank" rel="noopener" href="https://cn.vuejs.org/api/render-function.html#h">官网</a> 根据传入的参数生成对应的<code>vnode</code> 虚拟<code>dom</code></p>
<p>​    常见的h函数的第一个参数一般都是标签名， 但在<code>vue3</code>提供的<strong>h函数</strong> <strong>第一个参数不但可以接收字符串变签名，还可以支持组件</strong></p>
<p><strong>render函数</strong>： 在vue3中有两种render： 第一种就是组件中的render，它返回一个vnode树； 第二种就是本次使用的render，它的作用就是将虚拟dom渲染到真实dom中</p>
<p>在<code>libs/confirm/index.js</code>中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, render &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> confirmComponent <span class="keyword">from</span> <span class="string">&#x27;./index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 展示confirm</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; title 标题（如果用户没有传递内容，那么标题被作为内容）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; content 文本内容（如果没有title，那么content会被作为第一个参数传入）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; cancelText 取消按钮文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; confirmText 确定按钮文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">confirm</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  title,</span></span><br><span class="line"><span class="params">  content,</span></span><br><span class="line"><span class="params">  cancelText = <span class="string">&#x27;取消&#x27;</span>,</span></span><br><span class="line"><span class="params">  confirmText = <span class="string">&#x27;确定&#x27;</span></span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 允许只传递 content</span></span><br><span class="line">    <span class="keyword">if</span> (title &amp;&amp; !content) &#123;</span><br><span class="line">      content = title</span><br><span class="line">      title = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭弹层事件 - 在用户点击关闭弹框后，会延时.5s执行，目的是让动画走完</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 3. 把渲染的 vnode 去掉 - 此时动画已经走完、所以将组件从页面中移除</span></span><br><span class="line">      <span class="title function_">render</span>(<span class="literal">null</span>, <span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取消按钮事件</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">cancelHandler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;取消按钮点击&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确定按钮事件</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">confirmHandler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 生成vnode - 通过h函数将confirm组件创建成对应的虚拟dom ， 第二项传入组件的属性值</span></span><br><span class="line">    <span class="keyword">const</span> vnode = <span class="title function_">h</span>(confirmComponent, &#123;</span><br><span class="line">      title,</span><br><span class="line">      content,</span><br><span class="line">      cancelText,</span><br><span class="line">      confirmText,</span><br><span class="line">      confirmHandler,</span><br><span class="line">      cancelHandler,</span><br><span class="line">      close</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 2. render渲染 - // 通过render函数创虚拟dom挂载到真实dom上</span></span><br><span class="line">    <span class="title function_">render</span>(vnode, <span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191508192.jpeg" alt="image-20220830172046623"> </p>
<ol>
<li>在<code>libs/index.js</code>导入并导出<code>confirm</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动化注册组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> &#123; confirm &#125; <span class="keyword">from</span> <span class="string">&#x27;./confirm&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/header/header-search/history</code>中</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> confirm <span class="keyword">from</span> <span class="string">&#x27;@/libs/confirm/index&#x27;</span></span><br><span class="line">  <span class="comment">// 删除所有搜索历史记录</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onDeleteAllClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">confirm</span>(<span class="string">&#x27;提示&#x27;</span>, <span class="string">&#x27;要删除所有历史记录吗？&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      store.<span class="title function_">commit</span>(<span class="string">&#x27;search/deleteAllHistory&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="25、通用组件message"><a href="#25、通用组件message" class="headerlink" title="25、通用组件message"></a>25、通用组件<code>message</code></h3><h4 id="图片下载功能"><a href="#图片下载功能" class="headerlink" title="图片下载功能"></a>图片下载功能</h4><p>功能：当点击图片item中的下载按钮时，可以下载当前的图片。<br>目前常用的支持下载功能包有两个：</p>
<pre><code> 1. 小文件下载：[file-saver](https://github.com/eligrey/FileSaver.js)
 2. 大文件下载：[streamsaver](https://github.com/jimmywarting/StreamSaver.js)
</code></pre><p>本项目图片下载属于小文件的下载，可以直接使用<code>file-saver</code></p>
<ol>
<li>安装file-saver ：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm i --save file-saver</span><br></pre></td></tr></table></figure>
<ol>
<li>在 <code>src/views/main/components/list/item.vue</code>中，增加下载功能：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">          &lt;!-- 图片内按钮 - 下载 --&gt;</span><br><span class="line">          &lt;m-button</span><br><span class="line">            class=&quot;absolute bottom-1.5 left-1.5 bg-zinc-100/70&quot;</span><br><span class="line">            type=&quot;info&quot;</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            icon=&quot;download&quot;</span><br><span class="line">            iconClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">            @click=&quot;onDownload&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">  .......</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; randomRGB &#125; from &#x27;@/utils/color&#x27;</span><br><span class="line">import &#123; saveAs &#125; from &#x27;file-saver&#x27;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">        type: Object,</span><br><span class="line">        required: true</span><br><span class="line">    &#125;,</span><br><span class="line">    width: &#123;</span><br><span class="line">        type: Number,</span><br><span class="line">        default: 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 图片下载按钮点击事件</span><br><span class="line"> const onDownload = () =&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 接收两个参数：</span><br><span class="line">     * 1. 下载的图片链接</span><br><span class="line">     * 2. 下载的文件名称</span><br><span class="line">     */</span><br><span class="line">    saveAs(props.data.photoDownLink)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="封装message组件"><a href="#封装message组件" class="headerlink" title="封装message组件"></a>封装<code>message</code>组件</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191509587.gif" alt="20220831_142332"> </p>
<p>之前构建过一个 <code>confirm</code> 的通用组件，该组件可以直接通过方法进行调用展示<br>而接下来的<code>message</code>组件，同样如此，依然通过方法的调用直接展示对应的组件。</p>
<p>根据之前的经验，<code>message</code>的构建过程应为:</p>
<ol>
<li><p>首先需要先构建出一个对应的<code>message/index.vue</code></p>
</li>
<li><p>然后构建出对应的<code>message/index.js</code>模块</p>
</li>
<li><p>在模块中，通过：</p>
<pre><code>1. `h`函数构建`vnode`
2. `render`函数，进行渲染
</code></pre><p>进行处理。</p>
</li>
</ol>
<p><strong><code>message</code>的功能：</strong></p>
<ul>
<li>1、要有四种状态：<code>success</code>、<code>warning</code>、<code>error</code>、<code>info</code></li>
<li>2、屏幕支持同时创建多个<code>message</code>，多个<code>message</code>自上而下排列</li>
<li>3、显示和隐藏时要有自上而下的过渡动画</li>
<li>4、当有新的<code>message</code>展示时，其他<code>message</code>要暂停隐藏、直到空闲<code>.5s</code>后再隐藏</li>
</ul>
<p><strong>主要说明</strong>：</p>
<blockquote>
<p>如果需要同屏显示多个message实例的话，需要对每一个message实例创建一个div、并将div挂载到页面上</p>
</blockquote>
<ol>
<li>创建<code>libs/message/index.vue</code>组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import mSvgIcon from &#x27;../svg-icon/index.vue&#x27;</span><br><span class="line">// 消息类型的可选项</span><br><span class="line">const typeEnum = [&#x27;success&#x27;, &#x27;warn&#x27;, &#x27;error&#x27;]</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  // message 的消息类型</span><br><span class="line">  type: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: true,</span><br><span class="line">    validator(val) &#123;</span><br><span class="line">      const result = typeEnum.includes(val)</span><br><span class="line">      if (!result) &#123;</span><br><span class="line">        throw new Error(`你的 type 必须是 $&#123;typeEnum.join(&#x27;、&#x27;)&#125; 中的一个`)</span><br><span class="line">      &#125;</span><br><span class="line">      return result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 描述文本</span><br><span class="line">  content: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 展示时长</span><br><span class="line">  duration: &#123;</span><br><span class="line">    type: Number</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  // 关闭message提示时的回调</span><br><span class="line">  destroy: &#123;</span><br><span class="line">    type: Function</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>构建各种状态下的样式表</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// message提示的样式表数据</span></span><br><span class="line"><span class="keyword">const</span> styles = &#123;</span><br><span class="line">  <span class="comment">// 警告</span></span><br><span class="line">  <span class="attr">warn</span>: &#123;</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>: <span class="string">&#x27;fill-warn-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>: <span class="string">&#x27;text-warn-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>: <span class="string">&#x27;bg-warn-100 border-warn-200  hover:shadow-lg hover:shadow-warn-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 错误</span></span><br><span class="line">  <span class="attr">error</span>: &#123;</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>: <span class="string">&#x27;fill-error-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>: <span class="string">&#x27;text-error-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>: <span class="string">&#x27;bg-error-100 border-error-200  hover:shadow-lg hover:shadow-error-100&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 成功</span></span><br><span class="line">  <span class="attr">success</span>: &#123;</span><br><span class="line">    <span class="attr">icon</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">fillClass</span>: <span class="string">&#x27;fill-success-300&#x27;</span>,</span><br><span class="line">    <span class="attr">textClass</span>: <span class="string">&#x27;text-success-300&#x27;</span>,</span><br><span class="line">    <span class="attr">containerClass</span>: <span class="string">&#x27;bg-success-100 border-success-200  hover:shadow-lg hover:shadow-success-100&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>配合样式表，构建对应的<code>template</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name=&quot;down&quot; @after-leave=&quot;destroy&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-show=&quot;isVisable&quot;</span><br><span class="line">      class=&quot;min-w-[420px] fixed top-[20px] left-[50%] translate-x-[-50%] z-50 flex items-center px-3 py-1.5 rounded-sm border cursor-pointer&quot;</span><br><span class="line">      :class=&quot;styles[type].containerClass&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        :name=&quot;styles[type].icon&quot;</span><br><span class="line">        :fillClass=&quot;styles[type].fillClass&quot;</span><br><span class="line">        class=&quot;h-1.5 w-1.5 mr-1.5&quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;span class=&quot;text-sm&quot; :class=&quot;styles[type].textClass&quot;&gt;</span><br><span class="line">        &#123;&#123; content &#125;&#125;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.down-enter-active,</span><br><span class="line">.down-leave-active &#123;</span><br><span class="line">  transition: all 0.5s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.down-enter-from,</span><br><span class="line">.down-leave-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translate3d(-50%, -100px, 0);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>处理展示逻辑</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制显示处理</span></span><br><span class="line"><span class="keyword">const</span> isVisable = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">// 保证动画展示，需要在 mounted 之后进行展示</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  isVisable.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 延迟时间关闭</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    isVisable.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  &#125;, props.<span class="property">duration</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>新增<code>tailwind</code>的自定义样式</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;success-100&#x27;</span>: <span class="string">&#x27;#F2F9EC&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;success-200&#x27;</span>: <span class="string">&#x27;#E4F2DB&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;success-300&#x27;</span>: <span class="string">&#x27;#7EC050&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;warn-100&#x27;</span>: <span class="string">&#x27;#FCF6ED&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;warn-200&#x27;</span>: <span class="string">&#x27;#F8ECDA&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;warn-300&#x27;</span>: <span class="string">&#x27;#DCA550&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;error-100&#x27;</span>: <span class="string">&#x27;#ED7456&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;error-200&#x27;</span>: <span class="string">&#x27;#f3471c&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;error-300&#x27;</span>: <span class="string">&#x27;#ffffff&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="组件的展示"><a href="#组件的展示" class="headerlink" title="组件的展示"></a>组件的展示</h4><ol>
<li>在<code>libs/message/index.js</code>中的展示方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, render &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> messageComponent <span class="keyword">from</span> <span class="string">&#x27;./index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">message</span> = (<span class="params">type, content, duration = <span class="number">3000</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 动画结束时的回调</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">onDestroy</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 3. message 销毁</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="literal">null</span>, <span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 返回 vnode</span></span><br><span class="line">  <span class="keyword">const</span> vnode = <span class="title function_">h</span>(messageComponent, &#123;</span><br><span class="line">    type,</span><br><span class="line">    content,</span><br><span class="line">    duration,</span><br><span class="line">    <span class="attr">destroy</span>: onDestroy</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 2. render</span></span><br><span class="line">  <span class="title function_">render</span>(vnode, <span class="variable language_">document</span>.<span class="property">body</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>libs/index.js</code>中导出方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动化注册组件</span></span><br><span class="line"><span class="keyword">export</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;./message&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>item</code>中使用</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; randomRGB &#125; from &#x27;@/utils/color&#x27;</span><br><span class="line">import &#123; saveAs &#125; from &#x27;file-saver&#x27;</span><br><span class="line">import &#123; message &#125; from &#x27;@/libs&#x27;;</span><br><span class="line">.....</span><br><span class="line">// 图片下载按钮点击事件</span><br><span class="line">const onDownload = () =&gt; &#123;</span><br><span class="line">  // 提示消息</span><br><span class="line">  message(&#x27;success&#x27;, &#x27;图片开始下载&#x27;)</span><br><span class="line">  // 延迟一段时间执行，可以得到更好的体验</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 接收两个参数：</span><br><span class="line">     * 1. 下载的图片链接</span><br><span class="line">     * 2. 下载的文件名称</span><br><span class="line">     */</span><br><span class="line">    saveAs(</span><br><span class="line">      props.data.photoDownLink,</span><br><span class="line">      `$&#123;props.data.title&#125; - 作者：$&#123;props.data.author&#125;`</span><br><span class="line">    )</span><br><span class="line">  &#125;, 100)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>前中台解决方案项目（上）</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8A%EF%BC%89/">http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8A%EF%BC%89/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>IZDLOYL</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2024-08-19</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-08-26</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue3/">vue3</a></div><div class="post_share"><div class="social-share" data-image="https://source.fomal.cc/img/default_cover_4.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="前中台解决方案项目（下）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/dm2.webb" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">前中台解决方案项目（下）</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/02/algorithm-%E5%AD%97%E7%AC%A6%E4%B8%B2/" title="字符串篇"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper6.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">字符串篇</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="前中台解决方案项目（下）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/dm2.webb" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-19</div><div class="title">前中台解决方案项目（下）</div></div></a></div><div><a href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%AD%EF%BC%89/" title="前中台解决方案项目（中）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-19</div><div class="title">前中台解决方案项目（中）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">IZDLOYL</div><div class="author-info__description">🎬𝙏𝙪𝙧𝙣 𝙤𝙛𝙛 𝙬𝙤𝙧𝙧𝙮✨</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/IZDLOYL-G"><i class="fab fa-github"></i><span>🛴前往小家...</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/IZDLOYL-G" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1215472755@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #dfc600;"></i></a><a class="social-icon" href="https://res.abeim.cn/api/qq/?qq=1174008660" target="_blank" title="Weixin"><i class="fab fa-weixin" style="color: #48b700;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">welcome to my blog!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-Vue3%E6%89%93%E9%80%A0%E5%89%8D%E5%8F%B0-%E4%B8%AD%E5%8F%B0%E9%80%9A%E7%94%A8%E6%8F%90%E6%95%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">基于 Vue3打造前台+中台通用提效解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84"><span class="toc-text">1、项目架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81vite-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2、vite 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vite%E5%AF%B9%E6%AF%94webpack"><span class="toc-text">vite对比webpack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vite%E7%BC%BA%E7%82%B9"><span class="toc-text">vite缺点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E6%98%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%9A%84"><span class="toc-text">官方是如何解决的</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE"><span class="toc-text">3、初始化项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81tailwindcss%E5%B7%A5%E5%85%B7"><span class="toc-text">4、tailwindcss工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E5%BC%80%E5%8F%91css%E7%97%9B%E7%82%B9"><span class="toc-text">传统开发css痛点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85tailwindcss"><span class="toc-text">安装tailwindcss</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-text">5、项目结构分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-text">移动端结构分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PC%E7%AB%AF%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-text">PC端结构分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-text">6、项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E4%BC%81%E4%B8%9A%E7%BA%A7vite%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88"><span class="toc-text">7、企业级vite配置方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%98%AF%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%96%B9%E6%B3%95"><span class="toc-text">封装判断是否是移动端方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E3%80%81%E5%88%A4%E6%96%AD%E5%BD%93%E5%89%8D%E6%98%AF%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%BF%98%E6%98%AFpc%E7%AB%AF%E5%8A%A0%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-text">配置路由、判断当前是移动端还是pc端加载对应的路由</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81vite%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE"><span class="toc-text">8、vite中的一些配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E4%BB%A3%E7%90%86src%E8%B7%AF%E5%BE%84"><span class="toc-text">@符号代理src路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%B8%8B%E8%B7%A8%E5%9F%9F%E4%BB%A3%E7%90%86"><span class="toc-text">开发环境下跨域代理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AErem%E5%B9%B6%E4%BF%AE%E6%94%B9tailmindcss%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="toc-text">9、动态设置rem并修改tailmindcss默认配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E5%B0%81%E8%A3%85%E9%80%9A%E7%94%A8%E7%9A%84svg-icon"><span class="toc-text">10、封装通用的svg-icon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E7%A7%BB%E5%8A%A8%E7%AB%AFnavigation%E5%A4%B4%E9%83%A8%E6%95%88%E6%9E%9C"><span class="toc-text">11、移动端navigation头部效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81%E5%B0%81%E8%A3%85%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-popup"><span class="toc-text">12、封装通用组件  popup</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E5%8A%9F%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">双向数据绑定功能优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%E6%B3%A8%E5%86%8C"><span class="toc-text">通用组件注册</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E7%82%B9%E5%87%BB%E9%A1%B9%E5%B1%95%E7%A4%BA%E5%9C%A8%E5%B1%8F%E5%B9%95%E6%AD%A3%E4%B8%AD%E5%A4%AE%EF%BC%8C%E5%B9%B6%E5%8A%A0%E4%B8%8A%E8%BF%87%E6%B8%A1%E6%95%88%E6%9E%9C"><span class="toc-text">将点击项展示在屏幕正中央，并加上过渡效果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E3%80%81%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B3%A8%E5%86%8C"><span class="toc-text">13、通用组件自动化注册</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14%E3%80%81PC%E7%AB%AF%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84"><span class="toc-text">14、PC端基础架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#header%E6%A8%A1%E5%9D%97%E7%9A%84%E7%AE%80%E5%8D%95%E6%90%AD%E5%BB%BA"><span class="toc-text">header模块的简单搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15%E3%80%81%E5%B0%81%E8%A3%85%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-search"><span class="toc-text">15、封装通用组件 search</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#search-%E6%90%9C%E7%B4%A2%E6%A1%86%E8%83%BD%E5%8A%9B%E5%88%86%E6%9E%90"><span class="toc-text">search 搜索框能力分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#search-%E6%90%9C%E7%B4%A2%E6%A1%86%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86"><span class="toc-text">search 搜索框样式处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E5%96%84search%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-text">完善search基本功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16%E3%80%81%E5%B0%81%E8%A3%85%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-button"><span class="toc-text">16、封装通用组件 button</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17%E3%80%81%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-popover"><span class="toc-text">17、通用组件 popover</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-text">基础功能实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%EF%BC%9A%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2"><span class="toc-text">组件使用：主题切换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E6%85%A2%E9%80%9F%E7%A7%BB%E5%8A%A8%E6%97%B6%EF%BC%8C%E5%A4%84%E7%90%86%E6%B0%94%E6%B3%A1%E6%B6%88%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="toc-text">鼠标慢速移动时，处理气泡消失问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%EF%BC%9A%E4%B8%AA%E4%BA%BA%E4%B8%AD%E5%BF%83"><span class="toc-text">组件使用：个人中心</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18%E3%80%81%E5%93%8D%E5%BA%94%E5%BC%8F%E4%B8%8B-navigationBar-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">18、响应式下 navigationBar 的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E5%88%86%E6%9E%90"><span class="toc-text">实现方案分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8vuex%E4%B8%AD%E5%B0%81%E8%A3%85%E6%95%B0%E6%8D%AE"><span class="toc-text">在vuex中封装数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PC%E7%AB%AF%E4%B8%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B1%95%E7%A4%BA"><span class="toc-text">PC端下的基本展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%97%AA%E7%83%81%E9%97%AE%E9%A2%98"><span class="toc-text">解决闪烁问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19%E3%80%81%E5%AE%9E%E7%8E%B0%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2"><span class="toc-text">19、实现主题切换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%81%E7%AE%80%E7%99%BD%E5%92%8C%E6%9E%81%E5%A4%9C%E9%BB%91"><span class="toc-text">极简白和极夜黑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%9F%E9%9A%8F%E7%B3%BB%E7%BB%9F%E5%8F%98%E6%9B%B4%E4%B8%BB%E9%A2%98"><span class="toc-text">跟随系统变更主题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20%E3%80%81%E5%AE%9E%E7%8E%B0%E7%80%91%E5%B8%83%E6%B5%81%E5%B8%83%E5%B1%80"><span class="toc-text">20、实现瀑布流布局</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80%E5%88%97%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="toc-text">构建基础列表展示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%80%91%E5%B8%83%E6%B5%81%E7%BB%84%E4%BB%B6%E6%9E%84%E5%BB%BA%E5%88%86%E6%9E%90"><span class="toc-text">瀑布流组件构建分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AE%B9%E5%99%A8%E5%AE%BD%E5%BA%A6%E5%92%8C%E5%88%97%E5%AE%BD"><span class="toc-text">获取容器宽度和列宽</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BA%E5%88%86%E5%9B%BE%E7%89%87%E9%A2%84%E5%8A%A0%E8%BD%BD"><span class="toc-text">区分图片预加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%AE%9A%E4%BD%8Ditem%E4%BD%8D%E7%BD%AE"><span class="toc-text">*计算定位item位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%80%91%E5%B8%83%E6%B5%81%E5%B1%95%E7%A4%BA%E4%B8%8D%E5%85%A8"><span class="toc-text">解决瀑布流展示不全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E7%A7%BB%E5%8A%A8%E7%AB%AF%EF%BC%8C%E5%8A%A8%E6%80%81%E5%88%97"><span class="toc-text">适配移动端，动态列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%97%A0%E9%9C%80%E5%9B%BE%E7%89%87%E9%A2%84%E5%8A%A0%E8%BD%BD%E6%97%B6"><span class="toc-text">优化无需图片预加载时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21%E3%80%81%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-infinite"><span class="toc-text">21、通用组件  infinite</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%95%BF%E5%88%97%E8%A1%A8%E7%BB%84%E4%BB%B6"><span class="toc-text">构建长列表组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E5%90%88%E7%80%91%E5%B8%83%E6%B5%81%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">结合瀑布流组件的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%A6%96%E6%AC%A1%E6%95%B0%E6%8D%AE%E6%97%A0%E6%B3%95%E9%93%BA%E6%BB%A1%E5%85%A8%E5%B1%8F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">解决首次数据无法铺满全屏的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22%E3%80%81%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD%E6%8C%87%E4%BB%A4"><span class="toc-text">22、实现图片懒加载指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%87%92%E5%8A%A0%E8%BD%BDv-lazy%E6%8C%87%E4%BB%A4"><span class="toc-text">实现懒加载v-lazy指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E7%9A%84%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C"><span class="toc-text">指令的自动注册</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%9B%BE%E7%89%87%E5%BD%A9%E8%89%B2%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="toc-text">指定图片彩色占位符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23%E3%80%81%E5%A4%9A%E7%BB%84%E4%BB%B6%E8%81%94%E5%8A%A8"><span class="toc-text">23、多组件联动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NavigationBar%E5%AF%B9%E5%BA%94list"><span class="toc-text">NavigationBar对应list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#searchBar%E5%AF%B9%E5%BA%94list"><span class="toc-text">searchBar对应list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%90%9C%E7%B4%A2%E6%8F%90%E7%A4%BA"><span class="toc-text">获取搜索提示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%98%B2%E6%8A%96%E5%8A%9F%E8%83%BD"><span class="toc-text">处理防抖功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E9%AB%98%E4%BA%AE"><span class="toc-text">实现关键字的高亮</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2"><span class="toc-text">搜索历史</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E7%83%AD%E9%97%A8%E7%B2%BE%E9%80%89%E6%A8%A1%E5%9D%97"><span class="toc-text">构建热门精选模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#searchBar%E4%B8%8Elist%E7%9A%84%E8%81%94%E5%8A%A8"><span class="toc-text">searchBar与list的联动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24%E3%80%81%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-confirm"><span class="toc-text">24、通用组件 confirm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BAconfirm%E7%BB%84%E4%BB%B6"><span class="toc-text">构建confirm组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#api%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text">api调用函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25%E3%80%81%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6message"><span class="toc-text">25、通用组件message</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD"><span class="toc-text">图片下载功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85message%E7%BB%84%E4%BB%B6"><span class="toc-text">封装message组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B1%95%E7%A4%BA"><span class="toc-text">组件的展示</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/29/interview-%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1/" title="前端八股"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端八股"/></a><div class="content"><a class="title" href="/2024/08/29/interview-%E5%89%8D%E7%AB%AF%E5%85%AB%E8%82%A1/" title="前端八股">前端八股</a><time datetime="2024-08-29T13:06:26.092Z" title="发表于 2024-08-29 21:06:26">2024-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/27/interview-%E6%80%BB%E7%BB%93/" title="项目总结"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="项目总结"/></a><div class="content"><a class="title" href="/2024/08/27/interview-%E6%80%BB%E7%BB%93/" title="项目总结">项目总结</a><time datetime="2024-08-27T12:58:34.417Z" title="发表于 2024-08-27 20:58:34">2024-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/23/frontEnd-nodejs/" title="node"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/dm2.webb" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="node"/></a><div class="content"><a class="title" href="/2024/08/23/frontEnd-nodejs/" title="node">node</a><time datetime="2024-08-23T08:14:35.116Z" title="发表于 2024-08-23 16:14:35">2024-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/23/frontEnd-JavaScript/" title="JS基本语法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS基本语法"/></a><div class="content"><a class="title" href="/2024/08/23/frontEnd-JavaScript/" title="JS基本语法">JS基本语法</a><time datetime="2024-08-23T08:06:33.574Z" title="发表于 2024-08-23 16:06:33">2024-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/23/frontEnd-TypeScript/" title="TypeScript"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TypeScript"/></a><div class="content"><a class="title" href="/2024/08/23/frontEnd-TypeScript/" title="TypeScript">TypeScript</a><time datetime="2024-08-23T08:06:10.608Z" title="发表于 2024-08-23 16:06:10">2024-08-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By IZDLOYL</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hope you have a nice day!🍭🍭🍭</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/前端/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 IZDLOYLの前端笔记 (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/项目/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 IZDLOYLの项目 (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/算法/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🐱 IZDLOYLの算法笔记 (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/面试/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 IZDLOYLの面试总结 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="http://www.izdloyl.cn/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #69e8f2}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/23/frontEnd-JavaScript/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper7.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="2024/08/23/frontEnd-JavaScript/" alt="">JS基本语法</a><div class="blog-slider__text">前端学习笔记</div><a class="blog-slider__button" href="2024/08/23/frontEnd-JavaScript/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/23/frontEnd-TypeScript/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper3.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="2024/08/23/frontEnd-TypeScript/" alt="">TypeScript</a><div class="blog-slider__text">前端学习笔记</div><a class="blog-slider__button" href="2024/08/23/frontEnd-TypeScript/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/01/frontEnd-vue3/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_4.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-01</span><a class="blog-slider__title" href="2024/08/01/frontEnd-vue3/" alt="">vue3</a><div class="blog-slider__text">vue3学习笔记</div><a class="blog-slider__button" href="2024/08/01/frontEnd-vue3/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/23/frontEnd-nodejs/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/dm2.webb" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="2024/08/23/frontEnd-nodejs/" alt="">node</a><div class="blog-slider__text">前端学习笔记</div><a class="blog-slider__button" href="2024/08/23/frontEnd-nodejs/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/01/frontEnd-vue2/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper1.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-01</span><a class="blog-slider__title" href="2024/08/01/frontEnd-vue2/" alt="">vue2</a><div class="blog-slider__text">vue2学习笔记</div><a class="blog-slider__button" href="2024/08/01/frontEnd-vue2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/02/algorithm-数组/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper2.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-02</span><a class="blog-slider__title" href="2024/08/02/algorithm-数组/" alt="">数组篇</a><div class="blog-slider__text">代码随想录 - 数组篇</div><a class="blog-slider__button" href="2024/08/02/algorithm-数组/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/02/algorithm-hot100/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper6.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-02</span><a class="blog-slider__title" href="2024/08/02/algorithm-hot100/" alt="">hot100</a><div class="blog-slider__text">LeetCode - hot100</div><a class="blog-slider__button" href="2024/08/02/algorithm-hot100/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/02/algorithm-字符串/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper6.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-02</span><a class="blog-slider__title" href="2024/08/02/algorithm-字符串/" alt="">字符串篇</a><div class="blog-slider__text">代码随想录 - 字符串篇</div><a class="blog-slider__button" href="2024/08/02/algorithm-字符串/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>