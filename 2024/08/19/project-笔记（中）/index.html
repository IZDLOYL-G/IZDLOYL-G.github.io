<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>前中台解决方案项目（中） | IZDLOYL's Blog</title><meta name="author" content="IZDLOYL"><meta name="copyright" content="IZDLOYL"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="26、实现全屏展示功能在原生dom上，提供了一些方法来供我们开启或关闭全屏：  Element.requestFullscreen() Document.exitFullscreen() Document.fullscreen Document.fullscreenElement  想要让页面的指定区域进行全屏展示，可以使用 全屏APL。其中提供了两个方法：  Element.requestFul">
<meta property="og:type" content="article">
<meta property="og:title" content="前中台解决方案项目（中）">
<meta property="og:url" content="http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%AD%EF%BC%89/index.html">
<meta property="og:site_name" content="IZDLOYL&#39;s Blog">
<meta property="og:description" content="26、实现全屏展示功能在原生dom上，提供了一些方法来供我们开启或关闭全屏：  Element.requestFullscreen() Document.exitFullscreen() Document.fullscreen Document.fullscreenElement  想要让页面的指定区域进行全屏展示，可以使用 全屏APL。其中提供了两个方法：  Element.requestFul">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://source.fomal.cc/img/default_cover_8.webb">
<meta property="article:published_time" content="2024-08-19T06:41:18.496Z">
<meta property="article:modified_time" content="2024-08-26T08:53:54.616Z">
<meta property="article:author" content="IZDLOYL">
<meta property="article:tag" content="vue3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://source.fomal.cc/img/default_cover_8.webb"><link rel="shortcut icon" href="/gallery/favicon.jpg"><link rel="canonical" href="http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%AD%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '前中台解决方案项目（中）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-26 16:53:54'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-category"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://source.fomal.cc/img/default_cover_8.webb')"><nav id="nav"><span id="blog-info"><a href="/" title="IZDLOYL's Blog"><span class="site-name">IZDLOYL's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-category"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">前中台解决方案项目（中）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-19T06:41:18.496Z" title="发表于 2024-08-19 14:41:18">2024-08-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-26T08:53:54.616Z" title="更新于 2024-08-26 16:53:54">2024-08-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">28.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>129分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="前中台解决方案项目（中）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="26、实现全屏展示功能"><a href="#26、实现全屏展示功能" class="headerlink" title="26、实现全屏展示功能"></a>26、实现全屏展示功能</h3><p>在原生<code>dom</code>上，提供了一些方法来供我们开启或关闭全屏：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/requestFullScreen"><code>Element.requestFullscreen()</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/exitFullscreen"><code>Document.exitFullscreen()</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/fullscreen"><code>Document.fullscreen</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/fullscreenElement"><code>Document.fullscreenElement</code></a></li>
</ul>
<p>想要让页面的指定区域进行全屏展示，可以使用 全屏APL。其中提供了两个方法：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/requestFullScreen"><code>Element.requestFullscreen()</code></a>：让指定元素进行全屏</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>).<span class="title function_">requestFullscreen</span>()</span><br></pre></td></tr></table></figure>
<ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document/exitFullscreen"><code>Document.exitFullscreen()</code></a>：退出全屏</li>
</ol>
<p>但是这个 API 比较原始，使用起来没有那么方便，可以使用vueuse中的更加简便的<br>API ：useFullScreen</p>
<ol>
<li>利用 <code>useFullScreen</code> 生成<code>img</code>图片的全屏方法：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useFullscreen &#125; <span class="keyword">from</span> <span class="string">&#x27;@vueuse/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="comment">// 生成全屏方法</span></span><br><span class="line"><span class="keyword">const</span> imgTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">enter</span>: onImgFullScreen &#125; = <span class="title function_">useFullscreen</span>(imgTarget)</span><br></pre></td></tr></table></figure>
<ol>
<li>将<code>onImgFullScreen</code>绑定至全屏按钮点击事件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 图片内按钮 - 全屏 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">m-button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">class</span>=<span class="string">&quot;absolute bottom-1.5 right-1.5 bg-zinc-100/70&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">type</span>=<span class="string">&quot;info&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">icon</span>=<span class="string">&quot;full&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">iconClass</span>=<span class="string">&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  @<span class="attr">click</span>=<span class="string">&quot;onImgFullScreen&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">/&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="27、floating基础布局"><a href="#27、floating基础布局" class="headerlink" title="27、floating基础布局"></a>27、<code>floating</code>基础布局</h3><p>在<code>view/layout/components/floating.vue</code>中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;fixed bottom-10 right-2&quot;&gt;</span><br><span class="line">    &lt;!-- 引导页 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;guide-start w-4 h-4 mb-1 bg-white dark:bg-zinc-900 border dark:border-0 border-zinc-200 rounded-full flex justify-center items-center cursor-pointer duration-200 group hover:shadow-lg&quot;</span><br><span class="line">      @click=&quot;onGuideClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;m-svg-icon</span><br><span class="line">        name=&quot;guide&quot;</span><br><span class="line">        class=&quot;w-2 h-2&quot;</span><br><span class="line">        fillClass=&quot;fill-zinc-900 dark:fill-zinc-200 group-hover:fill-main &quot;</span><br><span class="line">      &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 反馈 --&gt;</span><br><span class="line">    &lt;m-popover class=&quot;flex items-center guide-feedback&quot; placement=&quot;top-left&quot;&gt;</span><br><span class="line">      &lt;template #reference&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&quot;w-4 h-4 bg-white dark:bg-zinc-900 border dark:border-0 border-zinc-200 rounded-full flex justify-center items-center cursor-pointer duration-200 group hover:shadow-lg&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&quot;feedback&quot;</span><br><span class="line">            class=&quot;w-2 h-2&quot;</span><br><span class="line">            fillClass=&quot;fill-zinc-900 dark:fill-zinc-200 group-hover:fill-main &quot;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">      &lt;!-- 鼠标移入 - 立即吐槽弹出框 --&gt;</span><br><span class="line">      &lt;div class=&quot;w-[140px] overflow-hidden&quot;&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&quot;flex items-center p-1 cursor-pointer rounded hover:bg-zinc-100/60 dark:hover:bg-zinc-800&quot;</span><br><span class="line">          @click=&quot;onToFeedback&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&quot;feedback&quot;</span><br><span class="line">            class=&quot;w-1.5 h-1.5 mr-1&quot;</span><br><span class="line">            fillClass=&quot;fill-zinc-900 dark:fill-zinc-300&quot;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;span class=&quot;text-zinc-800 dark:text-zinc-300 text-sm&quot;&gt;立即吐槽&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/m-popover&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<h4 id="处理scrollBar样式"><a href="#处理scrollBar样式" class="headerlink" title="处理scrollBar样式"></a>处理scrollBar样式</h4><p>对于 tailwind 而言，默认并没有提供 scrollBar 的样式类名，想要处理 scrollBar 的样式，需要安装单独的插件：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/tailwind-scrollbar">tailwind-scrollbar</a></p>
<ol>
<li>安装插件：</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm install <span class="literal">--save-dev</span> tailwind<span class="literal">-scrollbar</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>tailwind.config.js</code>中注册该插件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&#x27;tailwind-scrollbar&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>tailwind.config.js</code>中，让<code>scrollBar</code>支持<code>dark</code>模式</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">theme</span>: &#123;</span><br><span class="line">  <span class="attr">extend</span>: &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="attr">variants</span>: &#123;</span><br><span class="line">      <span class="attr">scrollbar</span>: [<span class="string">&#x27;dark&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>main/index.vue</code>的<code>div class</code>和<code>libs/search/index.vue</code>中的<code>下拉区class</code>使用</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrollbar-thin scrollbar-thumb-transparent xl:scrollbar-thumb-zinc-<span class="number">200</span> xl:dark:scrollbar-thumb-zinc-<span class="number">900</span> scrollbar-track-transparent</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>styles/index.scss</code>中为<code>scrollBar</code>指定弧度（1.3.1通过属性指定弧度无效）</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">::-webkit-scrollbar-thumb &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="实现网站引导功能"><a href="#实现网站引导功能" class="headerlink" title="实现网站引导功能"></a>实现网站引导功能</h4><ol>
<li>安装<code>driver.js</code></li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm install <span class="literal">--save</span> driver.js</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/floating/index.vue</code>中导入对应模块</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; driver &#125; <span class="keyword">from</span> <span class="string">&#x27;driver.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;driver.js/dist/driver.css&quot;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>初始化<code>Driver</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引导页处理</span></span><br><span class="line"><span class="keyword">let</span> driverObj = <span class="literal">null</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  driverObj = <span class="title function_">driver</span>(&#123;</span><br><span class="line">    <span class="comment">// 禁止点击蒙版关闭</span></span><br><span class="line">    <span class="attr">allowClose</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">closeBtnText</span>: <span class="string">&#x27;关闭&#x27;</span>,</span><br><span class="line">    <span class="attr">nextBtnText</span>: <span class="string">&#x27;下一步&#x27;</span>,</span><br><span class="line">    <span class="attr">prevBtnText</span>: <span class="string">&#x27;上一步&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/floating/steps.js</code>中设置引导步骤</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">element</span>: <span class="string">&#x27;.guide-home&#x27;</span>, <span class="comment">// 在哪个元素中高亮</span></span><br><span class="line">      <span class="comment">// 配置对象</span></span><br><span class="line">      <span class="attr">popover</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;logo&#x27;</span>, <span class="comment">// 标题</span></span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;点击可返回首页&#x27;</span> <span class="comment">// 描述</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">element</span>: <span class="string">&#x27;.guide-search&#x27;</span>,</span><br><span class="line">      <span class="attr">popover</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;搜索&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;搜索您期望的图片&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">element</span>: <span class="string">&#x27;.guide-theme&#x27;</span>,</span><br><span class="line">      <span class="attr">popover</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;风格&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;选择一个您喜欢的风格&#x27;</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;left&#x27;</span> <span class="comment">// 弹出的位置</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">element</span>: <span class="string">&#x27;.guide-my&#x27;</span>,</span><br><span class="line">      <span class="attr">popover</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;账户&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;这里标记了您的账户信息&#x27;</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;left&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">element</span>: <span class="string">&#x27;.guide-start&#x27;</span>,</span><br><span class="line">      <span class="attr">popover</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;引导&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;这里可再次查看引导信息&#x27;</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;left&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">element</span>: <span class="string">&#x27;.guide-feedback&#x27;</span>,</span><br><span class="line">      <span class="attr">popover</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;反馈&#x27;</span>,</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&#x27;您的任何不满都可以在这里告诉我们&#x27;</span>,</span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;left&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/floating/index.vue</code>中设置引导点击事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;fixed bottom-10 right-2&quot;&gt;</span><br><span class="line">    &lt;!-- 引导页 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;guide-start w-4 h-4 mb-1 bg-white dark:bg-zinc-900 border dark:border-0 border-zinc-200 rounded-full flex justify-center items-center cursor-pointer duration-200 group hover:shadow-lg&quot;</span><br><span class="line">      @click=&quot;onGuideClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      .......</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">......</span><br><span class="line">import steps from &#x27;./steps&#x27;</span><br><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">......</span><br><span class="line">// 点击floating引导</span><br><span class="line">const onGuideClick = () =&gt; &#123;</span><br><span class="line">  driverObj.setSteps(steps) // 设置步骤</span><br><span class="line">  driverObj.drive() //从头开始</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="处理引导样式问题"><a href="#处理引导样式问题" class="headerlink" title="处理引导样式问题"></a>处理引导样式问题</h4><ol>
<li>在<code>styles/index.scss</code>中解决<code>引导</code>功能按钮不在同一水平线的问题</li>
</ol>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.driver-fix-stacking</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.driver-navigation-btns</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/floating/index.vue</code>中解决<code>引导到floating</code>时<code>引导</code>和<code>反馈</code>发生错位的情况</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.driver-fix-stacking &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  z-index: 100004 !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h3 id="28、首页跳转到图片详情页"><a href="#28、首页跳转到图片详情页" class="headerlink" title="28、首页跳转到图片详情页"></a>28、首页跳转到图片详情页</h3><ul>
<li>当点击某一个图片时、跳转到对应图片的详情页</li>
<li>并且在跳转的过程中有从小到放大的动画的效果（类似于全屏效果的动画）</li>
</ul>
<p>在 vue 中，两个路由进行跳转的时候，有时候会为其增加一些跳转的过渡动画，这是一个非常常见的需求。通常情况下，这种过渡动画，可以直接使用 <a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/guide/advanced/transitions.html">过渡动效 | Vue Router</a> 来进行实现。</p>
<p>对于本项目而言，当点击 图片item 进入 详情页 的时候，需要有一个对应的过渡动效，从而提升用户体验。</p>
<p>这个过渡动效需要<br>    1、同时在 <code>PC 端</code> 和 <code>移动端</code> 生效<br>    2、进入新页面时：在点击的具体 item 中呈现 <strong>由小到大的缩放动画</strong><br>    3、退出新页面时：呈现 <strong>由大到小的缩放动画</strong> 缩回至点击的具体 item 中</p>
<h4 id="VueRouter过渡动效分析"><a href="#VueRouter过渡动效分析" class="headerlink" title="VueRouter过渡动效分析"></a>VueRouter过渡动效分析</h4><p>在<a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/guide/advanced/transitions.html">vue-router</a>页面跳转如果要实现跳转到动画，需要借助于<a target="_blank" rel="noopener" href="https://cn.vuejs.org/guide/built-ins/transition.html#the-transition-component">transition</a>组件来进行实现动画</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用动态过渡名称 --&gt;</span><br><span class="line">&lt;router-view v-slot=&quot;&#123; Component, route &#125;&quot;&gt;</span><br><span class="line">  &lt;transition :name=&quot;route.meta.transition&quot;&gt;</span><br><span class="line">    &lt;component :is=&quot;Component&quot; /&gt;</span><br><span class="line">  &lt;/transition&gt;</span><br><span class="line">&lt;/router-view&gt;</span><br></pre></td></tr></table></figure>
<p>以上这段代码是实现过渡动效的关键代码。其中涉及到了三个组件：<br>    1、router-view：路由出口<br>    2、transition：动画组件<br>    3、component：动态组件</p>
<p>据此可知，<code>vue-router</code> 过渡动效产生的关键就是 <code>transition</code> 动画组件。但对于 <code>transition</code> 而言，它能够产生动画的关键，其实是其内部元素<code>component</code> 的动态组件切换。</p>
<p>但这样的切换一定是基于整个<strong>页面组件</strong>的。也就是说如果利用这种过渡动效，那么一定是：<strong>从 <code>home</code> 页面到<code>detall</code>页面</strong> 的整体页面组件的切换。所以是 无法 实现期望的这种路由过渡效果的。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>路由的跳转指的是两个部分：<br>​    1、浏览器的url 发生了变化<br>    2、浏览器中展示的页面组件发生了变化</p>
<p>只要满足这两点，就可以认为路径进行了跳转。</p>
<p><strong>不去进行真实的路由跳转，而是先修改浏览器的<code>URL</code>，再切换展示的页面(以组件的形式覆盖整个浏览器的可视区域)。这样对于用户而言，就完成了整个的路由跳转工作。</strong></p>
<p>所以说问题就变成了：</p>
<ul>
<li>1、如何让浏览器的<code>url</code>发生变化,但是不跳转页面</li>
<li>2、如何让一个新的组件以包含动画的形式进行展示<ul>
<li>那么想要完成第一个功能我们可以使用：<code>History.pushState()</code>方法</li>
<li>而第二个功能我们可以使用 <code>GSAP</code>这个动画库来进行实现。</li>
</ul>
</li>
</ul>
<ol>
<li>在<code>view/main/components/list/item.vue</code>中设置点击进入图片详情事件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bg-white dark:bg-zinc-900 xl:dark:bg-zinc-800 rounded pb-1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">class</span>=<span class="string">&quot;relative w-full rounded cursor-zoom-in group&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">:style</span>=<span class="string">&quot;&#123; backgroundColor: randomRGB() &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        @<span class="attr">click</span>=<span class="string">&quot;onToPinsClick&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        ........</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="string">&#x27;click&#x27;</span>])</span><br><span class="line"><span class="comment">// 点击进入图片详情事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPinsClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: props.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在父组件<code>list/index.vue</code>中修改浏览器的URL路径</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    ......</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot</span>=<span class="string">&quot;&#123; item, width &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">itemVue</span> <span class="attr">:data</span>=<span class="string">&quot;item&quot;</span> <span class="attr">:width</span>=<span class="string">&quot;width&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onToPins&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">m-waterfall</span>&gt;</span></span></span><br><span class="line">    &lt;/m-infinite&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">......</span><br><span class="line"><span class="comment">// 进入 pins</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPins</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  history.<span class="title function_">pushState</span>(<span class="literal">null</span>, <span class="literal">null</span>, <span class="string">`/pins/<span class="subst">$&#123;item.id&#125;</span>`</span>) <span class="comment">// 修改浏览器的URL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="基于GSAP实现"><a href="#基于GSAP实现" class="headerlink" title="基于GSAP实现"></a>基于GSAP实现</h4><p>当<code>url</code>发生变化之后，接下来就只需要处理对应的动画就可以了，动画的处理依赖于 <a target="_blank" rel="noopener" href="https://github.com/greensock/GSAP">GSAP</a> 进行实现。对于<code>GSAP</code>而言，主要依赖两个方法：</p>
<ol>
<li>gsap.set()：这个方法通常使用在动画开始之前，表示设置动画开始前的元素属性</li>
<li>gsap.to()：这个方法表示 <strong>最终元素展示的状态</strong></li>
</ol>
<p><code>GSAP</code>会基于<code>set</code>和<code>to</code>的状态，来自动执行中间的补间动画<br>所以只需要：</p>
<ol>
<li>创建一个对应的组件，使用<code>transition</code>进行包裹</li>
<li>计算出<code>set</code>时，组件元素对应的样式属性</li>
<li>计算出<code>to</code>时，组件元素对应的样式属性</li>
</ol>
<p>然后就可以由<code>GSAP</code>自动实现对应的补间动画了</p>
<p>具体实现步骤：</p>
<ol>
<li><p>创建<code>view/pins/index.vue</code>组件</p>
</li>
<li><p>创建<code>view/pins/components/pins.vue</code>组件，该组件即为图片详情组件</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;fixed left-0 top-0 w-screen h-screen z-20 backdrop-blur-4xl bg-white dark:bg-zinc-800 pb-2 overflow-y-auto xl:p-2 xl:bg-transparent&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123; id &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  id: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在 <code>view/main/components/list/index.vue</code>中使用 pins 组件，并使用<code>transition</code>进行包裹，并利用 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/guide/built-ins/transition.html#javascript-hooks">JavaScript钩子</a> 绑定对应的三个状态，并添加<code>:css=false</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 点击图片详情展示 --&gt;</span><br><span class="line">&lt;transition</span><br><span class="line">  :css=&quot;false&quot;</span><br><span class="line">  @before-enter=&quot;beforeEnter&quot;</span><br><span class="line">  @enter=&quot;enter&quot;</span><br><span class="line">  @leave=&quot;leave&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;pins-vue v-if=&quot;isVisiblePins&quot; :id=&quot;currentPins.id&quot; /&gt;</span><br><span class="line">&lt;/transition&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>修改对应的<code>onToPins</code>方法：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isVisiblePins = <span class="title function_">ref</span>(<span class="literal">false</span>) <span class="comment">// 控制 pins 展示</span></span><br><span class="line"><span class="keyword">const</span> currentPins = <span class="title function_">ref</span>(&#123;&#125;) <span class="comment">// 当前选中的 pins 属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击图片item - 进入 pins</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPins</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  history.<span class="title function_">pushState</span>(<span class="literal">null</span>, <span class="literal">null</span>, <span class="string">`/pins/<span class="subst">$&#123;item.id&#125;</span>`</span>) <span class="comment">// 修改浏览器的URL</span></span><br><span class="line">  currentPins.<span class="property">value</span> = item</span><br><span class="line">  isVisiblePins.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>此时点击即可展示出对应的<code>pins</code>组件</li>
</ol>
<p>接下来就是对应的动画内容了。</p>
<ol>
<li>在<code>view/main/components/list/item.vue</code>中记录点击时当时item图片的中心位置，该位置即为动画的起点，此处将使用到useElementBounding方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击图片进入详情页动画 记录图片中心点 = 图片距页面（左侧 | 顶部）距离 + 图片自身（宽 | 高）的一半）</span></span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">  <span class="attr">x</span>: imgContainerX,</span><br><span class="line">  <span class="attr">y</span>: imgContainerY,</span><br><span class="line">  <span class="attr">width</span>: imgContainerWidth,</span><br><span class="line">  <span class="attr">height</span>: imgContainerHeight</span><br><span class="line">&#125; = <span class="title function_">useElementBounding</span>(imgTarget)</span><br><span class="line"><span class="keyword">const</span> imgContainerCenter = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">translateX</span>: <span class="built_in">parseInt</span>(imgContainerX.<span class="property">value</span> + imgContainerWidth.<span class="property">value</span> / <span class="number">2</span>),</span><br><span class="line">    <span class="attr">translateY</span>: <span class="built_in">parseInt</span>(imgContainerY.<span class="property">value</span> + imgContainerHeight.<span class="property">value</span> / <span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>onToPinsClick</code>中，传递计算出的值</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击进入图片详情事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onToPinsClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="string">&#x27;click&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: props.<span class="property">data</span>.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">localtion</span>: <span class="title function_">imgContainerCenter</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>安装<code>GSAP</code></li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm i <span class="literal">--save</span> gsap</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/main/components/list/index.vue</code>中，填充三个<code>transition</code>钩子</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gsap <span class="keyword">from</span> <span class="string">&#x27;gsap&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击图片进入详情页 - 动画开始前</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">beforeEnter</span> = (<span class="params">el</span>) =&gt; &#123;</span><br><span class="line">  gsap.<span class="title function_">set</span>(el, &#123;</span><br><span class="line">    <span class="attr">scaleX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">scaleY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">transformOrigin</span>: <span class="string">&#x27;0 0&#x27;</span>,</span><br><span class="line">    <span class="attr">translateX</span>: currentPins.<span class="property">value</span>.<span class="property">localtion</span>?.<span class="property">translateX</span>,</span><br><span class="line">    <span class="attr">translateY</span>: currentPins.<span class="property">value</span>.<span class="property">localtion</span>?.<span class="property">translateY</span>,</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 点击图片进入详情页 - 动画执行中</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">enter</span> = (<span class="params">el, done</span>) =&gt; &#123;</span><br><span class="line">  gsap.<span class="title function_">to</span>(el, &#123;</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0.3</span>,</span><br><span class="line">    <span class="attr">scaleX</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">scaleY</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">translateX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">translateY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">onComplete</span>: done</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 离开图片详情页 - 离开动画执行中</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">leave</span> = (<span class="params">el, done</span>) =&gt; &#123;</span><br><span class="line">  gsap.<span class="title function_">to</span>(el, &#123;</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">0.3</span>,</span><br><span class="line">    <span class="attr">scaleX</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">scaleY</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">x</span>: currentPins.<span class="property">value</span>.<span class="property">localtion</span>?.<span class="property">translateX</span>,</span><br><span class="line">    <span class="attr">y</span>: currentPins.<span class="property">value</span>.<span class="property">localtion</span>?.<span class="property">translateY</span>,</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>当需要关闭<code>Pins</code>组件时： 需要监听页面的回退事件<code>popState</code>，当回退时间被调用时关闭<code>Pins</code>组件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听浏览器后退按钮事件</span></span><br><span class="line"><span class="title function_">useEventListener</span>(<span class="variable language_">window</span>, <span class="string">&#x27;popstate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  isVisiblePins.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="29、移动端详情页navbar"><a href="#29、移动端详情页navbar" class="headerlink" title="29、移动端详情页navbar"></a>29、移动端详情页<code>navbar</code></h3><p>接下来就需要处理<code>pins</code>中对应的页面样式了。<code>pins</code>的页面样式同时可以应用到<code>PC端</code>和<code>移动端</code>。在<code>移动端</code>中，会展示对应的<code>navbar</code>的内容，所以首先要构建出<code>navbar</code>通用组件，然后再基于<code>navbar</code>构建对应的<code>pins</code>样式。</p>
<p>对于 navbar 而言：</p>
<ol>
<li>它分为 左、中、右 三个大的部分，三个部分都可以通过插槽进行指定</li>
<li>左、右 两边的插槽可以自定义点击事件</li>
<li>同时<code>navbar</code>有时候会存在吸顶的效果，所以最好还可以通过一个<code>prop</code>指定对应的吸顶展示</li>
</ol>
<h4 id="构建navbar"><a href="#构建navbar" class="headerlink" title="构建navbar"></a>构建<code>navbar</code></h4><ol>
<li>创建<code>libs/navbar/index.vue</code>通用组件，并构建对应的<code>props</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">clickLeft</span>: <span class="title class_">Function</span>, <span class="comment">// 左侧按钮的点击</span></span><br><span class="line">  <span class="attr">clickRight</span>: <span class="title class_">Function</span>, <span class="comment">// 右侧按钮的点击</span></span><br><span class="line">  <span class="attr">sticky</span>: <span class="title class_">Boolean</span> <span class="comment">// 是否吸顶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>libs/navbar/index.vue</code>中渲染视图</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;w-full h-5 border-b flex items-center z-10 bg-white dark:bg-zinc-800 border-b-zinc-200 dark:border-b-zinc-700&quot;</span><br><span class="line">    :class=&quot;[sticky ? &#x27;sticky top-0 left-0&#x27; : &#x27;relative&#x27;]&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 左 - 点击后退 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;h-full w-5 absolute left-0 flex items-center justify-center&quot;</span><br><span class="line">      @click=&quot;onClickLeft&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot name=&quot;left&quot;&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&quot;back&quot;</span><br><span class="line">          class=&quot;w-2 h-2&quot;</span><br><span class="line">          fillClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 中 - 图片信息 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;h-full flex items-center justify-center m-auto font-bold text-base text-zinc-900 dark:text-zinc-200&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot&gt;&lt;/slot&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 右 - 点击上传 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;h-full w-5 absolute right-0 flex items-center justify-center&quot;</span><br><span class="line">      @click=&quot;onClickRight&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;slot name=&quot;right&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li><code>navbar</code>左右侧按钮点击事件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 左侧按钮点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onClickLeft</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">clickLeft</span>) &#123;</span><br><span class="line">    props.<span class="title function_">clickLeft</span>()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  router.<span class="title function_">back</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 右侧按钮点击事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onClickRight</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">clickRight</span>) &#123;</span><br><span class="line">    props.<span class="title function_">clickRight</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="响应式的pins页面"><a href="#响应式的pins页面" class="headerlink" title="响应式的pins页面"></a>响应式的<code>pins</code>页面</h4><ol>
<li>在<code>api/pexels.js</code>中新增获取指定图片数据的<code>api</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取指定图片数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getPexelsFromId</span> = (<span class="params">id</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/pexels/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/pins/components/pins.vue</code>中获取指定图片数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getPexelsFromId &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/pexels&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">id</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取详情数据</span></span><br><span class="line"><span class="keyword">const</span> pexelData = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getPexelData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getPexelsFromId</span>(props.<span class="property">id</span>)</span><br><span class="line">  pexelData.<span class="property">value</span> = data</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getPexelData</span>()</span><br></pre></td></tr></table></figure>
<ol>
<li>根据获取的数据渲染<code>pins</code>对应的视图</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;fixed left-0 top-0 w-screen h-screen z-20 backdrop-blur-4xl bg-white dark:bg-zinc-800 pb-2 overflow-y-auto xl:p-2 xl:bg-transparent&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 移动端下展示 navbar --&gt;</span><br><span class="line">    &lt;m-navbar</span><br><span class="line">      v-if=&quot;isMobileTerminal&quot;</span><br><span class="line">      sticky</span><br><span class="line">      @clickLeft=&quot;onPop&quot;</span><br><span class="line">      @clickRight=&quot;onPop&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123; pexelData.title &#125;&#125;</span><br><span class="line">      &lt;template #right&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          name=&quot;share&quot;</span><br><span class="line">          class=&quot;w-3 h-3&quot;</span><br><span class="line">          fillClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/m-navbar&gt;</span><br><span class="line">    &lt;!-- pc 端下展示关闭按钮图标 --&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-else</span><br><span class="line">      name=&quot;close&quot;</span><br><span class="line">      class=&quot;w-3 h-3 ml-1 p-0.5 cursor-pointer duration-200 rounded-sm hover:bg-zinc-100 absolute right-2 top-2&quot;</span><br><span class="line">      fillClass=&quot;fill-zinc-400&quot;</span><br><span class="line">      @click=&quot;onPop&quot;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 内容区 --&gt;</span><br><span class="line">    &lt;div class=&quot;xl:w-[80%] xl:h-full xl:mx-auto xl:rounded-lg xl:flex&quot;&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        class=&quot;w-screen mb-2 xl:w-3/5 xl:h-full xl:rounded-tl-lg xl:rounded-bl-lg&quot;</span><br><span class="line">        :src=&quot;pexelData.photo&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        class=&quot;xl:w-2/5 xl:h-full xl:bg-white xl:dark:bg-zinc-900 xl:rounded-tr-lg xl:rounded-br-lg xl:p-3&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;div v-if=&quot;!isMobileTerminal&quot; class=&quot;flex justify-between mb-2&quot;&gt;</span><br><span class="line">          &lt;!-- PC端：分享 --&gt;</span><br><span class="line">          &lt;m-svg-icon</span><br><span class="line">            name=&quot;share&quot;</span><br><span class="line">            class=&quot;w-4 h-4 p-1 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-800 duration-300 rounded&quot;</span><br><span class="line">            fillClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">          &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">          &lt;!-- PC端：收藏 --&gt;</span><br><span class="line">          &lt;m-button</span><br><span class="line">            class=&quot;&quot;</span><br><span class="line">            type=&quot;info&quot;</span><br><span class="line">            icon=&quot;heart&quot;</span><br><span class="line">            iconClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 图片标题 --&gt;</span><br><span class="line">        &lt;p</span><br><span class="line">          class=&quot;text-base text-zinc-900 dark:text-zinc-200 ml-1 font-bold xl:text-xl xl:mb-5&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; pexelData.title &#125;&#125;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;!-- 作者：头像 名字 --&gt;</span><br><span class="line">        &lt;div class=&quot;flex items-center mt-1 px-1&quot;&gt;</span><br><span class="line">          &lt;img</span><br><span class="line">            v-lazy</span><br><span class="line">            class=&quot;h-3 w-3 rounded-full&quot;</span><br><span class="line">            :src=&quot;pexelData.avatar&quot;</span><br><span class="line">            alt=&quot;&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;span class=&quot;text-base text-zinc-900 dark:text-zinc-200 ml-1&quot;&gt;&#123;&#123;</span><br><span class="line">            pexelData.author</span><br><span class="line">          &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; getPexelsFromId &#125; from &#x27;@/api/pexels&#x27;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">......</span><br><span class="line">// PC端下关闭按钮处理事件</span><br><span class="line">const router = useRouter()</span><br><span class="line">const store = useStore()</span><br><span class="line">const onPop = () =&gt; &#123;</span><br><span class="line">  // 配置跳转方式</span><br><span class="line">  store.commit(&#x27;app/changeRouterType&#x27;, &#x27;back&#x27;)</span><br><span class="line">  router.back()</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="解决刷新空白问题"><a href="#解决刷新空白问题" class="headerlink" title="解决刷新空白问题"></a>解决刷新空白问题</h4><p>当点击图片进入详情页时，再进行刷新操作，会出现页面空白的情况。</p>
<p>原因：刷新页面时，浏览器会重新加载<code>URL</code>，而此时的<code>URL</code>没有对应的路由。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>在路由表中配置对应连接的路由对象</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PC端图片详情页路由：router/modules/pc-route.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    ......,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/pins/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;pins&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/pins/index.vue&#x27;</span>), </span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动端图片详情页路由：router/modules/mobile-route.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    ......,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/pins/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;pins&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/pins/index.vue&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ol>
<li>路由对象中的组件中使用到我们上面定义的<code>pins.vue</code>组件</li>
<li>这样刷新时就会通过路由匹配到对应的路由组件，在路由初始化时获取<code>id</code>参数传递给组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;w-full h-full bg-zinc-200 dark:bg-zinc-800&quot;&gt;</span><br><span class="line">    &lt;pinsVue :id=&quot;$route.params.id&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import pinsVue from &#x27;./components/pins.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="30、登录-注册模块"><a href="#30、登录-注册模块" class="headerlink" title="30、登录/注册模块"></a>30、登录/注册模块</h3><h4 id="构建登录模块"><a href="#构建登录模块" class="headerlink" title="构建登录模块"></a>构建登录模块</h4><ol>
<li>在<code>view/layout/components/header/header-my.vue</code>中新建登录按钮及点击事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;m-popover class=&quot;flex items-center&quot; placement=&quot;bottom-left&quot;&gt;</span><br><span class="line">    &lt;template #reference&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;false&quot;</span><br><span class="line">        ......</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 用户头像 --&gt;</span><br><span class="line">        ......</span><br><span class="line">        &lt;!-- 用户头像右边下箭头 --&gt;</span><br><span class="line">        ......</span><br><span class="line">        &lt;!-- vip 标记 --&gt;</span><br><span class="line">        ......</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!-- 登录按钮 --&gt;</span><br><span class="line">      &lt;div v-else&gt;</span><br><span class="line">        &lt;m-button</span><br><span class="line">          class=&quot;guide-my&quot;</span><br><span class="line">          icon=&quot;profile&quot;</span><br><span class="line">          iconColor=&quot;#fff&quot;</span><br><span class="line">          @click=&quot;onToLogin&quot;</span><br><span class="line">        &gt;&lt;/m-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 气泡框 --&gt;</span><br><span class="line">    &lt;div v-if=&quot;false&quot; .....&gt;</span><br><span class="line">      .......</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/m-popover&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">// 构建 menu 数据源</span><br><span class="line">const menuArr = [</span><br><span class="line">  ......</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">// 登录按钮点击事件</span><br><span class="line">const onToLogin = () =&gt; &#123;</span><br><span class="line">  router.push(&#x27;/login&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>mobile-routes.js</code>和<code>pc-routes.js</code>新建登录路由</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/login-register/login/index.vue&#x27;</span>), </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/index.vue</code>构建登录页基本样式结构</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;relative h-screen bg-white dark:bg-zinc-800 text-center xl:bg-zinc-200&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 头部图标：PC端和移动端 --&gt;</span><br><span class="line">    &lt;!-- 头部图标：PC端 --&gt;</span><br><span class="line">    &lt;div class=&quot;hidden pt-5 h-8 xl:block&quot;&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        v-lazy</span><br><span class="line">        class=&quot;m-auto&quot;</span><br><span class="line">        src=&quot;https://res.lgdsunday.club/signlogo.png&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 头部图标：移动端 --&gt;</span><br><span class="line">    &lt;div class=&quot;h-[111px] xl:hidden&quot;&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        v-lazy</span><br><span class="line">        class=&quot;dark:hidden&quot;</span><br><span class="line">        src=&quot;https://res.lgdsunday.club/login-bg.png&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        v-lazy</span><br><span class="line">        class=&quot;h-5 absolute top-[5%] left-[50%] translate-x-[-50%]&quot;</span><br><span class="line">        src=&quot;https://m.imooc.com/static/wap/static/common/img/logo-small@2x.png&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 表单区 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;block px-3 mt-4 dark:bg-zinc-800 xl:bg-white xl:w-[388px] xl:dark:bg-zinc-900 xl:m-auto xl:mt-8 xl:py-4 xl:rounded-sm xl:shadow-lg&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;h3</span><br><span class="line">        class=&quot;mb-2 font-semibold text-base text-main dark:text-zinc-300 hidden xl:block&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        账号登录</span><br><span class="line">      &lt;/h3&gt;</span><br><span class="line">      &lt;!-- 表单 --&gt;</span><br><span class="line">      &lt;form&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">        class=&quot;dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900&quot;</span><br><span class="line">          name=&quot;username&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          placeholder=&quot;用户名&quot;</span><br><span class="line">          autocomplete=&quot;on&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">          class=&quot;dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900&quot;</span><br><span class="line">          name=&quot;password&quot;</span><br><span class="line">          type=&quot;password&quot;</span><br><span class="line">          placeholder=&quot;密码&quot;</span><br><span class="line">          autocomplete=&quot;on&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;div class=&quot;pt-1 pb-3 leading-[0px] text-right&quot;&gt;</span><br><span class="line">          &lt;span&gt;还没有账号？&lt;/span&gt;</span><br><span class="line">          &lt;a</span><br><span class="line">            class=&quot;inline-block p-1 text-zinc-400 text-right dark:text-zinc-600 hover:text-zinc-600 dark:hover:text-zinc-400 text-sm duration-400 cursor-pointer&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            立即注册</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;m-button</span><br><span class="line">          class=&quot;w-full dark:bg-zinc-900 xl:dark:bg-zinc-800&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          登录</span><br><span class="line">        &lt;/m-button&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">      &lt;!-- 第三方登录：QQ 微信 --&gt;</span><br><span class="line">      &lt;div class=&quot;flex justify-around mt-4&quot;&gt;</span><br><span class="line">        &lt;m-svg-icon class=&quot;w-4 cursor-pointer&quot; name=&quot;qq&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;m-svg-icon class=&quot;w-4 cursor-pointer&quot; name=&quot;weixin&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>将<code>头部图标：PC端和移动端</code>封装在<code>view/login-register/components/header.vue</code>中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 头部图标：PC端和移动端 --&gt;</span><br><span class="line">&lt;headerVue&gt;&lt;/headerVue&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;../components/header.vue&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="使用vee-validate进行表单校验"><a href="#使用vee-validate进行表单校验" class="headerlink" title="使用vee-validate进行表单校验"></a>使用<code>vee-validate</code>进行表单校验</h4><p>以往开发项目都是借助于第三方组件库俩实现登录注册的表单和表单校验。在当前项目中，由于风格与第三方库的风格互斥、没有采用第三方库。</p>
<p><strong>表单校验的实现原理</strong>：</p>
<ol>
<li>在某一个时机下（失去焦点、内容变化）</li>
<li>检查表单元素中的 <code>value</code> 是否符合某个条件（校验条件）</li>
<li>如果不符合，则给出对应的提示</li>
</ol>
<p>根据以上原理描述，<strong>自定义表单校验的功能逻辑：</strong></p>
<ol>
<li>创建对应的<code>field</code>输入框组件</li>
<li>该组件中，包含两个元素:<ol>
<li><code>input</code> 输入框</li>
<li><code>span</code> 表示错误提示</li>
</ol>
</li>
<li>监听 <code>input</code> 输入框的 <code>blur</code>失去焦点 事件</li>
<li>根据 <code>input</code>的<code>value</code> 判断是否满足一个或多个指定的条件（比如：是否为空）</li>
<li>如果不满足，则展示 <code>span</code> 标签，表示错误提示消息</li>
</ol>
<p>由于时间比较紧、并且自己封装的表单校验可能复用性不是那么好，所以采用<strong>使用第三方表单校验库</strong></p>
<p><strong>使用第三方表单校验库优点：</strong></p>
<ul>
<li>包比较小、一般这种包只做一种功能</li>
<li>适用性比较强</li>
</ul>
<p>本项目中采用的第三方表单校验库： <a target="_blank" rel="noopener" href="https://vee-validate.logaretm.com/v4/tutorials/dynamic-form-generator/">vee-validate</a></p>
<ol>
<li>首先安装<code>vee-validate</code>依赖包</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm i vee<span class="literal">-validate</span></span><br></pre></td></tr></table></figure>
<ol>
<li><code>vee-validate</code>中提供了非常详细的基础使用流程，在这一套流程中，涉及到了三个组件，分别为：<ol>
<li><code>Form</code>：表单</li>
<li><code>Field</code>：输入框</li>
<li><code>ErrorMessage</code>： 错误提示</li>
</ol>
</li>
<li>使用这三个组件，代替默认的表单域，其中每个单独的表单域都具备一个<code>name</code>，该<code>name</code>为对应<strong>表单域和错误提示</strong>：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">      &lt;!-- 表单 --&gt;</span><br><span class="line">      &lt;vee-form @submit=&quot;onLoginHandler&quot;&gt;</span><br><span class="line">        &lt;vee-field</span><br><span class="line">          class=&quot;dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900&quot;</span><br><span class="line">          name=&quot;username&quot;</span><br><span class="line">          :rules=&quot;validateUsername&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          placeholder=&quot;用户名&quot;</span><br><span class="line">          autocomplete=&quot;on&quot;</span><br><span class="line">          v-model=&quot;loginForm.username&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;vee-error-message</span><br><span class="line">          class=&quot;text-sm text-red-600 block mt-0.5 text-left&quot;</span><br><span class="line">          name=&quot;username&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/vee-error-message&gt;</span><br><span class="line">        &lt;vee-field</span><br><span class="line">          class=&quot;dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900&quot;</span><br><span class="line">          name=&quot;password&quot;</span><br><span class="line">          :rules=&quot;validatePassword&quot;</span><br><span class="line">          type=&quot;password&quot;</span><br><span class="line">          placeholder=&quot;密码&quot;</span><br><span class="line">          autocomplete=&quot;on&quot;</span><br><span class="line">          v-model=&quot;loginForm.password&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;vee-error-message</span><br><span class="line">          class=&quot;text-sm text-red-600 block mt-0.5 text-left&quot;</span><br><span class="line">          name=&quot;password&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/vee-error-message&gt;</span><br><span class="line">			 ......</span><br><span class="line">      &lt;/vee-form&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 第三方登录：QQ 微信 --&gt;</span><br><span class="line">      &lt;div class=&quot;flex justify-around mt-4&quot;&gt;</span><br><span class="line">        &lt;m-svg-icon class=&quot;w-4 cursor-pointer&quot; name=&quot;qq&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">        &lt;m-svg-icon class=&quot;w-4 cursor-pointer&quot; name=&quot;wexin&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;../components/header.vue&#x27;</span><br><span class="line">import &#123;</span><br><span class="line">  Form as VeeForm,</span><br><span class="line">  Field as VeeField,</span><br><span class="line">  ErrorMessage as VeeErrorMessage</span><br><span class="line">&#125; from &#x27;vee-validate&#x27;</span><br><span class="line">import &#123; validateUsername, validatePassword &#125; from &#x27;../validate&#x27;</span><br><span class="line"></span><br><span class="line">// 登录触发 - 表单校验通过后</span><br><span class="line">const onLoginHandler = () =&gt; &#123;</span><br><span class="line">  console.log(onLoginHandler)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>validate.js</code>导出表单校验函数</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验姓名, 校验成功返回true, 校验失败返回字符串、vee-validate会将字符串显示出来</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">validateName</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (value === <span class="keyword">void</span> <span class="number">0</span> || value.<span class="property">length</span> &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&#x27;用户名不能为空&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">3</span> || value.<span class="property">length</span> &gt; <span class="number">12</span>) <span class="keyword">return</span> <span class="string">&#x27;用户名只能为3-12位&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 校验密码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">validatePassword</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (！value) <span class="keyword">return</span> <span class="string">&#x27;密码不能为空&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">6</span> || value.<span class="property">length</span> &gt; <span class="number">12</span>) <span class="keyword">return</span> <span class="string">&#x27;密码只能为6-12位&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191511742.jpg" alt="image-20220905092900887"> </p>
<p>如果输入的内容校验不通过会有错误的提示</p>
<h4 id="人类行为验证说明"><a href="#人类行为验证说明" class="headerlink" title="人类行为验证说明"></a>人类行为验证说明</h4><p>在日常开发过程中人类行为验证已经无处不在了，它主要的作用是过滤出非人类的一些操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191511250.jpg" alt="image-20220905095446717"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191511180.jpg" alt="image-20220905095457426"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191511375.jpg" alt="image-20220905095545633"> </p>
<p><strong>目的</strong>：明确当前的操作是人完成的，而非机器。</p>
<p><strong>原理</strong>：</p>
<p>人机验证是通过对用户的行为数据、设备特征与网络数据构建多维度数据分析，采用完整的可信前端安全方案来保证数据采集的真实性、有效性。比如以下方面（但不仅仅限于)︰<br>（1）浏览器特征检查︰所有浏览器都有差异，可以通过各种前端相关手段检查浏览器环境的真实性。<br>（2）鼠标事件（click、move、hover、leave……）<br>（3）页面窗口（size、scroll、坐标……）<br>（4） cookie，等等。</p>
<p><strong>滑动验证码实现原理</strong> </p>
<p>滑动验证码是服务端随机生成滑块和带有滑块阴影的背景图片，然后将其随机的滑块位置坐标保存。前端实现互动的交互，将滑块把图拼上，获取用户的相关行为值。然后服务端进行相应值的校验。其背后的逻辑是使用机器学习中的深度学习，根据鼠标滑动轨迹，坐标位置，计算拖动速度，重试次数等多维度来判断是否人为操作。 </p>
<p>滑动验证码对机器的判断，不只是完成拼图，前端用户看不见的是——验证码后台针对用户产生的行为轨迹数据进行机器学习建模，结合访问频率、地理位置、历史记录等多个维度信息，快速、准确的返回人机判定结果，故而机器识别+模拟不易通过。滑动验证码也不是万无一失，但对滑动行为的模拟需要比较强的破解能力，毕竟还是大幅提升了攻击成本，而且技术也会在攻防转换中不断进步。  </p>
<p>目前人类行为验证的<strong>实现方案</strong>分为两种： 一种是收费的、另一种是开源的</p>
<p><strong>收费的代表有</strong>：年费在几万到几十万不等，有专门的技术人员帮助对接</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://dun.163.com/">网易网盾</a></li>
<li><a target="_blank" rel="noopener" href="http://www.geetest.com/">极验</a></li>
<li>…</li>
</ol>
<p><strong>开源的有</strong>：验证的精准度，需要看服务端的能力</p>
<ul>
<li><code>gitee</code>开源的：<a target="_blank" rel="noopener" href="https://gitee.com/LongbowEnterprise/SliderCaptcha?_from=gitee_search">slideCaptcha</a></li>
</ul>
<p>在项目中我们使用开源的<code>slideCaptcha</code>作为人类行为校验</p>
<h4 id="人类行为验证实现"><a href="#人类行为验证实现" class="headerlink" title="人类行为验证实现"></a>人类行为验证实现</h4><ol>
<li>创建<code>vendor</code> 文件夹，复制<code>SliderCaptcha</code> 至该文件夹中</li>
<li>创建<code>view/login-register/login/slider-captcha.vue</code>，作为人类行为验证组件</li>
<li>在该组件中，完成对应 <code>UI</code>样式：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;w-[360px] border text-sm border-zinc-300 rounded-sm bg-white p-1 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 duration-300 fixed z-50 left-1/2 top-1/3 translate-x-[-50%] translate-y-[-50%]&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div class=&quot;h-4 flex items-center text-sm&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;flex-grow&quot;&gt;请完成安全验证&lt;/span&gt;</span><br><span class="line">      &lt;div @click=&quot;onRefresh&quot;&gt;</span><br><span class="line">        &lt;svg-icon</span><br><span class="line">          name=&quot;refresh&quot;</span><br><span class="line">          class=&quot;w-2 h-2 rounded-sm fill-zinc-600 dark:fill-zinc-300 duration-300 cursor-pointer&quot;</span><br><span class="line">        &gt;&lt;/svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;ml-2&quot; @click=&quot;onClose&quot;&gt;</span><br><span class="line">        &lt;svg-icon</span><br><span class="line">          name=&quot;close&quot;</span><br><span class="line">          class=&quot;w-2 h-2 rounded-sm fill-zinc-600 dark:fill-zinc-300 duration-300 cursor-pointer&quot;</span><br><span class="line">        &gt;&lt;/svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div id=&quot;captcha&quot; class=&quot;h-[195px]&quot;&gt;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在 <code>view/login-register/login/index.vue</code>中导入该组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 人类行为验证模块 --&gt;</span><br><span class="line">&lt;slider-captcha-vue&gt;&lt;/slider-captcha-vue&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import sliderCaptchaVue from &#x27;./slider-captcha.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>接下来就需要生成<code>sliderCaptcha</code>实例，并且在<strong>前端用户拼图成功之后，把用户的拼图操作路径（用户行为）数据传递给服务端，由服务端进行人类行为判定</strong>。在<code>view/login-register/login/slider-captcha.vue</code>中：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/vendor/SliderCaptcha/slidercaptcha.min.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/vendor/SliderCaptcha/longbow.slidercaptcha.min.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getCaptcha &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/sys&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> captcha = <span class="literal">null</span> <span class="comment">// 创建captcha实例</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  captcha = <span class="title function_">sliderCaptcha</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;captcha&#x27;</span>, <span class="comment">// 渲染位置</span></span><br><span class="line">    <span class="comment">// 用户拼图成功之后的回调</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">onSuccess</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getCaptcha</span>(&#123;</span><br><span class="line">        <span class="attr">behavior</span>: arr</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 用户拼图失败之后的回调</span></span><br><span class="line">    <span class="title function_">onFail</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onFail&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 默认的验证方法，咱们不在此处进行验证，而是选择在用户拼图成功之后进行验证，所以此处永远返回为 true</span></span><br><span class="line">    <span class="title function_">verify</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>api/sys.js</code>模块，构建请求接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 人类行为验证</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getCaptcha</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/captcha&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>当用户服务端返回成功之后，传递事件到<code>login</code>组件，同时处理<code>close</code>和<code>reset</code>事件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMITS_CLOSE</span> = <span class="string">&#x27;close&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMITS_SUCCESS</span> = <span class="string">&#x27;success&#x27;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="variable constant_">EMITS_CLOSE</span>, <span class="variable constant_">EMITS_SUCCESS</span>])</span><br><span class="line"><span class="comment">// 用户拼图成功之后的回调</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">onSuccess</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">if</span> (res) &#123; <span class="comment">// 人类行为验证通过</span></span><br><span class="line">    <span class="title function_">emits</span>(<span class="variable constant_">EMITS_SUCCESS</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重置</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onReset</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  captcha.<span class="title function_">reset</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onClose</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMITS_CLOSE</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/index.vue</code>中，监听对应事件处理</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 人类行为验证模块 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">slider-captcha-vue</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">v-if</span>=<span class="string">&quot;isSliderCaptchaVisible&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  @<span class="attr">close</span>=<span class="string">&quot;isSliderCaptchaVisible = false&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  @<span class="attr">success</span>=<span class="string">&quot;onCaptchaSuccess&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">&gt;</span><span class="tag">&lt;/<span class="name">slider-captcha-vue</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> isSliderCaptchaVisible = <span class="title function_">ref</span>(<span class="literal">false</span>) <span class="comment">// 控制 sliderCaptcha 展示</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录触发 - 表单校验通过后</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onLoginHandler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isSliderCaptchaVisible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 人类行为验证通过</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onCaptchaSuccess</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isSliderCaptchaVisible.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;执行登录操作&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：<code>SliderCaptcha</code> 中所有图标均被放入该路径下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- iconfont 在线图标，主要用于 sliderCaptcha --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">&quot;https://at.alicdn.com/t/font_3042963_nv614canpao.css?spm=a313x.7781069.1998910419.47&amp;file=font_3042963_nv614canpao.css&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191512748.jpeg" alt="image-20220905142847856"> </p>
<p>完成之后的效果如上</p>
<h4 id="处理用户登录行为"><a href="#处理用户登录行为" class="headerlink" title="处理用户登录行为"></a>处理用户登录行为</h4><ol>
<li>在<code>api/sys.js</code>中新增用户登录请求接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">loginUser</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/login&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/index.vue</code>中绑定登录事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">        &lt;m-button</span><br><span class="line">          class=&quot;w-full dark:bg-zinc-900 xl:dark:bg-zinc-800&quot;</span><br><span class="line">          :isActiveAnim=&quot;false&quot;</span><br><span class="line">          :loading=&quot;loading&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          登录</span><br><span class="line">        &lt;/m-button&gt;</span><br><span class="line">  ......</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">......</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">// 人类行为验证通过</span><br><span class="line">const onCaptchaSuccess = async () =&gt; &#123;</span><br><span class="line">  isSliderCaptchaVisible.value = false</span><br><span class="line">  onLogin() // 登录操作</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const loading = ref(false) // 登录时的 loading</span><br><span class="line">// 用户登录行为</span><br><span class="line">const onLogin = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>store/modules/user.js</code>模块，并在<code>store/index.js</code>中导入<code>user</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> user <span class="keyword">from</span> <span class="string">&#x27;./modules/user&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">  getters,</span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    ......,</span><br><span class="line">    user</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">createPersistedState</span>(&#123;</span><br><span class="line">      .......,</span><br><span class="line">      <span class="attr">paths</span>: [<span class="string">&#x27;category&#x27;</span>, <span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;search&#x27;</span>, <span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>安装<code>md5</code>[<code>npm i md5</code>]，在<code>store/modules/user.js</code>中构建<code>user</code>模块的<code>vuex</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; loginUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/sys&#x27;</span></span><br><span class="line"><span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">&#x27;md5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 登录之后的 token</span></span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setToken</span>(<span class="params">state, newToken</span>) &#123;</span><br><span class="line">      state.<span class="property">token</span> = newToken <span class="comment">// 保存 token</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; password &#125; = payload <span class="comment">// 加密密码</span></span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">loginUser</span>(&#123;</span><br><span class="line">        ...payload,</span><br><span class="line">        <span class="attr">password</span>: password ? <span class="title function_">md5</span>(password) : <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>constans/index.js</code>中定义用户名登录方式常量，并在<code>view/login-register/login/index.vue</code>触发<code>vuex</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录方式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">LOGIN_TYPE_USERNAME</span> = <span class="string">&#x27;username&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">......</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; LOGIN_TYPE_USERNAME &#125; from &#x27;@/constants&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">  </span><br><span class="line">const store = useStore()</span><br><span class="line">const router = useRouter()</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">const loading = ref(false) // 登录时的 loading</span><br><span class="line">// 用户输入的用户名和密码</span><br><span class="line">const loginForm = ref(&#123;</span><br><span class="line">  username: &#x27;LGD_Sunday&#x27;,</span><br><span class="line">  password: &#x27;123123&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 用户登录行为</span><br><span class="line">const onLogin = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">  // 执行登录操作</span><br><span class="line">  try &#123;</span><br><span class="line">    await store.dispatch(&#x27;user/login&#x27;, &#123;</span><br><span class="line">      ...loginForm.value,</span><br><span class="line">      loginType: LOGIN_TYPE_USERNAME</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false</span><br><span class="line">  &#125;</span><br><span class="line">  router.push(&#x27;/&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="用户信息的获取"><a href="#用户信息的获取" class="headerlink" title="用户信息的获取"></a>用户信息的获取</h4><ol>
<li>在<code>api/sys.js</code>中新增获取用户基本信息请求接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getProfile</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/profile&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>utils/request.js</code>的请求拦截器中指定<code>token</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// config.headers.icode = &#x27;你需要在这里填入你的 icode&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123; <span class="comment">// 如果token存在 注入token</span></span><br><span class="line">      config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;store.getters.token&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config <span class="comment">// 必须返回配置 return 出的对象，就是请求的配置对象</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/modules/user.js</code>中处理用户信息</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; loginUser, getProfile, registerUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/sys&#x27;</span></span><br><span class="line"><span class="keyword">import</span> md5 <span class="keyword">from</span> <span class="string">&#x27;md5&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;@/libs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 登录之后的 token</span></span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125; <span class="comment">// 获取用户信息</span></span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setToken</span>(<span class="params">state, newToken</span>) &#123;</span><br><span class="line">      state.<span class="property">token</span> = newToken <span class="comment">// 保存 token</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">setUserInfo</span>(<span class="params">state, newInfo</span>) &#123;</span><br><span class="line">      state.<span class="property">userInfo</span> = newInfo <span class="comment">// 保存用户信息</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; password &#125; = payload <span class="comment">// 加密密码</span></span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">loginUser</span>(&#123;</span><br><span class="line">        ...payload,</span><br><span class="line">        <span class="attr">password</span>: password ? <span class="title function_">md5</span>(password) : <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;setToken&#x27;</span>, data.<span class="property">token</span>) <span class="comment">// 保存token</span></span><br><span class="line">      context.<span class="title function_">dispatch</span>(<span class="string">&#x27;profile&#x27;</span>) <span class="comment">// 获取用户信息</span></span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取用户信息</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">profile</span>(<span class="params">context</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getProfile</span>()</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, data)</span><br><span class="line">      <span class="comment">// 提示 - 欢迎</span></span><br><span class="line">      <span class="title function_">message</span>(</span><br><span class="line">        <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="string">`欢迎您 <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">          data.vipLevel</span></span></span><br><span class="line"><span class="subst"><span class="string">            ? <span class="string">&#x27;尊贵的 VIP&#x27;</span> + data.vipLevel + <span class="string">&#x27; 用户 &#x27;</span> + data.nickname</span></span></span><br><span class="line"><span class="subst"><span class="string">            : data.nickname</span></span></span><br><span class="line"><span class="subst"><span class="string">        &#125;</span> `</span>,</span><br><span class="line">        <span class="number">6000</span></span><br><span class="line">      )</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/getter.js</code>中新增获取用户信息的快捷访问</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取用户信息</span></span><br><span class="line"><span class="attr">userInfo</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">userInfo</span>,</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/header/header-my.vue</code>中：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;$store.getters.token&quot;</span><br><span class="line">        ......</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 用户头像 --&gt;</span><br><span class="line">        &lt;img</span><br><span class="line">          ......</span><br><span class="line">          :src=&quot;$store.getters.userInfo.avatar&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">			 ......</span><br><span class="line">        &lt;!-- vip 标记 --&gt;</span><br><span class="line">        &lt;m-svg-icon</span><br><span class="line">          v-if=&quot;$store.getters.userInfo.vipLevel&quot;</span><br><span class="line">          ......</span><br><span class="line">        &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      ......</span><br><span class="line"></span><br><span class="line">    &lt;!-- 气泡框 --&gt;</span><br><span class="line">    &lt;div v-if=&quot;$store.getters.token&quot; class=&quot;w-[140px] overflow-hidden&quot;&gt;</span><br><span class="line">      ......</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<h4 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h4><ol>
<li>在<code>store/modules/user.js</code>中处理用户退出登录</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">  <span class="comment">// 退出登录</span></span><br><span class="line">    <span class="title function_">logout</span>(<span class="params">context</span>) &#123;</span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;setToken&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 清空 token</span></span><br><span class="line">      context.<span class="title function_">commit</span>(<span class="string">&#x27;setUserInfo&#x27;</span>, &#123;&#125;) <span class="comment">// 清空用户信息</span></span><br><span class="line">      <span class="comment">// 退出登录之后，重新刷新下页面，因为对于前台项目而言，用户是否登录（是否为 VIP）看到的数据可能不同</span></span><br><span class="line">      location.<span class="title function_">reload</span>() <span class="comment">// 刷新页面</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/header/header-my.vue</code>中处理<code>PC端</code>退出登录操作</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;!-- 气泡框 --&gt;</span><br><span class="line">    &lt;div v-if=&quot;$store.getters.token&quot; class=&quot;w-[140px] overflow-hidden&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        ......</span><br><span class="line">        @click=&quot;onItemClick(item)&quot;</span><br><span class="line">      &gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; confirm &#125; from &#x27;@/libs&#x27;</span><br><span class="line"></span><br><span class="line">const router = useRouter()</span><br><span class="line">const store = useStore()</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">// menu Item 点击事件，也可以根据其他的 key 作为判定，比如 name</span><br><span class="line">const onItemClick = (item) =&gt; &#123;</span><br><span class="line">  if (item.id === 2) &#123;</span><br><span class="line">    // 退出登录</span><br><span class="line">    confirm(&#x27;您确定要退出登录吗？&#x27;).then(() =&gt; &#123;</span><br><span class="line">      store.dispatch(&#x27;user/logout&#x27;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="处理token超时"><a href="#处理token超时" class="headerlink" title="处理token超时"></a>处理<code>token</code>超时</h4><p>通常情况<code>token</code>均具备时效性，<code>token</code>失效后服务端会返回<code>404</code>。当服务端返回<code>401</code>时，表示<code>token</code>超时，需要重新登录。对应的操作可在 <strong>axios 的响应拦截器中进行</strong></p>
<p>在<code>src/utils/request.js</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务端返回非200的状态码时</span></span><br><span class="line">  (error) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 处理 token 超时问题</span></span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span> &amp;&amp; error.<span class="property">response</span>.<span class="property">data</span> &amp;&amp; error.<span class="property">response</span>.<span class="property">data</span>.<span class="property">code</span> === <span class="number">401</span>) &#123;</span><br><span class="line">      store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>) <span class="comment">// 退出</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h4><ol>
<li>在<code>view/login-register/register/index.vue</code>中构建基本布局</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;relative h-screen bg-white dark:bg-zinc-800 text-center xl:bg-zinc-200&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 头部图标 --&gt;</span><br><span class="line">    &lt;header-vue&gt;&lt;/header-vue&gt;</span><br><span class="line">    &lt;!-- 表单区 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;block px-3 mt-4 dark:bg-zinc-800 xl:bg-white xl:w-[388px] xl:dark:bg-zinc-900 xl:m-auto xl:mt-8 xl:py-4 xl:rounded-sm xl:shadow-lg&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;h3</span><br><span class="line">        class=&quot;mb-2 font-semibold text-base text-main dark:text-zinc-300 hidden xl:block&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        注 册 账 号</span><br><span class="line">      &lt;/h3&gt;</span><br><span class="line">      &lt;!-- 表单 --&gt;</span><br><span class="line">      &lt;vee-form @submit=&quot;onRegister&quot;&gt;</span><br><span class="line">        &lt;!-- 用户名 --&gt;</span><br><span class="line">        &lt;vee-field</span><br><span class="line">          class=&quot;dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900&quot;</span><br><span class="line">          name=&quot;username&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          placeholder=&quot;用户名&quot;</span><br><span class="line">          autocomplete=&quot;on&quot;</span><br><span class="line">          :rules=&quot;validateUsername&quot;</span><br><span class="line">          v-model=&quot;regForm.username&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;vee-error-message</span><br><span class="line">          class=&quot;text-sm text-red-600 block mt-0.5 text-left&quot;</span><br><span class="line">          name=&quot;username&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/vee-error-message&gt;</span><br><span class="line">        &lt;!-- 密码 --&gt;</span><br><span class="line">        &lt;vee-field</span><br><span class="line">          class=&quot;dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900&quot;</span><br><span class="line">          name=&quot;password&quot;</span><br><span class="line">          type=&quot;password&quot;</span><br><span class="line">          placeholder=&quot;密码&quot;</span><br><span class="line">          autocomplete=&quot;on&quot;</span><br><span class="line">          :rules=&quot;validatePassword&quot;</span><br><span class="line">          v-model=&quot;regForm.password&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;vee-error-message</span><br><span class="line">          class=&quot;text-sm text-red-600 block mt-0.5 text-left&quot;</span><br><span class="line">          name=&quot;password&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/vee-error-message&gt;</span><br><span class="line">        &lt;!-- 确认密码 --&gt;</span><br><span class="line">        &lt;vee-field</span><br><span class="line">          class=&quot;dark:bg-zinc-800 dark:text-zinc-400 border-b-zinc-400 border-b-[1px] w-full outline-0 pb-1 px-1 text-base focus:border-b-main dark:focus:border-b-zinc-200 xl:dark:bg-zinc-900&quot;</span><br><span class="line">          name=&quot;confirmPassword&quot;</span><br><span class="line">          type=&quot;password&quot;</span><br><span class="line">          placeholder=&quot;确认密码&quot;</span><br><span class="line">          autocomplete=&quot;on&quot;</span><br><span class="line">          rules=&quot;validateConfirmPassword:@password&quot;</span><br><span class="line">          v-model=&quot;regForm.confirmPassword&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;vee-error-message</span><br><span class="line">          class=&quot;text-sm text-red-600 block mt-0.5 text-left&quot;</span><br><span class="line">          name=&quot;confirmPassword&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/vee-error-message&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=&quot;pt-1 pb-3 leading-[0px] text-right&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;mb-2&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;inline-block text-zinc-400 text-right dark:text-zinc-600 text-sm duration-400 cursor-pointer&quot;&gt;已有账号？&lt;/span&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              class=&quot;inline-block text-zinc-600 text-right dark:text-zinc-600 hover:text-hover-main dark:hover:text-zinc-400 text-sm duration-400 cursor-pointer&quot;</span><br><span class="line">              target=&quot;__black&quot;</span><br><span class="line">              @click=&quot;onToLogin&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              去登录</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              class=&quot;text-zinc-400 dark:text-zinc-600 hover:text-zinc-600 dark:hover:text-zinc-400 text-sm duration-400&quot;</span><br><span class="line">              href=&quot;https://m.imooc.com/newfaq?id=89&quot;</span><br><span class="line">              target=&quot;__black&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              注册即同意《慕课网注册协议》</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;m-button</span><br><span class="line">          class=&quot;w-full dark:bg-zinc-900 xl:dark:bg-zinc-800&quot;</span><br><span class="line">          :isActiveAnim=&quot;false&quot;</span><br><span class="line">          :loading=&quot;loading&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          立即注册</span><br><span class="line">        &lt;/m-button&gt;</span><br><span class="line">      &lt;/vee-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;../components/header.vue&#x27;</span><br><span class="line">import &#123;</span><br><span class="line">  Form as VeeForm,</span><br><span class="line">  Field as VeeField,</span><br><span class="line">  ErrorMessage as VeeErrorMessage,</span><br><span class="line">&#125; from &#x27;vee-validate&#x27;</span><br><span class="line">import &#123;</span><br><span class="line">  validateUsername,</span><br><span class="line">  validatePassword,</span><br><span class="line">&#125; from &#x27;../validate&#x27;</span><br><span class="line">import &#123; LOGIN_TYPE_USERNAME &#125; from &#x27;@/constants&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; useRouter, useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line"></span><br><span class="line">const store = useStore()</span><br><span class="line">const router = useRouter()</span><br><span class="line">const route = useRoute()</span><br><span class="line"></span><br><span class="line">// 数据源</span><br><span class="line">const regForm = ref(&#123;</span><br><span class="line">  username: &#x27;&#x27;,</span><br><span class="line">  password: &#x27;&#x27;,</span><br><span class="line">  confirmPassword: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>router/modules/pc-routes.js</code>和<code>router/modules/mobile-routes.js</code>中新增路由</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;register&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/login-register/register/index.vue&#x27;</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/index.vue</code>中点击<code>立即注册</code>跳转注册页面</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">          &lt;a</span><br><span class="line">            ......</span><br><span class="line">            @click=&quot;onToRegister&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            立即注册</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">  ......</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">......</span><br><span class="line">// 进入注册页面</span><br><span class="line">const onToRegister = () =&gt; &#123;</span><br><span class="line">  // 配置跳转方式</span><br><span class="line">  store.commit(&#x27;app/changeRouterType&#x27;, &#x27;push&#x27;)</span><br><span class="line">  router.push(&#x27;/register&#x27;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/validate.js</code>中新增<code>确认密码</code>的校验规则</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 确认密码的表单校验</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">validateConfirmPassword</span> = (<span class="params">value, password</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (value !== password[<span class="number">0</span>]) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;两次密码输入必须一致&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/register/index.vue</code>中插入<code>确认密码</code>校验规则</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 确认密码 --&gt;</span><br><span class="line">&lt;vee-field</span><br><span class="line">  ......</span><br><span class="line">  rules=&quot;validateConfirmPassword:@password&quot; </span><br><span class="line">  v-model=&quot;regForm.confirmPassword&quot;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import headerVue from &#x27;../components/header.vue&#x27;</span><br><span class="line">import &#123;</span><br><span class="line">  ......,</span><br><span class="line">  defineRule // 该方法作用是插入一条校验规则 - 确认密码</span><br><span class="line">&#125; from &#x27;vee-validate&#x27;</span><br><span class="line">import &#123;</span><br><span class="line">  ......,</span><br><span class="line">  validateConfirmPassword // 确认密码</span><br><span class="line">&#125; from &#x27;../validate&#x27;</span><br><span class="line">.......</span><br><span class="line"></span><br><span class="line">// 插入 确认密码 规则</span><br><span class="line">defineRule(&#x27;validateConfirmPassword&#x27;, validateConfirmPassword)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>api/sys.js</code>中新增用户注册请求接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">registerUser</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/register&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/modules/user.js</code>的<code>vuex的user</code>模块新增用户注册</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; loginUser, getProfile, registerUser &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/sys&#x27;</span></span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">register</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; password &#125; = payload</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">registerUser</span>(&#123;</span><br><span class="line">        ...payload,</span><br><span class="line">        <span class="attr">password</span>: password ? <span class="title function_">md5</span>(password) : <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/register/index.vue</code>中处理用户注册事件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">LOGIN_TYPE_USERNAME</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">false</span>) <span class="comment">// loading</span></span><br><span class="line"><span class="comment">// 触发注册</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onRegister</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> payload = &#123;</span><br><span class="line">      <span class="attr">username</span>: regForm.<span class="property">value</span>.<span class="property">username</span>,</span><br><span class="line">      <span class="attr">password</span>: regForm.<span class="property">value</span>.<span class="property">password</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 触发注册，携带第三方数据</span></span><br><span class="line">    <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/register&#x27;</span>, &#123;</span><br><span class="line">      ...payload,</span><br><span class="line">      ...route.<span class="property">query</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 注册成功，触发登录</span></span><br><span class="line">    <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/login&#x27;</span>, &#123;</span><br><span class="line">      ...payload,</span><br><span class="line">      <span class="attr">loginType</span>: <span class="variable constant_">LOGIN_TYPE_USERNAME</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  router.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="31、通用组件v-input"><a href="#31、通用组件v-input" class="headerlink" title="31、通用组件v-input"></a>31、通用组件<code>v-input</code></h3><p><strong>封装的组件具有以下功能</strong></p>
<ul>
<li>1、通过<code>v-model</code>绑定数据</li>
<li>2、通过设置<code>inputType</code>属性值来展示不同的组件<ul>
<li>2.1、属性值为<code>input</code>时： 展示<code>input</code>组件 (默认)</li>
<li>2.2、属性值为<code>textarea</code>时，展示<code>textarea</code>组件</li>
</ul>
</li>
<li>3、支持设置<code>max</code>属性值，来限定输出内容的最大长度</li>
<li>4、支持原生的属性直接透传到<code>input</code>或<code>textarea</code>组件上</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191512796.jpg" alt="image-20220906141919521"> </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191512366.jpg" alt="image"> </p>
<h4 id="实现组件封装"><a href="#实现组件封装" class="headerlink" title="实现组件封装"></a>实现组件封装</h4><p>创建<code>libs/input/index.vue</code>组件，构建样式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;relative&quot;&gt;</span><br><span class="line">    &lt;!-- 单行文本 --&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      v-if=&quot;type === TYPE_TEXT&quot;</span><br><span class="line">      class=&quot;border-gray-200 dark:border-zinc-600 dark:bg-zinc-800 duration-100 dark:text-zinc-400 border-[1px] outline-0 py-0.5 px-1 text-sm rounded-sm focus:border-blue-400 w-full&quot;</span><br><span class="line">      type=&quot;text&quot;</span><br><span class="line">      v-model=&quot;text&quot;</span><br><span class="line">      :maxlength=&quot;max&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;!-- 多行文本 --&gt;</span><br><span class="line">    &lt;textarea</span><br><span class="line">      v-if=&quot;type === TYPE_TEXTAREA&quot;</span><br><span class="line">      v-model=&quot;text&quot;</span><br><span class="line">      :maxlength=&quot;max&quot;</span><br><span class="line">      rows=&quot;5&quot;</span><br><span class="line">      class=&quot;border-gray-200 dark:border-zinc-600 dark:bg-zinc-800 duration-100 dark:text-zinc-400 border-[1px] outline-0 py-0.5 px-1 text-sm rounded-sm focus:border-blue-400 w-full&quot;</span><br><span class="line">    &gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;!-- 最大长度 --&gt;</span><br><span class="line">    &lt;span</span><br><span class="line">      v-if=&quot;max&quot;</span><br><span class="line">      class=&quot;absolute right-1 bottom-0.5 text-zinc-400 text-xs&quot;</span><br><span class="line">      :class=&quot;&#123; &#x27;text-red-700&#x27;: currentNumber === parseInt(max) &#125;&quot;</span><br><span class="line">      &gt;&#123;&#123; currentNumber &#125;&#125; / &#123;&#123; max &#125;&#125;&lt;/span</span><br><span class="line">    &gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const TYPE_TEXT = &#x27;text&#x27; // 单行</span><br><span class="line">const TYPE_TEXTAREA = &#x27;textarea&#x27; // 多行</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useVModel &#125; from &#x27;@vueuse/core&#x27;</span><br><span class="line">import &#123; computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  modelValue: &#123; // v-model双向数据绑定</span><br><span class="line">    required: true,</span><br><span class="line">    type: String</span><br><span class="line">  &#125;,</span><br><span class="line">  type: &#123; // 类型：单行文本输入 or 多行文本输入</span><br><span class="line">    type: String,</span><br><span class="line">    default: TYPE_TEXT,</span><br><span class="line">    validator(value) &#123;</span><br><span class="line">      const arr = [TYPE_TEXT, TYPE_TEXTAREA]</span><br><span class="line">      const result = arr.includes(value)</span><br><span class="line">      if (!result) &#123;</span><br><span class="line">        throw new Error(`type 的值必须在可选范围内 [$&#123;arr.join(&#x27;、&#x27;)&#125;]`)</span><br><span class="line">      &#125;</span><br><span class="line">      return result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  max: &#123; // 最大字符数</span><br><span class="line">    type: [String, Number]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">defineEmits([&#x27;update:modelValue&#x27;]) // 声明双向绑定事件</span><br><span class="line"></span><br><span class="line">const text = useVModel(props) // 输入的字符</span><br><span class="line">// 输入的字符数</span><br><span class="line">const currentNumber = computed(() =&gt; &#123;</span><br><span class="line">  return text.value?.length</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>​        </p>
<h3 id="32、用户个人资料"><a href="#32、用户个人资料" class="headerlink" title="32、用户个人资料"></a>32、用户个人资料</h3><h4 id="构建基本样式"><a href="#构建基本样式" class="headerlink" title="构建基本样式"></a>构建基本样式</h4><ol>
<li>创建<code>view/profile/index.vue</code>个人资料页面，并在<code>router/modules/pc-routes.js</code>和<code>router/modules/mobile-routes.js</code>中新增路由</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户个人信息页面</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/profile&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;profile&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/profile/index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">meta</span>: &#123;</span><br><span class="line">      <span class="attr">user</span>: <span class="literal">true</span> <span class="comment">// 标记当前的页面只有用户登录之后才可以进入</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/layout/components/header/header-my.vue</code>中处理点击<code>个人资料</code>跳转用户信息页</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户模块菜单menu Item 点击事件，也可以根据其他的 key 作为判定，比如 name</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (item.<span class="property">id</span> === <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="title function_">confirm</span>(<span class="string">&#x27;您确定要退出登录吗？&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/logout&#x27;</span>) <span class="comment">// 退出登录</span></span><br><span class="line">  	&#125;)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  router.<span class="title function_">push</span>(item.<span class="property">path</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/profile/index.vue</code>中处理页面简单样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;h-full bg-zinc-200 dark:bg-zinc-800 duration-400 overflow-auto xl:pt-1&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;relative max-w-screen-lg mx-auto bg-white dark:bg-zinc-900 duration-400 xl:rounded-sm xl:border-zinc-200 xl:dark:border-zinc-600 xl:border-[1px] xl:px-4 xl:py-2&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 移动端 navbar --&gt;</span><br><span class="line">      &lt;m-navbar sticky v-if=&quot;isMobileTerminal&quot; :clickLeft=&quot;onNavbarLeftClick&quot;&gt;</span><br><span class="line">        个人资料</span><br><span class="line">      &lt;/m-navbar&gt;</span><br><span class="line">      &lt;!-- pc 端标题 --&gt;</span><br><span class="line">      &lt;div v-else class=&quot;text-lg font-bold text-center mb-4 dark:text-zinc-300&quot;&gt;</span><br><span class="line">        个人资料</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;h-full w-full px-1 pb-4 text-sm mt-2 xl:w-2/3 xl:pb-0&quot;&gt;</span><br><span class="line">        &lt;!-- 头像部分 --&gt;</span><br><span class="line">        &lt;div class=&quot;py-1 xl:absolute xl:right-[16%] xl:text-center&quot;&gt;</span><br><span class="line">          &lt;span</span><br><span class="line">            class=&quot;w-8 inline-block mb-2 font-bold text-sm dark:text-zinc-300 xl:block xl:mx-auto&quot;</span><br><span class="line">            &gt;我的头像&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;div</span><br><span class="line">            class=&quot;relative w-[80px] h-[80px] group xl:cursor-pointer xl:left-[50%] xl:translate-x-[-50%]&quot;</span><br><span class="line">            @click=&quot;onAvatarClick&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;!-- 头像 --&gt;</span><br><span class="line">            &lt;img</span><br><span class="line">              v-lazy</span><br><span class="line">              :src=&quot;$store.getters.userInfo.avatar&quot;</span><br><span class="line">              alt=&quot;&quot;</span><br><span class="line">              class=&quot;rounded-[50%] w-full h-full xl:inline-block&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;!-- 鼠标移入 --&gt;</span><br><span class="line">            &lt;div</span><br><span class="line">              class=&quot;absolute top-0 rounded-[50%] w-full h-full bg-[rgba(0,0,0,.4)] hidden xl:group-hover:block&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;m-svg-icon</span><br><span class="line">                name=&quot;change-header-image&quot;</span><br><span class="line">                class=&quot;w-2 h-2 m-auto mt-2&quot;</span><br><span class="line">              &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">              &lt;div</span><br><span class="line">                class=&quot;text-xs text-white dark:text-zinc-300 scale-90 mt-0.5&quot;</span><br><span class="line">              &gt;</span><br><span class="line">                点击更换头像</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;!-- 隐藏域 --&gt;</span><br><span class="line">          &lt;input</span><br><span class="line">            v-show=&quot;false&quot;</span><br><span class="line">            ref=&quot;inputFileTarget&quot;</span><br><span class="line">            type=&quot;file&quot;</span><br><span class="line">            accept=&quot;.png, .jpeg, .jpg, .gif&quot;</span><br><span class="line">            @change=&quot;onSelectImgHandler&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;p class=&quot;mt-1 text-zinc-500 dark:text-zinc-400 text-xs xl:w-10&quot;&gt;</span><br><span class="line">            支持 jpg、png、jpeg 格式大小 5M 以内的图片</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 个人信息输入 --&gt;</span><br><span class="line">        &lt;!-- 用户名 --&gt;</span><br><span class="line">        &lt;div class=&quot;py-1 xl:flex xl:items-center xl:my-1&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;w-8 block mb-1 font-bold dark:text-zinc-300 xl:mb-0&quot;</span><br><span class="line">            &gt;用户名&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=&quot;$store.getters.userInfo.nickname&quot;</span><br><span class="line">            class=&quot;w-full&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            max=&quot;20&quot;</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 职位 --&gt;</span><br><span class="line">        &lt;div class=&quot;py-1 xl:flex xl:items-center xl:my-1&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;w-8 block mb-1 font-bold dark:text-zinc-300 xl:mb-0&quot;</span><br><span class="line">            &gt;职位&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=&quot;$store.getters.userInfo.title&quot;</span><br><span class="line">            class=&quot;w-full&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 公司 --&gt;</span><br><span class="line">        &lt;div class=&quot;py-1 xl:flex xl:items-center xl:my-1&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;w-8 block mb-1 font-bold dark:text-zinc-300 xl:mb-0&quot;</span><br><span class="line">            &gt;公司&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=&quot;$store.getters.userInfo.company&quot;</span><br><span class="line">            class=&quot;w-full&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 个人主页 --&gt;</span><br><span class="line">        &lt;div class=&quot;py-1 xl:flex xl:items-center xl:my-1&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;w-8 block mb-1 font-bold dark:text-zinc-300 xl:mb-0&quot;</span><br><span class="line">            &gt;个人主页&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=&quot;$store.getters.userInfo.homePage&quot;</span><br><span class="line">            class=&quot;w-full&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 个人介绍 --&gt;</span><br><span class="line">        &lt;div class=&quot;py-1 xl:flex xl:my-1&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;w-8 block mb-1 font-bold dark:text-zinc-300 xl:mb-0&quot;</span><br><span class="line">            &gt;个人介绍&lt;/span</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=&quot;$store.getters.userInfo.introduction&quot;</span><br><span class="line">            class=&quot;w-full&quot;</span><br><span class="line">            type=&quot;textarea&quot;</span><br><span class="line">            max=&quot;50&quot;</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 保存修改按钮 --&gt;</span><br><span class="line">        &lt;m-button</span><br><span class="line">          class=&quot;w-full mt-2 mb-4 dark:text-zinc-300 dark:bg-zinc-800 xl:w-[160px] xl:ml-[50%] xl:translate-x-[-50%]&quot;</span><br><span class="line">          &gt;保存修改&lt;/m-button</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;!-- 移动端退出登录按钮 --&gt;</span><br><span class="line">        &lt;m-button</span><br><span class="line">          v-if=&quot;isMobileTerminal&quot;</span><br><span class="line">          class=&quot;w-full dark:text-zinc-300 dark:bg-zinc-800 xl:w-[160px] xl:ml-[50%] xl:translate-x-[-50%]&quot;</span><br><span class="line">          @click=&quot;onLogoutClick&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          退出登录</span><br><span class="line">        &lt;/m-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import &#123; confirm &#125; from &#x27;@/libs&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const store = useStore()</span><br><span class="line">const router = useRouter()</span><br><span class="line"></span><br><span class="line">// 更换头像点击事件</span><br><span class="line">const inputFileTarget = ref(null) // 隐藏域</span><br><span class="line">const onAvatarClick = () =&gt; &#123;</span><br><span class="line">  inputFileTarget.value.click()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 头像选择之后的回调</span><br><span class="line">const onSelectImgHandler = () =&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line">// 移动端：退出登录</span><br><span class="line">const onLogoutClick = () =&gt; &#123;</span><br><span class="line">  confirm(&#x27;确定要退出登录吗？&#x27;).then(() =&gt; &#123;</span><br><span class="line">    store.dispatch(&#x27;user/logout&#x27;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="修改个人资料"><a href="#修改个人资料" class="headerlink" title="修改个人资料"></a>修改个人资料</h4><p>点击保存按钮，调用修改用户信息接口，完成修改</p>
<p>问题：<code>input</code>双向数据绑定是通过<code>v-model</code>绑定到了<code>vuex</code>数据里面，但是修改<code>vuex</code>里的数据唯一方式是提交对应的<code>motation</code>，目前的写法会使输入框数据一旦改变，就会导致<code>vuex</code>里的数据改变</p>
<p>方案：</p>
<ol>
<li>将<code>v-model</code>拆成<code>:modelValue</code>和<code>@update:modelValue</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">        &lt;!-- 个人信息输入 --&gt;</span><br><span class="line">        &lt;!-- 用户名 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            :modelValue=&quot;$store.getters.userInfo.nickname&quot;</span><br><span class="line">            @update:modelValue=&quot;changeStoreUserInfo(&#x27;nickname&#x27;, $event)&quot;</span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 职位 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            :modelValue=&quot;$store.getters.userInfo.title&quot;</span><br><span class="line">            @update:modelValue=&quot;changeStoreUserInfo(&#x27;title&#x27;, $event)&quot;</span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 公司 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            :modelValue=&quot;$store.getters.userInfo.company&quot;</span><br><span class="line">            @update:modelValue=&quot;changeStoreUserInfo(&#x27;company&#x27;, $event)&quot;      </span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 个人主页 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            :modelValue=&quot;$store.getters.userInfo.homePage&quot;</span><br><span class="line">            @update:modelValue=&quot;changeStoreUserInfo(&#x27;homePage&#x27;, $event)&quot; </span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 个人介绍 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            :modelValue=&quot;$store.getters.userInfo.introduction&quot;</span><br><span class="line">            @update:modelValue=&quot;changeStoreUserInfo(&#x27;introduction&#x27;, $event)&quot;</span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        ......</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>处理数据本地的双向同步</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据本地的双向同步</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeStoreUserInfo</span> = (<span class="params">key, value</span>) =&gt; &#123;</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;user/setUserInfo&#x27;</span>, &#123;</span><br><span class="line">    ...store.<span class="property">getters</span>.<span class="property">userInfo</span>,</span><br><span class="line">    [key]: value</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>api/sys.js</code>新增修改用户信息接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">putProfile</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/profile&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">    data</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>处理点击<code>保存修改</code>按钮事件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 保存修改按钮 --&gt;</span><br><span class="line">&lt;m-button</span><br><span class="line">  class=&quot;w-full mt-2 mb-4 dark:text-zinc-300 dark:bg-zinc-800 xl:w-[160px] xl:ml-[50%] xl:translate-x-[-50%]&quot;</span><br><span class="line">  :loading=&quot;loading&quot;</span><br><span class="line">  @click=&quot;onChangeProfile&quot;</span><br><span class="line">  &gt;保存修改&lt;/m-button</span><br><span class="line">&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import &#123; message, confirm &#125; from &#x27;@/libs&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; putProfile &#125; from &#x27;@/api/sys&#x27;</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">// 修改个人信息</span><br><span class="line">const loading = ref(false)</span><br><span class="line">const onChangeProfile = async () =&gt; &#123;</span><br><span class="line">  loading.value = true</span><br><span class="line">  await putProfile(store.userInfo.userInfo)</span><br><span class="line">  message(&#x27;success&#x27;, &#x27;用户信息修改成功&#x27;)</span><br><span class="line">  loading.value = false</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="处理不保存同步问题"><a href="#处理不保存同步问题" class="headerlink" title="处理不保存同步问题"></a>处理不保存同步问题</h4><p>问题：在个人资料输入框修改时，没有按保存按钮，数据仍然被修改</p>
<p>使用本地<code>userInfo</code>数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">        &lt;!-- 个人信息输入 --&gt;</span><br><span class="line">        &lt;!-- 用户名 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=<span class="string">&quot;userInfo.nickname&quot;</span></span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 职位 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=<span class="string">&quot;userInfo.title&quot;</span></span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 公司 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=<span class="string">&quot;userInfo.company&quot;</span>    </span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 个人主页 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=<span class="string">&quot;userInfo.homePage&quot;</span></span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 个人介绍 --&gt;</span><br><span class="line">        ......</span><br><span class="line">          &lt;m-input</span><br><span class="line">            v-model=<span class="string">&quot;userInfo.introduction&quot;</span></span><br><span class="line">            ......</span><br><span class="line">          &gt;&lt;/m-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        ......</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据本地的双向同步，增加一个单层深拷贝</span></span><br><span class="line"><span class="keyword">const</span> userInfo = <span class="title function_">ref</span>(&#123; ...store.<span class="property">getters</span>.<span class="property">userInfo</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改个人信息</span></span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onChangeProfile</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">putProfile</span>(userInfo.<span class="property">value</span>)</span><br><span class="line">  <span class="title function_">message</span>(<span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;用户信息修改成功&#x27;</span>)</span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;user/setUserInfo&#x27;</span>, userInfo.<span class="property">value</span>) <span class="comment">// 更新 vuex</span></span><br><span class="line">  loading.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="33、个人资料头像"><a href="#33、个人资料头像" class="headerlink" title="33、个人资料头像"></a>33、个人资料头像</h3><p>对于头像修改的逻辑，该功能分为<code>PC端</code>和<code>移动端</code>两种情况，需要分别进行处理：</p>
<ol>
<li><p>PC 端：</p>
<ol>
<li>点击更换头像</li>
<li>选择对应文件</li>
<li>通过<code>Dialog</code>展示图片裁剪</li>
<li>裁剪后图片上传</li>
<li>功能完成</li>
</ol>
</li>
<li><p>移动端：</p>
<ol>
<li><p>点击更换头像</p>
</li>
<li><p>选择对应文件</p>
</li>
<li><p>通过<code>popup</code>展示图片裁剪</p>
</li>
<li><p>裁剪后图片上传</p>
</li>
<li><p>功能完成</p>
</li>
</ol>
</li>
</ol>
<p>由此可以发现，两者之间需要通过不同的组件进行裁剪展示</p>
<h4 id="通用组件Dialog"><a href="#通用组件Dialog" class="headerlink" title="通用组件Dialog"></a>通用组件<code>Dialog</code></h4><p>对于<code>Dialog</code> 通用组件而言，可以参考<code>confirm</code> 的组件的构建过程。|<br>它们两个构建方案非常类似,唯二不同的地方是：</p>
<ol>
<li><code>Dialog</code>无需通过方法调用的形式展示</li>
<li><code>Dialog</code> 的内容区可以渲染任意的内容</li>
<li><code>Dialog</code>的确定按钮支持loading提示、并且当<code>onOk</code>返回的值为<code>promise</code>时，且<code>promise</code>的状态变为<code>成功状态时</code>才会关闭<code>Dialog</code></li>
</ol>
<p>排除这两点之后，其余与confirm完全相同。</p>
<p><strong>实现<code>Dialog</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 蒙版 --&gt;</span><br><span class="line">    &lt;transition name=&quot;fade&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">        @click=&quot;close&quot;</span><br><span class="line">        class=&quot;w-screen h-screen bg-zinc-900/80 z-40 fixed top-0 left-0&quot;</span><br><span class="line">      &gt;&lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">    &lt;!-- 内容 --&gt;</span><br><span class="line">    &lt;transition name=&quot;up&quot;&gt;</span><br><span class="line">      &lt;div</span><br><span class="line">        v-if=&quot;isVisable&quot;</span><br><span class="line">        class=&quot;max-w-[80%] max-h-[80%] overflow-auto fixed top-[10%] left-[50%] translate-x-[-50%] z-50 px-2 py-1.5 rounded-sm border dark:border-zinc-600 cursor-pointer bg-white dark:bg-zinc-800 xl:min-w-[35%]&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- 标题 --&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&quot;text-lg font-bold text-zinc-900 dark:text-zinc-200 mb-2&quot;</span><br><span class="line">          v-if=&quot;title&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; title &#125;&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 内容 --&gt;</span><br><span class="line">        &lt;div class=&quot;text-base text-zinc-900 dark:text-zinc-200 mb-2&quot;&gt;</span><br><span class="line">          &lt;slot /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;!-- 按钮 --&gt;</span><br><span class="line">        &lt;div class=&quot;flex justify-end&quot; v-if=&quot;cancelHandler || confirmHandler&quot;&gt;</span><br><span class="line">          &lt;m-button type=&quot;info&quot; class=&quot;mr-2&quot; @click=&quot;onCancelClick&quot;&gt;</span><br><span class="line">            &#123;&#123; cancelText &#125;&#125;</span><br><span class="line">          &lt;/m-button&gt;</span><br><span class="line">          &lt;m-button type=&quot;primary&quot; @click=&quot;onConfirmClick&quot;&gt;</span><br><span class="line">            &#123;&#123; confirmText &#125;&#125;</span><br><span class="line">          &lt;/m-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; useVModel &#125; from &#x27;@vueuse/core&#x27;</span><br><span class="line"></span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  modelValue: &#123;// 控制开关</span><br><span class="line">    type: Boolean,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;,</span><br><span class="line">  title: &#123; // 标题</span><br><span class="line">    type: String</span><br><span class="line">  &#125;,</span><br><span class="line">  cancelText: &#123;// 取消按钮文本</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;取消&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  confirmText: &#123;// 确定按钮文本</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#x27;确定&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  cancelHandler: &#123;// 取消按钮点击事件</span><br><span class="line">    type: Function</span><br><span class="line">  &#125;,</span><br><span class="line">  confirmHandler: &#123;// 确定按钮点击事件</span><br><span class="line">    type: Function</span><br><span class="line">  &#125;,</span><br><span class="line">  close: &#123;// 关闭的回调</span><br><span class="line">    type: Function</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">defineEmits([&#x27;update:modelValue&#x27;])</span><br><span class="line"></span><br><span class="line">const isVisable = useVModel(props)// 控制显示处理</span><br><span class="line"></span><br><span class="line">// 取消按钮点击事件</span><br><span class="line">const onCancelClick = () =&gt; &#123;</span><br><span class="line">  if (props.cancelHandler) &#123;</span><br><span class="line">    props.cancelHandler()</span><br><span class="line">  &#125;</span><br><span class="line">  close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 确定按钮点击事件</span><br><span class="line">const onConfirmClick = () =&gt; &#123;</span><br><span class="line">  if (props.confirmHandler) &#123;</span><br><span class="line">    props.confirmHandler()</span><br><span class="line">  &#125;</span><br><span class="line">  close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 关闭</span><br><span class="line">const close = () =&gt; &#123;</span><br><span class="line">  isVisable.value = false</span><br><span class="line">  if (props.close) &#123;</span><br><span class="line">    props.close()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">.fade-enter-active,</span><br><span class="line">.fade-leave-active &#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.fade-enter-from,</span><br><span class="line">.fade-leave-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.up-enter-active,</span><br><span class="line">.up-leave-active &#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.up-enter-from,</span><br><span class="line">.up-leave-to &#123;</span><br><span class="line">  opacity: 0;</span><br><span class="line">  transform: translate3d(-50%, 100px, 0);</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>测试<code>Dialog</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Dialog v-model=&quot;dialogVisible&quot; :onOk=&quot;onOk&quot;&gt;</span><br><span class="line">    &lt;div&gt;123&lt;/div&gt;</span><br><span class="line">  &lt;/Dialog&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const dialogVisible = ref(true)</span><br><span class="line"></span><br><span class="line">const onOk = () =&gt; &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    setTimeout(resolve, 2000)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191512430.gif" alt="20220906_160011"> </p>
<h4 id="应用Dialog展示头像"><a href="#应用Dialog展示头像" class="headerlink" title="应用Dialog展示头像"></a>应用<code>Dialog</code>展示头像</h4><ol>
<li>在<code>src/views/profile/index.vue</code>中，选中的图片会回调至<code>onSelectImgHandler</code>方法，可以利用UBL.createObjectURL0 获取到对应的 blob 对象</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isDialogVisible = <span class="title function_">ref</span>(<span class="literal">false</span>) <span class="comment">// 头像 dialog 展示</span></span><br><span class="line"><span class="keyword">const</span> currentBolb = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>) <span class="comment">// 选中的图片</span></span><br><span class="line"><span class="comment">// 头像选择之后的回调</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSelectImgHandler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> imgFile = inputFileTarget.<span class="property">value</span>.<span class="property">files</span>[<span class="number">0</span>] <span class="comment">// 获取选中的文件</span></span><br><span class="line">  <span class="keyword">const</span> blob = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(imgFile) <span class="comment">// 生成 blob 对象</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(blob)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>打印该 blob 可在浏览器中展示选中的图片</li>
<li>想要在 Dialog 中展示选中的图片，也只需要使用 <code>img</code> 标签的<code>src</code>属性即可：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-dialog title=&quot;裁剪头像&quot; v-model=&quot;isDialogVisible&quot;&gt;</span><br><span class="line">  &lt;img :src=&quot;currentBolb&quot; /&gt;</span><br><span class="line">&lt;/m-dialog&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>将裁剪头像封装成一个组件<code>profile/components/changeAvatar.vue</code>，在PC端和移动端分别使用，并处理后续裁剪、上传功能。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;overflow-auto relative flex flex-col items-center&quot;&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      v-if=&quot;isMobileTerminal&quot;</span><br><span class="line">      name=&quot;close&quot;</span><br><span class="line">      class=&quot;w-3 h-3 p-0.5 m-1 ml-auto&quot;</span><br><span class="line">      fillClass=&quot;fill-zinc-900 dark:fill-zinc-200 &quot;</span><br><span class="line">      @click=&quot;close&quot;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line"></span><br><span class="line">    &lt;img class=&quot;&quot; ref=&quot;imageTarget&quot; :src=&quot;blob&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;m-button</span><br><span class="line">      class=&quot;mt-4 w-[80%] xl:w-1/2&quot;</span><br><span class="line">      :loading=&quot;loading&quot;</span><br><span class="line">      @click=&quot;onConfirmClick&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      确定</span><br><span class="line">    &lt;/m-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMITS_CLOSE = &#x27;close&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; putProfile &#125; from &#x27;@/api/sys&#x27;</span><br><span class="line"></span><br><span class="line">defineProps(&#123;</span><br><span class="line">  blob: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const emits = defineEmits([EMITS_CLOSE])</span><br><span class="line"></span><br><span class="line">// 确定按钮点击事件</span><br><span class="line">const loading = ref(false)</span><br><span class="line">const onConfirmClick = () =&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line">// 关闭事件</span><br><span class="line">const close = () =&gt; &#123;</span><br><span class="line">  emits(EMITS_CLOSE)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在头像选择之后的回调展示 Dialog</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 头像选择之后的回调</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSelectImgHandler</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> imgFile = inputFileTarget.<span class="property">value</span>.<span class="property">files</span>[<span class="number">0</span>] <span class="comment">// 获取选中的文件</span></span><br><span class="line">  <span class="keyword">const</span> blob = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(imgFile) <span class="comment">// 生成 blob 对象</span></span><br><span class="line">  currentBolb.<span class="property">value</span> = blob <span class="comment">// 获取选中的图片</span></span><br><span class="line">  isDialogVisible.<span class="property">value</span> = <span class="literal">true</span> <span class="comment">// 展示 Dialog</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>移动端展示裁剪头像时不适应<code>Dialog</code>，采用<code>popup</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- PC 端 --&gt;</span><br><span class="line">&lt;m-dialog v-if=&quot;!isMobileTerminal&quot; v-model=&quot;isDialogVisible&quot;&gt;</span><br><span class="line">  &lt;change-avatar-vue</span><br><span class="line">    :blob=&quot;currentBolb&quot;</span><br><span class="line">    @close=&quot;isDialogVisible = false&quot;</span><br><span class="line">  &gt;&lt;/change-avatar-vue&gt;</span><br><span class="line">&lt;/m-dialog&gt;</span><br><span class="line">&lt;!-- 移动端 --&gt;</span><br><span class="line">&lt;m-popup</span><br><span class="line">  v-else</span><br><span class="line">  :class=&quot;&#123; &#x27;h-screen&#x27;: isDialogVisible &#125;&quot;</span><br><span class="line">  v-model=&quot;isDialogVisible&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;change-avatar-vue</span><br><span class="line">    :blob=&quot;currentBolb&quot;</span><br><span class="line">    @close=&quot;isDialogVisible = false&quot;</span><br><span class="line">  &gt;&lt;/change-avatar-vue&gt;</span><br><span class="line">&lt;/m-popup&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>当两次选择文件，是同一个的时候，change 的回调不会被再次触发。想要解决这个问题，就只需要在每次选择的图片不在被使用之后，清空掉<code>inputTarget</code>的<code>value</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听 dialog 关闭</span></span><br><span class="line"><span class="title function_">watch</span>(isDialogVisible, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!val) &#123;</span><br><span class="line">    inputFileTarget.<span class="property">value</span>.<span class="property">value</span> = <span class="literal">null</span> <span class="comment">// 防止 change 不重复触发</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="裁剪头像图片"><a href="#裁剪头像图片" class="headerlink" title="裁剪头像图片"></a>裁剪头像图片</h4><p>想要处理图片裁剪需要使用到 <a target="_blank" rel="noopener" href="https://github.com/fengyuanchen/cropperjs">cropperjs</a>，它是一个<code>Javascript</code>的库，同时支持<code>PC</code>端 和<code>移动端</code></p>
<ol>
<li>安装依赖</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm install cropperjs</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>src/views/profile/components/change-avatar.vue</code>中进行导入</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Cropper</span> <span class="keyword">from</span> <span class="string">&#x27;cropperjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;cropperjs/dist/cropper.css&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>使用<code>new Cropper</code>进行初始化，区分<code>PC端</code>和<code>移动端</code>：所有配置项</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 移动端配置对象</span></span><br><span class="line"><span class="keyword">const</span> mobileOptions = &#123;</span><br><span class="line">  <span class="attr">viewMode</span>: <span class="number">1</span>, <span class="comment">// 将裁剪框限制在画布的大小</span></span><br><span class="line">  <span class="attr">dragMode</span>: <span class="string">&#x27;move&#x27;</span>, <span class="comment">// 移动画布，裁剪框不动</span></span><br><span class="line">  <span class="attr">aspectRatio</span>: <span class="number">1</span>, <span class="comment">// 裁剪框固定纵横比：1:1</span></span><br><span class="line">  <span class="attr">cropBoxMovable</span>: <span class="literal">false</span>, <span class="comment">// 裁剪框不可移动</span></span><br><span class="line">  <span class="attr">cropBoxResizable</span>: <span class="literal">false</span> <span class="comment">// 不可调整裁剪框大小</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PC 端配置对象</span></span><br><span class="line"><span class="keyword">const</span> pcOptions = &#123;</span><br><span class="line">  <span class="attr">aspectRatio</span>: <span class="number">1</span> <span class="comment">// 裁剪框固定纵横比：1:1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>根据配置对象处理图片裁剪</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图片裁剪处理</span></span><br><span class="line"><span class="keyword">const</span> imageTarget = <span class="title function_">ref</span>(<span class="literal">null</span>)</span><br><span class="line"><span class="keyword">let</span> cropper = <span class="literal">null</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 接收两个参数：</span></span><br><span class="line"><span class="comment">   * 1. 需要裁剪的图片 DOM</span></span><br><span class="line"><span class="comment">   * 2. options 配置对象</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  cropper = <span class="keyword">new</span> <span class="title class_">Cropper</span>(</span><br><span class="line">    imageTarget.<span class="property">value</span>,</span><br><span class="line">    isMobileTerminal.<span class="property">value</span> ? mobileOptions : pcOptions</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>处理确定按钮点击事件</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-button</span><br><span class="line">  <span class="keyword">class</span>=<span class="string">&quot;mt-4 w-[80%] xl:w-1/2&quot;</span></span><br><span class="line">  :loading=<span class="string">&quot;loading&quot;</span></span><br><span class="line">  @click=<span class="string">&quot;onConfirmClick&quot;</span></span><br><span class="line">&gt;</span><br><span class="line">  确定</span><br><span class="line">&lt;/m-button&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确定按钮点击事件</span></span><br><span class="line"><span class="keyword">const</span> loading = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onConfirmClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 获取裁剪后的图片</span></span><br><span class="line">  cropper.<span class="title function_">getCroppedCanvas</span>().<span class="title function_">toBlob</span>(<span class="function">(<span class="params">blob</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 裁剪后的 blob 地址</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="腾讯云cos存储对象"><a href="#腾讯云cos存储对象" class="headerlink" title="腾讯云cos存储对象"></a>腾讯云cos存储对象</h4><p>前端想要上传、修改cos存储桶中的对象、常见的有两种方式：</p>
<ul>
<li><p>1、以后台实现对存储桶的操作、前台传输给后台、后台再进行操作</p>
</li>
<li><p>2、前端从后台获取到操作存储桶的加密信息之后、直接操作存储桶</p>
<p>注意：由于签名计算放在前端会暴露 <code>SecretId</code> 和 <code>SecretKey</code>，我们把签名计算过程放在后端实现，前端通过 <code>ajax</code> 向后端获取签名结果，正式部署时请在后端加一层自己网站本身的权限检验。</p>
</li>
</ul>
<p>方案二方式：</p>
<p>1、安装<a target="_blank" rel="noopener" href="https://github.com/tencentyun/cos-js-sdk-v5"><code>cos-js-sdk-v5</code></a>依赖 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/436/11459">腾讯云sdk官网</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i cos<span class="literal">-js-sdk-v5</span> <span class="literal">--save</span></span><br></pre></td></tr></table></figure>
<p>2、构建cos 实例：<strong>初始化cos对象参数</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>SecretId</td>
<td>开发者拥有的项目身份识别ID，用以身份认证，可在APL密钥管理 页面获取</td>
</tr>
<tr>
<td>SecretKey</td>
<td>开发者拥有的项目身份密钥，可在 APL密钥管理 页面获取</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">COS</span> <span class="keyword">from</span> <span class="string">&#x27;cos-js-sdk-v5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SECRETID 和 SECRETKEY请登录 https://console.cloud.tencent.com/cam/capi 进行查看和管理</span></span><br><span class="line"><span class="keyword">var</span> cos = <span class="keyword">new</span> <span class="title function_">COS</span>(&#123;</span><br><span class="line">    <span class="title class_">SecretId</span>: <span class="string">&#x27;SECRETID&#x27;</span>,</span><br><span class="line">    <span class="title class_">SecretKey</span>: <span class="string">&#x27;SECRETKEY&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>推荐 （秘钥是动态获取的，相对比较安全）</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">COS</span> = <span class="built_in">require</span>(<span class="string">&#x27;cos-js-sdk-v5&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> cos = <span class="keyword">new</span> <span class="title function_">COS</span>(&#123;</span><br><span class="line">    <span class="comment">// getAuthorization 必选参数</span></span><br><span class="line">    <span class="attr">getAuthorization</span>: <span class="keyword">function</span> (<span class="params">options, callback</span>) &#123;</span><br><span class="line">        <span class="comment">// 异步获取临时密钥</span></span><br><span class="line">        <span class="comment">// 服务端 JS 和 PHP 例子：https://github.com/tencentyun/cos-js-sdk-v5/blob/master/server/</span></span><br><span class="line">        <span class="comment">// 服务端其他语言参考 COS STS SDK ：https://github.com/tencentyun/qcloud-cos-sts-sdk</span></span><br><span class="line">        <span class="comment">// STS 详细文档指引看：https://cloud.tencent.com/document/product/436/14048</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://example.com/server/sts.php&#x27;</span>; <span class="comment">// url替换成您自己的后端服务</span></span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">        xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, url, <span class="literal">true</span>);</span><br><span class="line">        xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(e.<span class="property">target</span>.<span class="property">responseText</span>);</span><br><span class="line">                <span class="keyword">var</span> credentials = data.<span class="property">credentials</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!data || !credentials) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;credentials invalid:\n&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data, <span class="literal">null</span>, <span class="number">2</span>))</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="title function_">callback</span>(&#123;</span><br><span class="line">              <span class="title class_">TmpSecretId</span>: credentials.<span class="property">tmpSecretId</span>,</span><br><span class="line">              <span class="title class_">TmpSecretKey</span>: credentials.<span class="property">tmpSecretKey</span>,</span><br><span class="line">              <span class="title class_">SecurityToken</span>: credentials.<span class="property">sessionToken</span>,</span><br><span class="line">              <span class="comment">// 建议返回服务器时间作为签名的开始时间，避免用户浏览器本地时间偏差过大导致签名错误</span></span><br><span class="line">              <span class="title class_">StartTime</span>: data.<span class="property">startTime</span>, <span class="comment">// 时间戳，单位秒，如：1580000000</span></span><br><span class="line">              <span class="title class_">ExpiredTime</span>: data.<span class="property">expiredTime</span>, <span class="comment">// 时间戳，单位秒，如：1580000000</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.<span class="title function_">send</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3、上传、删除、查询、下载资源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cos.<span class="title function_">putObject</span>(&#123;</span><br><span class="line">    <span class="title class_">Bucket</span>: <span class="string">&#x27;examplebucket-1250000000&#x27;</span>, <span class="comment">/* 必须 */</span></span><br><span class="line">    <span class="title class_">Region</span>: <span class="string">&#x27;COS_REGION&#x27;</span>,     <span class="comment">/* 存储桶所在地域，必须字段 */</span></span><br><span class="line">    <span class="title class_">Key</span>: <span class="string">&#x27;exampleobject&#x27;</span>,              <span class="comment">/* 必须 */</span></span><br><span class="line">    <span class="title class_">StorageClass</span>: <span class="string">&#x27;STANDARD&#x27;</span>,</span><br><span class="line">    <span class="title class_">Body</span>: fileObject, <span class="comment">// 上传文件对象</span></span><br><span class="line">    <span class="attr">onProgress</span>: <span class="keyword">function</span>(<span class="params">progressData</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(progressData));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err || data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="阿里云oss存储"><a href="#阿里云oss存储" class="headerlink" title="阿里云oss存储"></a>阿里云oss存储</h4><p>用法和上面的腾讯云的COS存储类似，</p>
<p>本次方案、采用的是在客户端安装、提供的sdk、调用对应的api来操作存储对象</p>
<p>具体步骤如下：</p>
<ol>
<li>安装<code>ali-oss</code>依赖</li>
<li>通过接口获取临时访问凭证，生成<code>OSS</code>实例</li>
<li>利用<code>ossClient.put</code>方法，完成对应上传</li>
</ol>
<p>1、<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/64041.htm?spm=a2c4g.11186623.0.0.235d24cbqRW0xl#concept-64041-zh"><code>安装sdk</code></a> ali-oss依赖</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ali<span class="literal">-oss</span></span><br></pre></td></tr></table></figure>
<p>2、创建<code>src/utils/sts.js</code>模块，用来生成创建<code>oss</code>实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="variable constant_">OSS</span> <span class="keyword">from</span> <span class="string">&#x27;ali-oss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">REGION</span>, <span class="variable constant_">BUCKET</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getSts &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/sys&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getOSSClient</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getSts</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">OSS</span>(&#123;</span><br><span class="line">    <span class="comment">// yourRegion填写Bucket所在地域。以华东1（杭州）为例，Region填写为oss-cn-hangzhou。</span></span><br><span class="line">    <span class="attr">region</span>: <span class="variable constant_">REGION</span>,</span><br><span class="line">    <span class="comment">// 从STS服务获取的临时访问密钥（AccessKey ID和AccessKey Secret）。</span></span><br><span class="line">    <span class="attr">accessKeyId</span>: res.<span class="property">Credentials</span>.<span class="property">AccessKeyId</span>,</span><br><span class="line">    <span class="attr">accessKeySecret</span>: res.<span class="property">Credentials</span>.<span class="property">AccessKeySecret</span>,</span><br><span class="line">    <span class="comment">// 从STS服务获取的安全令牌（SecurityToken）。</span></span><br><span class="line">    <span class="attr">stsToken</span>: res.<span class="property">Credentials</span>.<span class="property">SecurityToken</span>,</span><br><span class="line">    <span class="comment">// 填写Bucket名称。</span></span><br><span class="line">    <span class="attr">bucket</span>: <span class="variable constant_">BUCKET</span>,</span><br><span class="line">    <span class="comment">// 刷新 token，在 token 过期后自动调用（但是并不生效，可能会在后续的版本中修复）</span></span><br><span class="line">    <span class="attr">refreshSTSToken</span>: <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="comment">// 向您搭建的STS服务获取临时访问凭证。</span></span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getSts</span>()</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">accessKeyId</span>: res.<span class="property">Credentials</span>.<span class="property">AccessKeyId</span>,</span><br><span class="line">        <span class="attr">accessKeySecret</span>: res.<span class="property">Credentials</span>.<span class="property">AccessKeySecret</span>,</span><br><span class="line">        <span class="attr">stsToken</span>: res.<span class="property">Credentials</span>.<span class="property">SecurityToken</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 刷新临时访问凭证的时间间隔，单位为毫秒。</span></span><br><span class="line">    <span class="attr">refreshSTSTokenInterval</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3、在<code>constants/index.js</code>新增常量<code>REGION</code>、<code>BUCKET</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// STS 上传数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">REGION</span> = <span class="string">&#x27;oss-cn-beijing&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">BUCKET</span> = <span class="string">&#x27;imooc-front&#x27;</span></span><br></pre></td></tr></table></figure>
<p>4、在<code>api/sys.js</code>定义接口，获取<code>accessKeyId、accessKeySecret</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 OSS 上传凭证</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getSts</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/sts&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、在<code>view/profile/components/changeAvatar.vue</code>中定义<code>putObjectToOSS</code>方法，上传图片到 OSS </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getOSSClient &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/sts&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ossClient = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">putObjectToOSS</span> = <span class="keyword">async</span> (<span class="params">file</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!ossClient) &#123;</span><br><span class="line">    ossClient = <span class="keyword">await</span> <span class="title function_">getOSSClient</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 因为当前凭证只具备 images 文件夹下的访问权限，所以图片需要上传到 images/xxx.xx 。否则你将得到一个 《AccessDeniedError: You have no right to access this object because of bucket acl.》 的错误</span></span><br><span class="line">    <span class="keyword">const</span> fileTypeArr = file.<span class="property">type</span>.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> fileName = <span class="string">`<span class="subst">$&#123;store.getters.userInfo.username&#125;</span>/<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">      fileTypeArr[fileTypeArr.length - <span class="number">1</span>]</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span>`</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> ossClient.<span class="title function_">put</span>(<span class="string">`images/<span class="subst">$&#123;fileName&#125;</span>`</span>, file) <span class="comment">// 文件存放路径，文件</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">message</span>(<span class="string">&#x27;error&#x27;</span>, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6、当图片裁剪完成之后，触发该方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onConfirmClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  loading.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// 获取裁剪后的图片</span></span><br><span class="line">  cropper.<span class="title function_">getCroppedCanvas</span>().<span class="title function_">toBlob</span>(<span class="function">(<span class="params">blob</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 裁剪后的 blob 地址</span></span><br><span class="line">    <span class="comment">// console.log(URL.createObjectURL(blob))</span></span><br><span class="line">    <span class="title function_">putObjectToOSS</span>(blob)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7、在头像上传成功之后，只需要调用对应 更新用户信息 接口，即可完成头像的更新。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上传新头像到服务器</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onChangeProfile</span> = <span class="keyword">async</span> (<span class="params">avatar</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 更新本地数据</span></span><br><span class="line">  store.<span class="title function_">commit</span>(<span class="string">&#x27;user/setUserInfo&#x27;</span>, &#123;</span><br><span class="line">    ...store.<span class="property">getters</span>.<span class="property">userInfo</span>,</span><br><span class="line">    avatar</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 更新服务器数据</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">putProfile</span>(store.<span class="property">getters</span>.<span class="property">userInfo</span>)</span><br><span class="line">  <span class="title function_">message</span>(<span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;用户头像修改成功&#x27;</span>) <span class="comment">// 通知用户</span></span><br><span class="line">  loading.<span class="property">value</span> = <span class="literal">false</span> <span class="comment">// 关闭 loading</span></span><br><span class="line">  <span class="title function_">close</span>() <span class="comment">// 关闭 dialog</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>8、在<code>putObjectToOSS</code>中触发该方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">putObjectToOSS</span> = <span class="keyword">async</span> (<span class="params">file</span>) =&gt; &#123;</span><br><span class="line">  ......</span><br><span class="line">    <span class="title function_">onChangeProfile</span>(res.<span class="property">url</span>) <span class="comment">// 通知服务器</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">message</span>(<span class="string">&#x27;error&#x27;</span>, e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="登录鉴权"><a href="#登录鉴权" class="headerlink" title="登录鉴权"></a>登录鉴权</h4><p>目前退出登录之后，应用依然会停留在 profile页面，这显然是不合理的。用户在个人资料页面退出登陆后，应让页面跳转到首页，即在用户未登录状态不可查看个人资料页面。需要登录鉴权功能。</p>
<p>在<code>vue-router</code> <code>4.x</code>中一些钩子和<code>api</code>发生了改变、包括这一小节需要使用到的：<strong>全局前置守卫beforeEach</strong></p>
<blockquote>
<p>在vue-router <code>4.x</code>中<code>beforeEach</code>所接收的回调函数中 第三个参数<code>next</code>不是必须的；而使用 <strong>函数返回 不同的值 来代替next的作用</strong></p>
</blockquote>
<p><strong>返回值及作用：</strong></p>
<ul>
<li><code>false</code>：取消当前的导航。如果浏览器的 URL 改变了(可能是用户手动或者浏览器后退按钮)，那么 URL 地址会重置到 <code>from</code> 路由对应的地址。</li>
<li><code>undefined</code> / <code>true</code> ： <strong>则导航是有效的</strong>，并调用下一个导航守卫</li>
<li><code>&#123; name: &#39;Login&#39; &#125;</code> ： 表示重定向到<code>Login</code>页面</li>
<li><code>&#39;/login&#39;</code>：表示重定向到<code>/login</code></li>
</ul>
<p><strong>实现方案</strong>：</p>
<ul>
<li><p>1、在路由表中找到需要授权认证之后才能访问的路由、在其路由的<code>meta</code>属性中定义<code>user</code>属性为<code>true</code></p>
</li>
<li><p>2、使用路由全局守卫在跳转之前进行判断</p>
<ul>
<li><p>跳转的路由<code>user</code>属性是否为<code>true</code></p>
<ul>
<li><p><code>true</code>：判断用户是否已登录？ 允许跳转 ： 重定向到 ‘/‘</p>
</li>
<li><p><code>false</code>：允许跳转</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li>在<code>premission.js</code>中进行认证</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;@/libs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理需登录页面的访问权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 无需登录的页面访问</span></span><br><span class="line">  <span class="keyword">if</span> (!to.<span class="property">meta</span>.<span class="property">user</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 已登录，可进入</span></span><br><span class="line">  <span class="keyword">if</span> (store.<span class="property">getters</span>.<span class="property">token</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 未登录，警告然后返回首页 - 鉴权</span></span><br><span class="line">  <span class="title function_">message</span>(<span class="string">&#x27;warn&#x27;</span>, <span class="string">&#x27;登录失效，请重新登录!&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;/&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>main.js</code>引入认证</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/styles/index.scss&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;@/App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useREM &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/flexible&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useTheme &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/theme&#x27;</span></span><br><span class="line"><span class="keyword">import</span> libs <span class="keyword">from</span> <span class="string">&#x27;@/libs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> directives <span class="keyword">from</span> <span class="string">&#x27;@/directives&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;virtual:svg-icons-register&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./premission&#x27;</span> <span class="comment">// + 引入认证文件</span></span><br></pre></td></tr></table></figure>
<h3 id="34、移动端路由切换"><a href="#34、移动端路由切换" class="headerlink" title="34、移动端路由切换"></a>34、移动端路由切换</h3><h4 id="通用组件-trigger-menu"><a href="#通用组件-trigger-menu" class="headerlink" title="通用组件  trigger-menu"></a>通用组件  <code>trigger-menu</code></h4><p>对于移动端的展示而言，它有一个和 PC端非常不一样的地方，那就是：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191513990.jpg" alt="photo"> </p>
<p>这块内容充当了移动端中的<code>TabBar</code>的作用，把它封装为一个通用的组件。<br>接下来就需要来去分析一下这个<code>&quot;TabBar&quot;</code>，把它叫做<code>trigger-menu</code>的构建方案。<br>我们期望将来 <code>trigger-menu</code>可以以这样的形式进行使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-trigger-menu</span><br><span class="line">  v-if=&quot;isMobileTerminal&quot;</span><br><span class="line">  class=&quot;fixed bottom-6 m-auto left-0 right-0 w-[220px]&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;m-trigger-menu-item</span><br><span class="line">    icon=&quot;home&quot;</span><br><span class="line">    iconClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    首页</span><br><span class="line">  &lt;/m-trigger-menu-item&gt;</span><br><span class="line">  &lt;m-trigger-menu-item</span><br><span class="line">    v-if=&quot;$store.getters.token&quot;</span><br><span class="line">    icon=&quot;vip&quot;</span><br><span class="line">    iconClass=&quot;fill-zinc-400 dark:fill-zinc-500&quot;</span><br><span class="line">    textClass=&quot;text-zinc-400 dark:text-zinc-500&quot;</span><br><span class="line">    @click=&quot;onVipClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    VIP</span><br><span class="line">  &lt;/m-trigger-menu-item&gt;</span><br><span class="line">  &lt;m-trigger-menu-item</span><br><span class="line">    icon=&quot;profile&quot;</span><br><span class="line">    iconClass=&quot;fill-zinc-400 dark:fill-zinc-500&quot;</span><br><span class="line">    textClass=&quot;text-zinc-400 dark:text-zinc-500&quot;</span><br><span class="line">    @click=&quot;onMyClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;&#123; $store.getters.token ? &#x27;我的&#x27; : &#x27;登录&#x27; &#125;&#125;</span><br><span class="line">  &lt;/m-trigger-menu-item&gt;</span><br><span class="line">&lt;/m-trigger-menu&gt;</span><br></pre></td></tr></table></figure>
<p>它被分成了两个组件：<code>trigger-menu</code>和<code>trigger-menu-item</code><br>其中 <code>trigger-menu</code>表示整个的功能区域，<code>trigger-menu-item</code>表示其中的每一项。<br>所以需要针对于这两个组件分别进行分析：</p>
<ol>
<li><p><code>trigger-menu</code>：对于它而言，只起到一个<strong>包裹容器</strong>的作用，所以只需要提供一个对应的插槽即可</p>
</li>
<li><p><code>trigger-menu-item</code>：起到了对应的展示作用，展示包括了<code>icon</code>和文字。所以内部应该存在<code>svg-icon</code>用来展示图片，存在一个插槽用来展示文字。</p>
</li>
</ol>
<p>那么到这里就基本分析完成了这两个组件的基本构建方案，整体还是比较简单的。</p>
<ol>
<li>创建<code>libs/trigger-menu/index.vue</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;flex items-center justify-between py-1 px-3 rounded-full bg-white dark:bg-zinc-800 duration-300&quot;</span><br><span class="line">    v-bind=&quot;$attrs&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;slot /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>libs/trigger-menu-item/index.vue</code>，并定义 <code>props</code>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">icon</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">iconClass</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">textClass</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">to</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Object</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>根据<code>props</code>处理对应视图：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;w-5 flex flex-col items-center justify-center col mx-0.5&quot;</span><br><span class="line">    @click=&quot;onItemClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      :name=&quot;icon&quot;</span><br><span class="line">      :fillClass=&quot;iconClass&quot;</span><br><span class="line">      class=&quot;w-2 h-2&quot;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;p class=&quot;text-sm mt-0.5&quot; :class=&quot;textClass&quot;&gt;</span><br><span class="line">      &lt;slot /&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>处理对应的点击链接</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onItemClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!props.<span class="property">to</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  router.<span class="title function_">push</span>(props.<span class="property">to</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/main/index.vue</code>中根据<strong>设备状态</strong>和<strong>登录状态</strong>进行展示</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-trigger-menu</span><br><span class="line">  v-if=&quot;isMobileTerminal&quot;</span><br><span class="line">  class=&quot;fixed bottom-6 m-auto left-0 right-0 w-[220px]&quot;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;m-trigger-menu-item</span><br><span class="line">    icon=&quot;home&quot;</span><br><span class="line">    iconClass=&quot;fill-zinc-900 dark:fill-zinc-200&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    首页</span><br><span class="line">  &lt;/m-trigger-menu-item&gt;</span><br><span class="line">  &lt;m-trigger-menu-item</span><br><span class="line">    v-if=&quot;$store.getters.token&quot;</span><br><span class="line">    icon=&quot;vip&quot;</span><br><span class="line">    iconClass=&quot;fill-zinc-400 dark:fill-zinc-500&quot;</span><br><span class="line">    textClass=&quot;text-zinc-400 dark:text-zinc-500&quot;</span><br><span class="line">    @click=&quot;onVipClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    VIP</span><br><span class="line">  &lt;/m-trigger-menu-item&gt;</span><br><span class="line">  &lt;m-trigger-menu-item</span><br><span class="line">    icon=&quot;profile&quot;</span><br><span class="line">    iconClass=&quot;fill-zinc-400 dark:fill-zinc-500&quot;</span><br><span class="line">    textClass=&quot;text-zinc-400 dark:text-zinc-500&quot;</span><br><span class="line">    @click=&quot;onMyClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &#123;&#123; $store.getters.token ? &#x27;我的&#x27; : &#x27;登录&#x27; &#125;&#125;</span><br><span class="line">  &lt;/m-trigger-menu-item&gt;</span><br><span class="line">&lt;/m-trigger-menu&gt;</span><br></pre></td></tr></table></figure>
<h4 id="移动端过渡动效"><a href="#移动端过渡动效" class="headerlink" title="移动端过渡动效"></a>移动端过渡动效</h4><p>通常情况下说起移动端项目，指的一般是两种：原生<code>APP</code>和<code>H5</code>网页</p>
<p>本项目移动端，指的其实就是<code>H5</code>网页。该内容依然是以网页为主，但是被运行到手机端之中。<br>而 H5 网页应用到手机端的时候，通常也是有两种运行的形式：</p>
<ol>
<li>直接在手机端浏览器中运行：这种使用情况相对较少。在这种情况下，用户明显的知道这就是一个网页</li>
<li>在原生组件<code>WebView</code>中运行(混合开发)：通常会被嵌入到<code>APP</code>之中，这种使用情况比较多。所以以下内容，主要针对这种情况进行说明。</li>
</ol>
<p>那么这种情况下，用户会认为该内容是<code>APP</code>的一部分，不会把它当成网页，而是会把它当做<code>原生APP</code>。那么一旦用户把它作为<code>APP</code>来进行衡量，那么就会对这块应用有更高的要求。</p>
<p><strong><em>路由之间的跳转应该具备对应的动画</em></strong>，并且上一个页面的状态应该被缓存（页面的滚动状态和数掘视图）<br>所以想要实现这样的功能，那么就必须要使用到之前提到过的 <em>过渡动效</em> 。<br>把整个的一套移动端的跳转全部封装为一个 通用组件，通过这个通用组件来实现<strong>移动端下 H5 页面的过渡功能</strong></p>
<p>根据分析可知，接下来要实现<strong>移动端的过渡动效</strong>，以达到一个良好的移动端用户交互体验，所以接下来就要尝试分析一下它的实现方案。<br>它的实现方案整体分为两种：1、过渡动画   2、组件缓存</p>
<p><strong>过渡动画</strong></p>
<p>需要使用到 过渡动效 这个功能，它描述了两个路由之间进行过渡时的动画效果。<br>在这个功能的官方描述中，主要包含了三个对应的组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 路由出口 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-slot</span>=<span class="string">&quot;&#123; Component &#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 动画 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">:name</span>=<span class="string">&quot;transitionName&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--动态组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;Component&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>利用其中的<code>transition</code>就可以实现跳转时的动画效果，但是需要注意过渡动画分为两部分：</p>
<ol>
<li>进入动画</li>
<li>退出动画</li>
</ol>
<p>所以这里<code>transition</code>的<code>name</code>需要是动态的，一次来表示对应的两种动画形式</p>
<p><strong>组件缓存</strong></p>
<p>因为要使用到<strong>组件缓存</strong>，所以还需要依赖 keep-alive。那么这四个组件想要在一起工作，将要按照以下的方式进行组合：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--路由出口 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-slot</span>=<span class="string">&quot;&#123; Component &#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 动画组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">transition</span> <span class="attr">:name-</span>&quot;<span class="attr">transitionName</span>&#x27;&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 缓存组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 动态组件 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">component</span></span></span><br><span class="line"><span class="tag">       <span class="attr">:is</span>=<span class="string">&quot;Component&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">:key.</span>&quot;$<span class="attr">route.fullPath</span>&quot;  // <span class="attr">同域名下的跳转</span>。<span class="attr">比如</span>(<span class="attr">动态路由</span> /<span class="attr">detail</span>/<span class="attr">:id</span>)</span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是同样有一点，需要注意：不是所有的组件都需要缓存<br>把<strong>组件的进入和退出流程，比作一个栈</strong>，那么只有进入到栈中的组件才需要被缓存，这就像<code>Android</code>中的 <em>任务栈</em> 概念一样，如下图所示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191513352.jpg" alt="photo"> </p>
<p>在当前移动端的组件处理中，需要有一个这样的栈来维护组件进入和退出流程，把这样的一套流程，称作：<strong>虚拟任务栈</strong></p>
<p>对于这样的一个虚拟任务栈而言，可以通过<strong>数组</strong>来进行维护，因为数组与栈的概念相同都是：<strong>先进后出</strong>的流程。</p>
<p>然后可以通过<code>keep-alive</code>中的<code>include</code>概念，把<strong>虚拟任务栈 - 数组</strong>进行绑定，从而实现<strong>任务栈</strong>的缓存概念</p>
<h4 id="通用组件transition-router-view"><a href="#通用组件transition-router-view" class="headerlink" title="通用组件transition-router-view"></a>通用组件<code>transition-router-view</code></h4><ol>
<li>创建<code>libs/transition-router-view/index.vue</code>组件</li>
<li>创建如下<code>template</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!--路由出口 --&gt;</span><br><span class="line">  &lt;router-view v-slot=&quot;&#123; Component &#125;&quot;&gt;</span><br><span class="line">    &lt;!-- 动画组件 --&gt;</span><br><span class="line">    &lt;transition :name-&quot;transitionName&#x27;&gt;</span><br><span class="line">      &lt;!-- 缓存组件 --&gt;</span><br><span class="line">      &lt;keep-alive&gt;</span><br><span class="line">        &lt;!-- 动态组件 --&gt;</span><br><span class="line">        &lt;component :is=&quot;Component&quot; /&gt;</span><br><span class="line">      &lt;/keep-alive&gt;</span><br><span class="line">    &lt;/transition&gt;</span><br><span class="line">  &lt;/router-view&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>定义对应的<code>props</code>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">// 路由跳转的类型，对应 ROUTER_TYPE_ENUM</span></span><br><span class="line">  <span class="attr">routerType</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="variable constant_">NONE</span>,</span><br><span class="line">    <span class="title function_">validator</span>(<span class="params">val</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="variable constant_">ROUTER_TYPE_ENUM</span>.<span class="title function_">includes</span>(val)</span><br><span class="line">      <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">          <span class="string">`你的 routerType 必须是 <span class="subst">$&#123;ROUTER_TYPE_ENUM.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span> 中的一个`</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 首页的组件名称，对应任务栈中的第一个组件(首页永远处于栈底)</span></span><br><span class="line">  <span class="attr">mainComponentName</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>接下来处理<strong>路由过渡动画</strong>：</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">// push页面时：新页面的进入动画</span><br><span class="line"><span class="selector-class">.push-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">animation-name</span>: push-in;</span><br><span class="line">  <span class="attribute">animation-duration</span>: <span class="number">0.4s</span>;</span><br><span class="line">&#125;</span><br><span class="line">// push页面时：老页面的退出动画</span><br><span class="line"><span class="selector-class">.push-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">animation-name</span>: push-out;</span><br><span class="line">  <span class="attribute">animation-duration</span>: <span class="number">0.4s</span>;</span><br><span class="line">&#125;</span><br><span class="line">// push页面时：新页面的进入动画</span><br><span class="line"><span class="keyword">@keyframes</span> push-in &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// push页面时：老页面的退出动画</span><br><span class="line"><span class="keyword">@keyframes</span> push-out &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 后退页面时：即将展示的页面动画</span><br><span class="line"><span class="selector-class">.back-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">animation-name</span>: back-in;</span><br><span class="line">  <span class="attribute">animation-duration</span>: <span class="number">0.4s</span>;</span><br><span class="line">&#125;</span><br><span class="line">// 后退页面时：后退的页面执行的动画</span><br><span class="line"><span class="selector-class">.back-leave-active</span> &#123;</span><br><span class="line">  <span class="attribute">animation-name</span>: back-out;</span><br><span class="line">  <span class="attribute">animation-duration</span>: <span class="number">0.4s</span>;</span><br><span class="line">&#125;</span><br><span class="line">// 后退页面时：即将展示的页面动画</span><br><span class="line"><span class="keyword">@keyframes</span> back-in &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">100%</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 后退页面时：后退的页面执行的动画</span><br><span class="line"><span class="keyword">@keyframes</span> back-out &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">50%</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line"><span class="keyword">const</span> transitionName = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)<span class="comment">// 跳转动画</span></span><br><span class="line"><span class="comment">// 监听路由变化 - router的前置路由守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  transitionName.<span class="property">value</span> = props.<span class="property">routerType</span> <span class="comment">// 定义当前动画名称</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/modules/app.js</code>保存<code>routerType</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="attr">routerType</span>: <span class="string">&#x27;none&#x27;</span> <span class="comment">// 路由跳转类型</span></span><br><span class="line">&#125;),</span><br><span class="line"><span class="attr">mutations</span>: &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">// 修改 routerType</span></span><br><span class="line">  <span class="title function_">changeRouterType</span>(<span class="params">state, newType</span>) &#123;</span><br><span class="line">  state.<span class="property">routerType</span> = newType</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/getters.js</code>中指定对应的<code>getters</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">// 路由跳转方式</span></span><br><span class="line">  <span class="attr">routerType</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isMobileTerminal.<span class="property">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;none&#x27;</span> <span class="comment">// 在 PC 端下，永远为 none</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state.<span class="property">app</span>.<span class="property">routerType</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>修改对应组件的<code>push</code>和<code>back</code>，并在<code>App.vue</code>中将<code>router-view</code>更改为<code>m-transition-router-view</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 一级路由出口 --&gt;</span><br><span class="line">   &lt;!-- 设置吸顶效果 --&gt;</span><br><span class="line">  &lt;div class=&quot;h-screen fixed top-0 left-0 w-screen&quot;&gt;</span><br><span class="line">    &lt;!-- &lt;router-view /&gt; --&gt;</span><br><span class="line">    &lt;m-transition-router-view</span><br><span class="line">      mainComponentName=&quot;home&quot;</span><br><span class="line">      :routerType=&quot;$store.getters.routerType&quot;</span><br><span class="line">    &gt;&lt;/m-transition-router-view&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h4 id="处理过渡动画展示样式出错"><a href="#处理过渡动画展示样式出错" class="headerlink" title="处理过渡动画展示样式出错"></a>处理过渡动画展示样式出错</h4><p>点击<code>TabBar</code>时，动画切换页面首页不显示，被要切换页面顶到底部，无法看见。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 路由出口 --&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-slot</span>=<span class="string">&quot;&#123; Component &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 动画组件 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">transition</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:name</span>=<span class="string">&quot;transitionName&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">before-enter</span>=<span class="string">&quot;beforeEnter&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">after-leave</span>=<span class="string">&quot;afterLeave&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="comment">&lt;!-- 缓存组件 --&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">component</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:is</span>=<span class="string">&quot;Component&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;fixed top-0 left-0 w-screen z-50&#x27;: isAnimation &#125;&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理动画状态变化</span></span><br><span class="line"><span class="keyword">const</span> isAnimation = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">beforeEnter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isAnimation.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">afterLeave</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  isAnimation.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="通用组件虚拟任务栈"><a href="#通用组件虚拟任务栈" class="headerlink" title="通用组件虚拟任务栈"></a>通用组件虚拟任务栈</h4><p>在<strong>路由表</strong>和<strong>组件</strong>中都添加对应的<strong>name</strong>属性；且要设置name属性值是相同的</p>
<blockquote>
<p>注意： 路由表中的<code>name</code>属性和组件的<code>name</code>属性的作用是不同的：</p>
<ul>
<li><p>路由表中的<code>name</code>： 是做路由跳转的，可以在<code>push（&#123;name: ‘home’&#125;）</code>进行跳转</p>
</li>
<li><p>组件<code>name</code>属性：一般是在<code>devtools中</code>更容易的区分某个组件、和<code>keep-alive</code>中也是通过组件<code>name</code>来进行缓存的</p>
</li>
</ul>
</blockquote>
<p>目前路由的跳转动画已经执行成功，那么下面就可以来处理对应的组件缓存<br>对于组件缓存而言，将通过 keep-alive 来构建一个虚拟任务栈：</p>
<ol>
<li>在<code>libs/transition-router-view/index.vue</code>中，定义变量：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> virtualTaskStack = <span class="title function_">ref</span>([props.<span class="property">mainComponentName</span>]) <span class="comment">// 任务栈</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>beforeEach</code>中，定义出栈和入栈：监听路由跳转、在跳转之前保存跳转路由表的name属性值</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听路由变化 - router的前置路由守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  transitionName.<span class="property">value</span> = props.<span class="property">routerType</span> <span class="comment">// 定义当前动画名称</span></span><br><span class="line">  <span class="keyword">if</span>(props.<span class="property">routerType</span> === <span class="variable constant_">PUSH</span>) &#123;</span><br><span class="line">    virtualTaskStack.<span class="property">value</span>.<span class="title function_">push</span>(to.<span class="property">name</span>) <span class="comment">// 入栈</span></span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (props.<span class="property">routerType</span> === <span class="variable constant_">BACK</span>) &#123;</span><br><span class="line">    virtualTaskStack.<span class="property">value</span>.<span class="title function_">pop</span>() <span class="comment">// 出栈</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 进入首页默认清空栈</span></span><br><span class="line">  <span class="keyword">if</span>(to.<span class="property">name</span> === props.<span class="property">mainComponentName</span>) &#123;</span><br><span class="line">    <span class="title function_">clearTask</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>定义清空栈的方法，在进入首页时应该调用</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清空栈</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clearTask</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  virtualTaskStack.<span class="property">value</span> = [props.<span class="property">mainComponentName</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听路由变化 - router的前置路由守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">// 进入首页默认清空栈</span></span><br><span class="line">  <span class="keyword">if</span>(to.<span class="property">name</span> === props.<span class="property">mainComponentName</span>) &#123;</span><br><span class="line">    <span class="title function_">clearTask</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/main/index.vue</code>中配置组件name</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>使用<code>keep-alive</code>组件配合<code>include</code>属性实现动态缓存组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 缓存组件 --&gt;</span><br><span class="line">&lt;keep-alive :include=&quot;virtualTaskStack&quot;&gt;</span><br><span class="line">  &lt;component</span><br><span class="line">    :is=&quot;Component&quot;</span><br><span class="line">    :class=&quot;&#123; &#x27;fixed top-0 left-0 w-screen z-50&#x27;: isAnimation &#125;&quot;</span><br><span class="line">    :key=&quot;$route.fullPath&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>App.vue</code>中指定<code>mainComponentName</code>为<code>home</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;m-transition-router-view</span><br><span class="line">  mainComponentName=&quot;home&quot;</span><br><span class="line">  :routerType=&quot;$store.getters.routerType&quot;</span><br><span class="line">&gt;&lt;/m-transition-router-view&gt;</span><br></pre></td></tr></table></figure>
<h4 id="记录页面滚动位置"><a href="#记录页面滚动位置" class="headerlink" title="记录页面滚动位置"></a>记录页面滚动位置</h4><p>当用户在首页滚动一定区域后，点击<code>TabBar</code>跳转路由后，再<code>back</code>回首页，此时不会回到用户点击之前的滚动后区域，而是会回到首页顶部区域。</p>
<p><code>keep-alive</code>组件只能够帮助缓存组件，但是不能够记录页面的滚动位置。所以如果想要记录页面滚动位置的话，需要在<strong>通用组件外</strong>单独处理。目前在当前应用中仅需要保存<code>home</code>页面的滚动位置即可：</p>
<ol>
<li>在<code>view/main.index.vue</code>中，进行记录滚动位置，可以通过<code>useScroll</code>进行记录</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> containerTarget = <span class="title function_">ref</span>(<span class="literal">null</span>) <span class="comment">// 记录页面滚动位置</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">y</span>: containerTargetScrollY &#125; = <span class="title function_">useScroll</span>(containerTarget)</span><br><span class="line"><span class="comment">// 被缓存的组件再次可见，会回调 onActivated 方法</span></span><br><span class="line"><span class="title function_">onActivated</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!containerTarget.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  containerTarget.<span class="property">value</span>.<span class="property">scrollTop</span> = containerTargetScrollY.<span class="property">value</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>在最外层<code>div</code>绑定<code>ref</code></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">&quot;h-full overflow-auto bg-white dark:bg-zinc-800 duration-500 scrollbar-thin scrollbar-thumb-transparent xl:scrollbar-thumb-zinc-200 xl:dark:scrollbar-thumb-zinc-900 scrollbar-track-transparent&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">ref</span>=<span class="string">&quot;containerTarget&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="35、精选VIP服务"><a href="#35、精选VIP服务" class="headerlink" title="35、精选VIP服务"></a>35、精选VIP服务</h3><p>到现在为止，还剩下最后一个<code>升级 VIP</code>的页面，定义 VIP 的核心是<strong>支付</strong>，剩下的所有逻辑都是为了最终的<strong>支付</strong>来服务的。<br>本章中所设计到的主要内容包含两部分：</p>
<ol>
<li>基础的业务构建</li>
<li>优惠倒计时通用组件</li>
</ol>
<h4 id="基础样式构建"><a href="#基础样式构建" class="headerlink" title="基础样式构建"></a>基础样式构建</h4><ol>
<li>创建<code>view/vip/index.vue</code>组件</li>
<li>处理对应路由表：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/vip&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;vip&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/vip/index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">meta</span>: &#123;</span><br><span class="line">      <span class="attr">user</span>: <span class="literal">true</span> <span class="comment">// 需要登录才能访问</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>api/pay.js</code>接口地址：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 VIP 支付数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getVipPayList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/vip/pay/list&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>为<code>view/vip/index.vue</code>指定样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;h-full bg-zinc-200 dark:bg-zinc-800 duration-400 xl:pt-1&quot;&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;max-w-screen-lg mx-auto bg-white dark:bg-zinc-900 duration-400 xl:rounded-sm xl:border-zinc-200 xl:dark:border-zinc-600 xl:border-[1px] xl:px-4&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- 移动端 navbar 处理 --&gt;</span><br><span class="line">      &lt;m-navbar v-if=&quot;isMobileTerminal&quot; sticky :clickLeft=&quot;onNavbarLeftClick&quot;&gt;</span><br><span class="line">        精选会员</span><br><span class="line">      &lt;/m-navbar&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;py-2 px-1&quot;&gt;</span><br><span class="line">        &lt;h2</span><br><span class="line">          class=&quot;text-center text-[34px] font-bold tracking-widest text-yellow-600&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          精选VIP</span><br><span class="line">        &lt;/h2&gt;</span><br><span class="line">        &lt;p class=&quot;text-center text-lg text-yellow-500&quot;&gt;</span><br><span class="line">          升级精选VIP，畅想所有内容</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&quot;flex justify-between mt-5 overflow-auto pb-2 scrollbar-thin scrollbar-thumb-zinc-200 dark:scrollbar-thumb-zinc-700 scrollbar-track-transparent&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;pay-menu-item-vue</span><br><span class="line">            v-for=&quot;item in vipPayListData&quot;</span><br><span class="line">            :key=&quot;item.id&quot;</span><br><span class="line">            :hot=&quot;item.isHot&quot;</span><br><span class="line">            :select=&quot;item.id === currentPayData.id&quot;</span><br><span class="line">            :data=&quot;item&quot;</span><br><span class="line">            @click=&quot;onChangeCurrentPay&quot;</span><br><span class="line">          &gt;&lt;/pay-menu-item-vue&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;p class=&quot;mt-1 text-sm text-zinc-500&quot;&gt;&#123;&#123; currentPayData.desc &#125;&#125;&lt;/p&gt;</span><br><span class="line">        &lt;!-- 支付 --&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;vip&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import payMenuItemVue from &#x27;./components/pay-menu-item.vue&#x27;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; getVipPayList &#125; from &#x27;@/api/pay&#x27;</span><br><span class="line">  </span><br><span class="line">// 获取支付列表数据</span><br><span class="line">const vipPayListData = ref([])</span><br><span class="line">const getVipPayListData = async () =&gt; &#123;</span><br><span class="line">  const res = await getVipPayList()</span><br><span class="line">  vipPayListData.value = res</span><br><span class="line">  currentPayData.value = vipPayListData.value[0]</span><br><span class="line">&#125;</span><br><span class="line">getVipPayListData()</span><br><span class="line"></span><br><span class="line">// navbar后退</span><br><span class="line">const store = useStore()</span><br><span class="line">const router = useRouter()</span><br><span class="line">const onNavbarLeftClick = () =&gt; &#123;</span><br><span class="line">  store.commit(&#x27;app/changeRouterType&#x27;, &#x27;back&#x27;) // 配置跳转方式</span><br><span class="line">  router.back()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 点击item - 选中支付项</span><br><span class="line">const currentPayData = ref(&#123;&#125;)</span><br><span class="line">const onChangeCurrentPay = (item) =&gt; &#123;</span><br><span class="line">  currentPayData.value = item</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>view/vip/components/pay-menu-item.vue</code>：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 单个的支付项 --&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;flex-none flex flex-col items-center w-[100px] mt-2 mr-2 py-3 border-[1px] hover:bg-orange-50 hover:border-orange-300 rounded-md relative cursor-pointer xl:w-[150px] xl:py-2&quot;</span><br><span class="line">    :class=&quot;[</span><br><span class="line">      select</span><br><span class="line">        ? &#x27;bg-orange-50 dark:bg-orange-50/10 border-orange-300 &#x27;</span><br><span class="line">        : &#x27;bg-white dark:bg-zinc-900 border-zinc-300 dark:border-zinc-500&#x27;</span><br><span class="line">    ]&quot;</span><br><span class="line">    @click=&quot;onItemClick&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 标题 --&gt;</span><br><span class="line">    &lt;p</span><br><span class="line">      class=&quot;text-base&quot;</span><br><span class="line">      :class=&quot;[</span><br><span class="line">        select</span><br><span class="line">          ? &#x27;text-yellow-800 dark:text-orange-300&#x27;</span><br><span class="line">          : &#x27;text-yellow-800 dark:text-zinc-300&#x27;</span><br><span class="line">      ]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;&#123; data.title &#125;&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;!-- 价格 --&gt;</span><br><span class="line">    &lt;p</span><br><span class="line">      class=&quot;text-[32px] tracking-tighter font-sans font-bold&quot;</span><br><span class="line">      :class=&quot;[</span><br><span class="line">        select</span><br><span class="line">          ? &#x27;text-yellow-800 dark:text-orange-300&#x27;</span><br><span class="line">          : &#x27;text-yellow-800 dark:text-zinc-300&#x27;</span><br><span class="line">      ]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;text-base&quot;&gt;￥&lt;/span&gt;</span><br><span class="line">      &#123;&#123; data.price &#125;&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;!-- 原价 --&gt;</span><br><span class="line">    &lt;p class=&quot;text-xs text-yellow-500 line-through&quot;&gt;￥&#123;&#123; data.oldPrice &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;!-- 热销 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      v-if=&quot;hot&quot;</span><br><span class="line">      class=&quot;absolute right-[-1px] top-[-12px] h-[22px] w-[48px] leading-[22px] text-center text-yellow-700 bg-gradient-to-r from-orange-300 to-orange-100 text-[12px] rounded-tr-[10px] rounded-bl-[10px]&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      热销</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const EMITS_CLICK = &#x27;click&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  data: &#123; // 数据源</span><br><span class="line">    type: Object,</span><br><span class="line">    required: true</span><br><span class="line">  &#125;,</span><br><span class="line">  hot: &#123; // 是否热选（热销）</span><br><span class="line">    type: Boolean</span><br><span class="line">  &#125;,</span><br><span class="line">  select: &#123; // 是否被选中</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const emits = defineEmits([EMITS_CLICK])</span><br><span class="line"></span><br><span class="line">const onItemClick = () =&gt; &#123;</span><br><span class="line">  emits(EMITS_CLICK, props.data)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>完成精选VIP页面的基本样式构建</p>
<h4 id="通用组件-倒计时"><a href="#通用组件-倒计时" class="headerlink" title="通用组件 - 倒计时"></a>通用组件 - 倒计时</h4><p>特惠部分存在一个倒计时的功能，需要先把它处理成一个通用组件。<br>所谓倒计时，其实更多的是一个时间的处理，那么对于时间的处理，需要使用到一个第三方的包：<code>dayis</code>。这个包可以处理对应的倒计时格式问题。</p>
<p>时间格式处理完成之后，处理对应的数据：倒计时模块,可以传递两个值：</p>
<ol>
<li><code>time</code>毫秒值：表示倒计时的时长</li>
<li><code>format</code>格式：表示倒计时的展示格式</li>
</ol>
<p>倒计时功能总共分成了以下两部分：<br>1．时间格式<br>2．数据</p>
<ol>
<li>创建<code>libs/count-down/index.vue</code>组件，并定义对应的<code>props</code>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="comment">// 毫秒</span></span><br><span class="line">  <span class="attr">time</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 遵循 dayjs format 标准：https://day.js.org/docs/zh-CN/parse/string-format</span></span><br><span class="line">  <span class="attr">format</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="string">&#x27;HH:mm:ss&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>该倒计时应该提供两个事件：<code>change</code>：倒计时改变、<code>finish</code>：倒计时结束：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMITS_FINISH</span> = <span class="string">&#x27;finish&#x27;</span> <span class="comment">// 倒计时结束</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">EMITS_CHANGE</span> = <span class="string">&#x27;change&#x27;</span> <span class="comment">// 倒计时改变</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emits = <span class="title function_">defineEmits</span>([<span class="variable constant_">EMITS_FINISH</span>, <span class="variable constant_">EMITS_CHANGE</span>])</span><br></pre></td></tr></table></figure>
<ol>
<li>处理倒计时对应的方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">INTERVAL_COUNT</span> = <span class="number">1000</span> <span class="comment">// 倒计时时间间隔</span></span><br><span class="line">......</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始倒计时</span></span><br><span class="line"><span class="keyword">let</span> interval = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">start</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">  interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">durationFn</span>()</span><br><span class="line">  &#125;, <span class="variable constant_">INTERVAL_COUNT</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> duration = <span class="title function_">ref</span>(<span class="number">0</span>) <span class="comment">// 倒计时时长</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 倒计时的执行行为</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">durationFn</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  duration.<span class="property">value</span> -= <span class="variable constant_">INTERVAL_COUNT</span></span><br><span class="line">  <span class="title function_">emits</span>(<span class="variable constant_">EMITS_CHANGE</span>)</span><br><span class="line">  <span class="comment">// 监听结束行为</span></span><br><span class="line">  <span class="keyword">if</span> (duration.<span class="property">value</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    duration.<span class="property">value</span> = <span class="number">0</span></span><br><span class="line">    <span class="title function_">emits</span>(<span class="variable constant_">EMITS_FINISH</span>)</span><br><span class="line">    <span class="title function_">close</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 倒计时结束 - 清理倒计时</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">close</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (interval) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(interval)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>监听 <code>props.time</code> ，开始进行倒计时：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; watch, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始倒计时</span></span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> props.<span class="property">time</span>,</span><br><span class="line">  <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    duration.<span class="property">value</span> = val</span><br><span class="line">    <span class="title function_">start</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ol>
<li>解决：用户进入VIP页面触发倒计时后，又退出页面，此时，倒计时不会销毁</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-core&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件销毁时，清理倒计时</span></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">close</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>libs/count-down/utils.js</code>，安装<code>dayjs</code>依赖</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> npm i <span class="literal">--save</span> dayjs</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dayjs/locale/zh-cn&#x27;</span></span><br><span class="line"><span class="keyword">import</span> duration <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/duration&#x27;</span></span><br><span class="line"></span><br><span class="line">dayjs.<span class="title function_">locale</span>(<span class="string">&#x27;zh&#x27;</span>) <span class="comment">// 中文</span></span><br><span class="line">dayjs.<span class="title function_">extend</span>(duration) <span class="comment">// duration 插件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> dayjs</span><br></pre></td></tr></table></figure>
<ol>
<li>利用<code>dayjs</code>处理倒计时显示时间格式</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text-sm&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;&#123; showTime &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-core&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; computed, watch, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">......</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 处理显示时间</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> showTime = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span> dayjs.<span class="title function_">duration</span>(duration.<span class="property">value</span>).<span class="title function_">format</span>(props.<span class="property">format</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/vip/index.vue</code>中使用倒计时组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 支付 --&gt;</span><br><span class="line">&lt;m-count-down :time=&quot;1000 * 60&quot; &gt;&lt;/m-count-down&gt;/&gt;</span><br></pre></td></tr></table></figure>
<h4 id="VIP支付模块"><a href="#VIP支付模块" class="headerlink" title="VIP支付模块"></a>VIP支付模块</h4><p>对于支付模块的样式而言，PC端 和 移动端 差距较大。所有分别进行处理</p>
<p><strong><code>PC</code>端：</strong></p>
<ol>
<li>创建<code>vip/components/payment/index.vue</code>，分别渲染PC端和移动端的支付样式</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- PC 端支付 --&gt;</span><br><span class="line">    &lt;pcPaymentVue</span><br><span class="line">      v-if=&quot;!isMobileTerminal&quot;</span><br><span class="line">      :payData=&quot;payData&quot;</span><br><span class="line">    &gt;&lt;/pcPaymentVue&gt;</span><br><span class="line">    &lt;!-- 移动端支付 --&gt;</span><br><span class="line">    &lt;mobile-payment-vue v-else :payData=&quot;payData&quot;&gt;&lt;/mobile-payment-vue&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line">import pcPaymentVue from &#x27;./pc-payment/index.vue&#x27;</span><br><span class="line">import mobilePaymentVue from &#x27;./mobile-payment/index.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>view/vip/components/payment/pc-payment/index.vue</code>组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 特惠提示 --&gt;</span><br><span class="line">    &lt;discountsVue&gt;&lt;/discountsVue&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import discountsVue from &#x27;../discounts.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>处理支付样式 - 限时特惠：创建<code>vip/components/payment/discount.vue</code>特惠倒计时组件：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;flex justify-center items-center py-0.5 bg-orange-100 border-orange-300 border-t xl:border xl:rounded-sm&quot;</span><br><span class="line">    v-if=&quot;!isCountDownFinish&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      name=&quot;countdown&quot;</span><br><span class="line">      class=&quot;w-1.5 h-1.5 mr-1&quot;</span><br><span class="line">      fillClass=&quot;fill-red-600&quot;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">    &lt;p class=&quot;text-xs text-red-600 font-bold&quot;&gt;</span><br><span class="line">      限时特惠 | 距离优惠结束仅剩</span><br><span class="line">      &lt;m-count-down</span><br><span class="line">        :time=&quot;52 * 60 * 1000&quot;</span><br><span class="line">        class=&quot;inline-block&quot;</span><br><span class="line">        @finish=&quot;isCountDownFinish = true&quot;</span><br><span class="line">      &gt;&lt;/m-count-down&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const isCountDownFinish = ref(false) // 倒计时是否结束</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/vip/index.vue</code>中展示<code>payment</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 支付 --&gt;</span><br><span class="line">&lt;payment-vue class=&quot;mt-4&quot; /&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/vip/components/payment/pc-payment/index.vue</code>中继续构建剩余样式：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 特惠提示 --&gt;</span><br><span class="line">    &lt;discountsVue&gt;&lt;/discountsVue&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;flex flex-col items-center justify-evenly border-zinc-200 dark:border-zinc-600 border-[1px] py-3 rounded-md mt-1&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;p class=&quot;text-[32px] text-orange-600 font-sans&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;text-base text-zinc-900 dark:text-zinc-200&quot;&gt;</span><br><span class="line">          支付金额：</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;span class=&quot;text-lg mr-[-12px]&quot;&gt;￥&lt;/span&gt;</span><br><span class="line">        19</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;flex mt-3&quot;&gt;</span><br><span class="line">        &lt;!-- 支付宝支付 --&gt;</span><br><span class="line">        &lt;div</span><br><span class="line">          class=&quot;border border-zinc-200 dark:border-zinc-600 rounded-sm w-[220px] h-[60px] flex items-center pl-2 cursor-pointer duration-200 hover:bg-zinc-50 hover:dark:bg-zinc-800&quot;</span><br><span class="line">          @click=&quot;onAliPayClick&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img class=&quot;w-4 h-4&quot; src=&quot;@/assets/images/alipay.png&quot; alt=&quot;&quot; /&gt;</span><br><span class="line">          &lt;p class=&quot;text-xl ml-1 text-zinc-800 dark:text-zinc-200&quot;&gt;支付宝&lt;/p&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>至此，<code>PC</code>端支付样式构建完成</p>
<p><strong>移动端：</strong></p>
<ol>
<li>创建<code>view/vip/components/payment/mobile-payment/index.vue</code>组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    class=&quot;fixed left-0 bottom-0 w-screen text-center bg-white dark:bg-zinc-800 xl:hidden&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;!-- 特惠提示 --&gt;</span><br><span class="line">    &lt;discounts-vue&gt;&lt;/discounts-vue&gt;</span><br><span class="line">    &lt;!-- 支付 --&gt;</span><br><span class="line">    &lt;div class=&quot;flex justify-between text-xs px-1 py-0.5&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;text-left text-zinc-900 dark:text-zinc-200&quot;&gt;</span><br><span class="line">        &lt;p class=&quot;&quot;&gt;</span><br><span class="line">          券后合计：&lt;span class=&quot;text-red-600 text-[16px] font-sans font-medium&quot;</span><br><span class="line">            &gt;￥&lt;/span</span><br><span class="line">          &gt;&lt;span class=&quot;text-red-600 text-[22px] font-sans font-medium&quot;&gt;9&lt;/span&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p class=&quot;text-red-600&quot;&gt;优惠券：限时立减 ￥10&lt;/p&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;m-button class=&quot;w-[120px]&quot; :isActiveAnim=&quot;false&quot;&gt;</span><br><span class="line">        立即开通</span><br><span class="line">      &lt;/m-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- TODO: popup --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import discountsVue from &#x27;../discounts.vue&#x27;</span><br><span class="line">&lt;/script&gt;  </span><br></pre></td></tr></table></figure>
<ol>
<li>处理点击<code>立即开通</code>弹出<code>popup</code>组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  ......</span><br><span class="line">    &lt;m-button class=&quot;w-[120px]&quot; :isActiveAnim=&quot;false&quot; @click=&quot;onConfirmClick&quot;&gt;</span><br><span class="line">        立即开通</span><br><span class="line">      &lt;/m-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">	  &lt;!-- TODO: popup --&gt;</span><br><span class="line">    &lt;m-popup v-model=&quot;isOpenPopup&quot; class=&quot;rounded&quot;&gt;</span><br><span class="line">      请选择支付方式</span><br><span class="line">    &lt;/m-popup&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import discountsVue from &#x27;../discounts.vue&#x27;</span><br><span class="line"></span><br><span class="line">// 点击立即开通弹出popup</span><br><span class="line">const isOpenPopup = ref(false)</span><br><span class="line">const onConfirmClick = () =&gt; &#123;</span><br><span class="line">  isOpenPopup.value = !isOpenPopup.value</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>view/vip/components/payment/mobile-payment/mobile-pay-select.vue</code>支付选择组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;py-2 h-[80vh] flex flex-col&quot;&gt;</span><br><span class="line">    &lt;h2 class=&quot;text-xl text-zinc-900 dark:text-zinc-200 font-bold mb-2 px-1&quot;&gt;</span><br><span class="line">      选择支付方式</span><br><span class="line">    &lt;/h2&gt;</span><br><span class="line">    &lt;!-- 支付宝 --&gt;</span><br><span class="line">    &lt;div</span><br><span class="line">      class=&quot;flex items-center px-2 py-2 border-b border-b-zinc-200 dark:border-b-zinc-600 active:bg-zinc-200 dark:active:bg-zinc-900&quot;</span><br><span class="line">      @click=&quot;onAlipay&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;img class=&quot;w-4 h-4&quot; src=&quot;@/assets/images/alipay.png&quot; alt=&quot;&quot; /&gt;</span><br><span class="line">      &lt;p class=&quot;text-xl ml-1 text-zinc-800 dark:text-zinc-200&quot;&gt;支付宝&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/vip/components/payment/mobile-payment/index.vue</code>中，通过<code>popup</code>展示：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  .......</span><br><span class="line">    &lt;!-- TODO: popup --&gt;</span><br><span class="line">    &lt;m-popup v-model=&quot;isOpenPopup&quot; class=&quot;rounded&quot;&gt;</span><br><span class="line">      &lt;mobile-pay-select-vue /&gt;</span><br><span class="line">    &lt;/m-popup&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import discountsVue from &#x27;../discounts.vue&#x27;</span><br><span class="line">import mobilePaySelectVue from &#x27;./mobile-pay-select.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>完成移动端支付样式构建</p>
<h3 id="36、第三方登录"><a href="#36、第三方登录" class="headerlink" title="36、第三方登录"></a>36、第三方登录</h3><p>第三方登录多指的是：<strong>通过第三方 APP 进行登录</strong><br>第三方的 APP是如何和自己的应用进行关联的呢?<br>想要搞明白这个问题，首先需要搞清楚整个第三方登录的流程是如何进行的。<br>以慕课网第三方登录为例：</p>
<ol>
<li>点击第三方登录按钮</li>
<li>弹出一个小窗口，展示对应二维码</li>
<li>手机打开对应的 APP 进行扫码之后，会跳转到 同意页面，同时浏览器端也会显示扫码成功</li>
<li>手机端操作同意登录之后，会出现两种情况：<ol>
<li>当前用户已注册：<ol>
<li>直接登录</li>
</ol>
</li>
<li>当前用户未注册：<ol>
<li>执行注册功能：</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191514093.jpeg" alt="photo"> </p>
<p>​        2. 注册成功即可登录</p>
<p><strong>详细流程如下</strong>：</p>
<ol>
<li>点击第三方登录按钮：执行<code>window.open</code>方法，打开一个第三方指定的<code>URL</code>窗口，该地址会指向第三方登录的<code>URL</code>，并且由第三方提供一个对应的二维码</li>
<li>弹出一个小窗口，展示对应二维码：此处展示的二维码，即为上一步中第三方提供的二维码</li>
<li>手机打开对应的<code>APP</code>进行扫码之后，会跳转到<strong>同意页面</strong>，同时浏览器端也会显示扫码成功：在第三方中会一直对该页面进行<strong>轮询</strong>，配合第三方<code>APP</code>来判断是否扫码成功</li>
<li>手机端操作同意登录之后，会出现两种情况：在<code>APP</code>中同意之后，第三方会进行对应的跳转，跳转地址为你指定的地址，在该地址中可以获取到<strong>第三方的用户信息</strong>，该信息即为第三方登录时要获取到的关键数据。</li>
<li>至此，第三方操作完成。接下来需要进行本平台的登录判定。<ol>
<li>该注册指的是<strong>第三方用户</strong>是否在本平台中进行了注册。</li>
<li>因为在之前的所有操作中，拿到的是<strong>第三方的用户信息</strong></li>
<li>该信息可以帮助直接显示对用的用户名（nickname）和头像，但是因为不包含关键信息（手机号、用户名（username）、密码）所以无法使用该信息帮助用户直接登录</li>
<li>所以需要判断当前用户是否在咱们自己的平台中完成了注册<ul>
<li>1.当前用户已注册：直接登录</li>
<li>2.当前用户未注册：执行注册功能</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>所以，有以上内容可知，想要完成第三方登录功能，共分为两个大的步骤：</p>
<ol>
<li>对接第三方平台，获取第三方平台的用户信息</li>
<li>利用该用户信息，完成本应用的注册</li>
</ol>
<h4 id="QQ开放平台流程"><a href="#QQ开放平台流程" class="headerlink" title="QQ开放平台流程"></a>QQ开放平台流程</h4><p>接下来处理<code>QQ</code>第三方登录功能。想要对接<code>QQ</code>登录，那么需要使用到<a target="_blank" rel="noopener" href="https://connect.qq.com/index.html"><code>QQ</code>互联平台</a>，在该平台中：</p>
<ol>
<li>注册账户</li>
<li>认证开发者</li>
<li>注册应用</li>
</ol>
<p>具体参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44005360/article/details/109278920">QQ登录接口申请流程（全面）-CSDN博客</a></p>
<h4 id="获取QQ用户信息"><a href="#获取QQ用户信息" class="headerlink" title="获取QQ用户信息"></a>获取QQ用户信息</h4><p>对接 QQ 登录分为以下几步：</p>
<ol>
<li>展示 QQ 登录二维码（本小节讲解）</li>
<li>获取用户信息（本小节讲解）</li>
<li>完成跨页面数据传输</li>
<li>认证是否已注册</li>
<li>完成 QQ 对接</li>
</ol>
<p><strong>展示 QQ 登录二维码</strong></p>
<ol>
<li>在<code>index.html</code>中，导入<code>QQ SDK</code></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- QQ 登录 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://connect.qq.com/qc_jssdk.js&quot;</span> <span class="attr">data-appid</span>=<span class="string">&quot;101998494（你的appid）&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">data-redirecturi</span>=<span class="string">&quot;https://imooc-front.lgdsunday.club/login(你配置的登录成功之后的回调)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>创建<code>view/login-register/login/qq-login.vue</code>组件，作为<code>QQ</code>登录处理组件，并初始化对应样式和基础功能：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;span id=&quot;qqLoginBtn&quot; v-show=&quot;false&quot;&gt;&lt;/span&gt;</span><br><span class="line">    &lt;m-svg-icon</span><br><span class="line">      class=&quot;w-4 cursor-pointer&quot;</span><br><span class="line">      name=&quot;qq&quot;</span><br><span class="line">      @click=&quot;onQQLogin&quot;</span><br><span class="line">    &gt;&lt;/m-svg-icon&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// QQ 登录的 URL</span><br><span class="line">const QQ_LOGIN_URL =</span><br><span class="line">  &#x27;https://graph.qq.com/oauth2.0/authorize?client_id=101998494&amp;response_type=token&amp;scope=all&amp;redirect_uri=https%3A%2F%2Fimooc-front.lgdsunday.club%2Flogin&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; isMobileTerminal &#125; from &#x27;@/utils/flexible&#x27;</span><br><span class="line"></span><br><span class="line">// QQ 登录挂起</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  QC.Login(</span><br><span class="line">    &#123;</span><br><span class="line">      btnId: &#x27;qqLoginBtn&#x27; //插入按钮的节点id</span><br><span class="line">    &#125;,</span><br><span class="line">    // 登录成功之后的回调，但是需要注意，这个回调只会在《登录回调页面中被执行》</span><br><span class="line">    // QQ登录存在缓存，登录成功一次之后，下次进入会自动重新登录（即：触发该方法，所以应该在离开登录页面时，注销登录）</span><br><span class="line">    (data, opts) =&gt; &#123;</span><br><span class="line">      console.log(&#x27;QQ登录成功&#x27;)</span><br><span class="line">      console.log(data)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 登录按钮事件</span><br><span class="line">const onQQLogin = () =&gt; &#123;</span><br><span class="line">  openQQWindow()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 处理 QQ 登录视窗</span><br><span class="line">const openQQWindow = async () =&gt; &#123;</span><br><span class="line">  window.open(</span><br><span class="line">    QQ_LOGIN_URL,</span><br><span class="line">    &#x27;oauth2Login_10609&#x27;,</span><br><span class="line">    &#x27;height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes&#x27;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/index.vue</code>中使用该组件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 第三方登录：QQ 微信 --&gt;</span><br><span class="line">&lt;div class=&quot;flex justify-around mt-4&quot;&gt;</span><br><span class="line">  &lt;qq-login-vue&gt;&lt;/qq-login-vue&gt;</span><br><span class="line">  &lt;m-svg-icon class=&quot;w-4 cursor-pointer&quot; name=&quot;wexin&quot;&gt;&lt;/m-svg-icon&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>那么此时，点击可展示扫码登录弹窗</p>
<p>注意： 此时扫码登录之后，进入的地址为<strong>线上的回调地址</strong>，所以后续的调试必须在线上进行。<strong>上传当前的代码到线上，进行下一步调试</strong>。</p>
<p>具体发布流程请查看：<em>发布处理方案 — 前台项目构建与发布处理</em><br>如果没有线上服务器，后续操作可以先不去完成，等待实际工作中需要对接时，再去进行查看。</p>
<p><strong>获取用户信息</strong></p>
<p>把当前代码上传成功之后，扫码登录，可查看到当前登录用户信息：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191514839.jpeg" alt="photo"> </p>
<p>注意：上述操作中扫码成功重定向的地址是在小窗口打开的、并不是在原来的窗口打开、登录成功的回调也是在小窗口中回调！！！</p>
<p>注意：因为<code>QQ</code>的自动登录机制，所以此时再次打开<code>https://imooc-front.lgdsunday.club/login</code>地址，在控制台中会打印出上次登录的用户信息</p>
<p>接下来我们进行下一步操作。</p>
<ol>
<li>注销登录，防止下次打开时，再次触发 <strong>登录成功</strong> 回调</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 注销登录，否则在后续登录中会直接触发该回调</span></span><br><span class="line"><span class="variable constant_">QC</span>.<span class="property">Login</span>.<span class="title function_">signOut</span>()</span><br></pre></td></tr></table></figure>
<ol>
<li>获取当前用户唯一标识，作为判断用户是否已注册的依据：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 获取当前用户唯一标识，作为判断用户是否已注册的依据</span></span><br><span class="line"><span class="keyword">const</span> accessToken = <span class="regexp">/access_token=((.*))&amp;expires_in/</span>.<span class="title function_">exec</span>(</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span></span><br><span class="line">)[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<ol>
<li>大家要注意，此时我们的所有的代码运行都是在 <strong>打开的新窗口中进行的</strong>，所以我们需要把关键数据，传输回 <strong>原页面</strong>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. 拼接请求对象</span></span><br><span class="line"><span class="keyword">const</span> oauthObj = &#123;</span><br><span class="line">  <span class="attr">nickname</span>: data.<span class="property">nickname</span>,</span><br><span class="line">  <span class="attr">figureurl_qq_2</span>: data.<span class="property">figureurl_qq_2</span>,</span><br><span class="line">  accessToken</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(oauthObj)</span><br></pre></td></tr></table></figure>
<p>关键数据对象拼接完成之后，下面就需要完成 <strong>跨页面传输</strong>了。</p>
<h4 id="跨页面信息传输"><a href="#跨页面信息传输" class="headerlink" title="跨页面信息传输"></a>跨页面信息传输</h4><blockquote>
<p>注意：上述操作中扫码成功重定向的地址是在小窗口打开的、并不是在原来的窗口打开、登录成功的回调也是在小窗口中回调</p>
</blockquote>
<p>由于拿到扫码用户的 <code>AccessToken</code> 和 用户的信息（昵称、头像…） 都是在小窗口上获取到的；需要将小窗口获取到的这些信息传递给主窗口上</p>
<p>想要实现跨页面信息传输，通常由两种方式：</p>
<p>1、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel">BroadcastChannel</a>：允许<strong>同源</strong>的不同浏览器窗口，<code>Tab</code>页，<code>frame</code>或者<code>iframe</code>下的不同文档之间相互通信。但是会存在兼容性问题，实测<code>Safari15.3</code>无法使用<br>2、<code>localStorage</code> + window.onstorage： 通过<code>localStorage</code>进行<strong>同源</strong>的数据传输。用来处理<code>BroadcastChannel</code>不兼容的浏览器。</p>
<p>依据以上两个<code>API</code>，实现对应的通讯模块：</p>
<ol>
<li>创建<code>view/login-register/login/broadcast.js</code>模块：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 频道名</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">LOGIN_SUCCESS_CHANNEL</span> = <span class="string">&#x27;LOGIN_SUCCESS_CHANNEL&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 官方声明 safari 支持 BroadcastChannel ，但是实测 15.3 的版本并不支持 😠，所以我们需要对其进行判定使用，在不支持 BroadcastChannel 的浏览器中，使用 localstorage</span></span><br><span class="line"><span class="keyword">let</span> broadcastChannel = <span class="literal">null</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">BroadcastChannel</span>) &#123;</span><br><span class="line">  broadcastChannel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="variable constant_">LOGIN_SUCCESS_CHANNEL</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 等待 QQ 登录成功</span></span><br><span class="line"><span class="comment"> * 因为 QQ 登录会在一个新的窗口中进行，用户扫码登录成功之后会回调《新窗口的 QC.Login 第二参数 cb》，而不会回调到原页面。</span></span><br><span class="line"><span class="comment"> * 所以我们需要在《新窗口中通知到原页面》，所以就需要涉及到 JS 的跨页面通讯，而跨页面通讯指的主要就是《同源页面的通讯》</span></span><br><span class="line"><span class="comment"> * 同源页面的通讯方式有很多，我们这里主要介绍：</span></span><br><span class="line"><span class="comment"> * 1. BroadcastChannel  -&gt;  https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel</span></span><br><span class="line"><span class="comment"> * 2. window.onstorage：注意：该事件不在导致数据变化的当前页面触发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待回调，它将返回一个 promise，并携带对应的数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">wait</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (broadcastChannel) &#123;</span><br><span class="line">      <span class="comment">// 触发 message 事件时的回调函数</span></span><br><span class="line">      broadcastChannel.<span class="property">onmessage</span> = <span class="keyword">async</span> (event) =&gt; &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(event.<span class="property">data</span>)<span class="comment">// 改变 promise 状态</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 触发 localStorage 的 setItem 事件时回调函数</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">onstorage</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 判断当前的事件名</span></span><br><span class="line">        <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="variable constant_">LOGIN_SUCCESS_CHANNEL</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(e.<span class="property">newValue</span>))<span class="comment">// 改变 promise 状态</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发送消息。</span></span><br><span class="line"><span class="comment"> * broadcastChannel：触发 message</span></span><br><span class="line"><span class="comment"> * localStorage：触发 setItem</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">send</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (broadcastChannel) &#123;</span><br><span class="line">    broadcastChannel.<span class="title function_">postMessage</span>(data)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="variable constant_">LOGIN_SUCCESS_CHANNEL</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clear</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (broadcastChannel) &#123;</span><br><span class="line">    broadcastChannel.<span class="title function_">close</span>()</span><br><span class="line">    broadcastChannel = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="variable constant_">LOGIN_SUCCESS_CHANNEL</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  wait,</span><br><span class="line">  send,</span><br><span class="line">  clear</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/qq-login.vue</code>中，使用：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> broadcast <span class="keyword">from</span> <span class="string">&#x27;./broadcast&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// QQ 登录挂起</span></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable constant_">QC</span>.<span class="title class_">Login</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">btnId</span>: <span class="string">&#x27;qqLoginBtn&#x27;</span> <span class="comment">//插入按钮的节点id</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">data, opts</span>) =&gt;</span> &#123;</span><br><span class="line">      ......</span><br><span class="line">      <span class="comment">// 4. 完成跨页面传输</span></span><br><span class="line">      broadcast.<span class="title function_">send</span>(oauthObj)</span><br><span class="line">      <span class="comment">// 5. 在 PC 端下，关闭第三方窗口</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录按钮事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onQQLogin</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">openQQWindow</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理 QQ 登录视窗</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">openQQWindow</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">// 打开视窗之后开始等待</span></span><br><span class="line">  broadcast.<span class="title function_">wait</span>().<span class="title function_">then</span>(<span class="keyword">async</span> (oauthObj) =&gt; &#123;</span><br><span class="line">    broadcast.<span class="title function_">clear</span>() <span class="comment">// 登录成功,关闭通知</span></span><br><span class="line">    <span class="comment">// 执行登录操作</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h4 id="完成QQ登录流程"><a href="#完成QQ登录流程" class="headerlink" title="完成QQ登录流程"></a>完成QQ登录流程</h4><p>有了数据之后，接下来就可以认证当前用户是否已注册，从而判断是否需要进入注册页面</p>
<ol>
<li>创建<code>view/login-register/login/oauth.js</code>模块</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@/router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;@/libs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">LOGIN_TYPE_OAUTH_NO_REGISTER_CODE</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 第三方登录统一处理方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; oauthType 登录方式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; oauthData 第三方数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">oauthLogin</span> = <span class="keyword">async</span> (<span class="params">oauthType, oauthData</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> code = <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/login&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">loginType</span>: oauthType,</span><br><span class="line">    ...oauthData</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 返回  204 表示当前用户未注册，此时给用户一个提示，走注册页面</span></span><br><span class="line">  <span class="keyword">if</span> (code === <span class="variable constant_">LOGIN_TYPE_OAUTH_NO_REGISTER_CODE</span>) &#123;</span><br><span class="line">    <span class="title function_">message</span>(<span class="string">&#x27;success&#x27;</span>, <span class="string">`欢迎您 <span class="subst">$&#123;oauthData.nickname&#125;</span>，请创建您的账号`</span>, <span class="number">6000</span>)</span><br><span class="line">    <span class="comment">// 进入注册页面，同时携带当前的第三方数据和注册标记</span></span><br><span class="line">    router.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">      <span class="attr">query</span>: &#123;</span><br><span class="line">        <span class="attr">reqType</span>: oauthType,</span><br><span class="line">        ...oauthData</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 否则表示用户已注册，直接进入首页</span></span><br><span class="line">  router.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>constants/index.js</code>中定义未注册状态码常量、<code>QQ</code>登录方式</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录方式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">LOGIN_TYPE_OAUTH_NO_REGISTER_CODE</span> = <span class="number">204</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">LOGIN_TYPE_QQ</span> = <span class="string">&#x27;QQ&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>store/modules/user.js</code>判断是否需要扫码注册</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">LOGIN_TYPE_OAUTH_NO_REGISTER_CODE</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">actions</span>: &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">context, payload</span>) &#123;</span><br><span class="line">      ......</span><br><span class="line">      <span class="comment">// QQ 扫码登录，用户未注册</span></span><br><span class="line">      <span class="keyword">if</span> (data.<span class="property">code</span> === <span class="variable constant_">LOGIN_TYPE_OAUTH_NO_REGISTER_CODE</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> data.<span class="property">code</span></span><br><span class="line">      &#125;</span><br><span class="line">      ......</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/register/index.js</code>模块触发注册，携带第三方数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触发注册</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onRegister</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// 触发注册，携带第三方数据</span></span><br><span class="line">    <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/register&#x27;</span>, &#123;</span><br><span class="line">      ...payload,</span><br><span class="line">      ...route.<span class="property">query</span></span><br><span class="line">    &#125;)</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/qq-login.vue</code>执行登录操作</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">LOGIN_TYPE_QQ</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理 QQ 登录视窗</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">openQQWindow</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  .....</span><br><span class="line">  <span class="comment">// 打开视窗之后开始等待</span></span><br><span class="line">  broadcast.<span class="title function_">wait</span>().<span class="title function_">then</span>(<span class="keyword">async</span> (oauthObj) =&gt; &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="title function_">oauthLogin</span>(<span class="variable constant_">LOGIN_TYPE_QQ</span>, oauthObj) <span class="comment">// 执行登录操作</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="移动端QQ登录"><a href="#移动端QQ登录" class="headerlink" title="移动端QQ登录"></a>移动端QQ登录</h4><p>目前<code>QQ</code> 登录功能已经可以在<code>PC</code>端中正常使用了。但如果在移动端中进行访问，会出现一些问题，出现的原因是因为：</p>
<p>对于 移动端而言：通过移动端触发 <code>QQ</code> 登录会展示三个页面，原页面、<code>QQ</code> 吊起页面、回调页面。<br>并且移动端一个页面展示整屏内容，且无法直接通过<code>window.close()</code> 关闭。<br>所以在移动端中，需要在当前页面中，继续进行后续操作。</p>
<p>那么据此可以在：<code>view/login-register/login/qq-login.vue</code> 中执行以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">QC</span>.<span class="title class_">Login</span>(</span><br><span class="line">    ...</span><br><span class="line">    (data, opts) =&gt; &#123;</span><br><span class="line">      ......</span><br><span class="line">      <span class="comment">// 针对于 移动端而言：通过移动端触发 QQ 登录会展示三个页面，原页面、QQ 吊起页面、回调页面。并且移动端一个页面展示整屏内容，且无法直接通过 window.close() 关闭，所以在移动端中，我们需要在当前页面继续进行后续操作。</span></span><br><span class="line">      <span class="title function_">oauthLogin</span>(<span class="variable constant_">LOGIN_TYPE_QQ</span>, oauthObj)</span><br><span class="line">      <span class="comment">// 5. 在 PC 端下，关闭第三方窗口</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<p>但是此时需要注意，不可通过 <code>isMobileTerminal</code>来进行<code>PC</code> 端和移动端的区别判断，因为此时为 <strong>窗口模式</strong>，宽度将小于 1280。</p>
<p>如果需要进行此判断，那么可以改写<code>isMobileTerminal</code>方法为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否是移动端设备</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isMobileTerminal = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i</span>.<span class="title function_">test</span>(</span><br><span class="line">    navigator.<span class="property">userAgent</span></span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="微信开放平台注册"><a href="#微信开放平台注册" class="headerlink" title="微信开放平台注册"></a>微信开放平台注册</h4><p>对于微信扫码登录而言，同样需要进行开放平台的注册，微信开放平台的注册流程：</p>
<ol>
<li>微信公众平台与微信开放平台的区别</li>
<li>微信开放平台账户注册</li>
<li>微信开放平台应用注册</li>
<li>开发者资质认证</li>
</ol>
<p><strong>1、微信公众平台与微信开放平台的区别</strong></p>
<p><a target="_blank" rel="noopener" href="https://mp,weixin.gg.com/">微信公众平台</a></p>
<p>用于管理、开放微信公众号（包括订阅号、服务号、企业号），相当于微信公众号的后台运营、管理系统。</p>
<p><a target="_blank" rel="noopener" href="https://open,weixin.gg.com/">微信开放平台</a></p>
<p>主要面对移动应用、网站应用开发者，为其提供微信登录、分享、支付等相关权限和服务。</p>
<p><strong>2、微信开放平台账户注册</strong></p>
<p>登录微信开放平台</p>
<ol>
<li>进入 微信开放平台，点击账号注册（注意：此账号将同时应用到登录、分享、支付等微信第三方模块）</li>
<li>填写基本信息</li>
<li>登记主体信息 - 主体类型说明：<ol>
<li>主体信息常用的分为：<strong>企业</strong>和<strong>个人</strong></li>
<li>其中企业又分为：<strong>企业</strong>和<strong>个体工商户</strong></li>
<li>三者之前的区别如下图所示：</li>
</ol>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://izdloyl-blog.oss-cn-hangzhou.aliyuncs.com/202408191514591.jpeg" alt="photo"></p>
<p><strong>个人主体注册</strong></p>
<ol>
<li>登记主体信息</li>
<li>扫码进行身份验证</li>
<li>点击下一步、确认主体信息</li>
</ol>
<p><strong>企业主体注册</strong></p>
<ol>
<li>企业主体注册需要具备 <strong>企业营业执照信息</strong></li>
<li>验证方式分为两种：<ol>
<li>支付验证：免费，对公转账验证     √</li>
<li>微信认证：300元审核费用</li>
</ol>
</li>
<li>支付验证方式</li>
<li>扫码确认管理员信息</li>
<li>最后确认主体信息即可</li>
<li>企业用户最终还需要进行支付验证</li>
</ol>
<p><strong>3、微信开放平台应用注册</strong></p>
<ol>
<li>账户注册通过之后，可进入 <strong>管理中心</strong>，选择 <strong>网站应用</strong>，点击 <strong>创建网站应用</strong></li>
<li>创建网站应用共分为三步<ol>
<li>填写基本信息</li>
<li>填写网站信息</li>
<li>提交成功</li>
</ol>
</li>
<li>填写基本信息时，需要下载并填写《网站信息登记表扫描件》</li>
<li>点击下一步，进入 <strong>授权回调域</strong> 输入</li>
<li>点击提交审核</li>
<li>审核通过（可能会需要进行多次修改）</li>
</ol>
<p><strong>4、开发者资质认证</strong></p>
<p>应用审核通过之后，可以发现应用的 <strong>微信登录</strong> 与 <strong>微信支付</strong> 功能处于 <strong>未获得</strong> 状态如果想要获得，那么需要 <strong>申请开通</strong></p>
<ol>
<li>点击申请开通</li>
<li>此时需要先进行开发者认证</li>
<li>点击<strong>去认证</strong></li>
<li>此时会进入到 <strong>开发者资质认证页面</strong>，在此页面中可以看到，想要申请开发者认证，则需要交付300元 认证费用。PS：学习阶段暂无需支付此费用，只需要跟着视频，了解后续流程，等到工作中需要使用到时，由所在公司支付该费用。</li>
<li>如果你当前需要支付此费用，则点击 <strong>现在申请</strong></li>
<li>之后会进入 <strong>协议声明</strong> 页面，点击 <strong>下一步</strong></li>
<li>填写企业信息 - 企业资质信息、对公账户信息、认证联系人、联系人验证</li>
<li>点击下一步，填写发票信息，再点击下一步，确认发票信息，点击继续</li>
<li>支付审核费用，支付成功之后会得到对应的订单详情数据，同时会有对应的邮件通知，等待审核通过即可</li>
<li>等待审核的过程中会有 <strong>微信客服</strong> 与你电话联系，请注意接听（通常会在当天）。审核通过之后，状态会变为 <strong>已验证</strong></li>
<li>此时，返回应用详情，<strong>微信登录</strong> 为 <strong>已获得</strong> 状态，<strong>微信支付</strong> 为 <strong>未获得状态</strong></li>
</ol>
<h4 id="实现微信扫码登录"><a href="#实现微信扫码登录" class="headerlink" title="实现微信扫码登录"></a>实现微信扫码登录</h4><p>进入 微信登录对接官方文档<br>整个微信登录流程与 <code>QQ</code> 登录流程略有不同，分为以下几步：</p>
<ol>
<li><p>通过 <strong>微信登录前置数据获取</strong> 接口，获取登录数据（比如 <code>APP ID</code>）</p>
</li>
<li><p>根据获取到的数据，拼接得到 <code>open url</code> 地址</p>
</li>
<li><p>打开该地址，展示微信登录二维码</p>
</li>
<li><p>移动端微信扫码确定登录</p>
</li>
<li><p>从当前窗口中解析 <code>window.location.search</code> 得到用户的 <code>code</code> 数据</p>
</li>
<li><p>根据 <code>appId、appSecret、code</code> 通过接口获取用户的 <code>access_token</code></p>
</li>
<li><p>根据 <code>access_token</code> 获取用户信息</p>
</li>
<li><p>通过用户信息触发 <code>oauthLogin</code> 方法</p>
</li>
</ol>
<p>接下来就根据以上分析分析对应代码代码逻辑：</p>
<ol>
<li>创建<code>view/login-register/login/weixin-login.vue</code>组件，并写入以下<code>html</code></li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> @<span class="attr">click</span>=<span class="string">&quot;onWeiXinLogin&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">m-svg-icon</span> <span class="attr">class</span>=<span class="string">&quot;w-4 cursor-pointer&quot;</span> <span class="attr">name</span>=<span class="string">&quot;wexin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">m-svg-icon</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;login_container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在<code>view/login-register/login/index.vue</code> 中使用该组件</li>
<li>定义<strong>微信登录前置数据获取</strong>获取接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 微信登录前置数据获取</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getWXLoginData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/wxlogin/data&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>在 <code>onWeiXinLogin</code> 中，触发该接口，获取对应数据，并打开对应 <strong>微信登录窗口</strong>，然后等待登录成功的通知：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 触发微信登录</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onWeiXinLogin</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 1. 通过微信登录前置数据获取接口，获取登录数据</span></span><br><span class="line">  <span class="keyword">const</span> &#123; appId, appSecret, redirectUri, scope, state &#125; = <span class="keyword">await</span> <span class="title function_">getWXLoginData</span>()</span><br><span class="line">  <span class="comment">// 2. 根据获取到的数据，拼接得到 `open url` 地址</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">open</span>(</span><br><span class="line">    <span class="string">`https://open.weixin.qq.com/connect/qrconnect?appid=<span class="subst">$&#123;appId&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;redirectUri&#125;</span>&amp;response_type=code&amp;scope=<span class="subst">$&#123;scope&#125;</span>&amp;state=<span class="subst">$&#123;state&#125;</span>#wechat_redirect`</span>,</span><br><span class="line">    <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;height=525,width=585, toolbar=no, menubar=no, scrollbars=no, status=no, location=yes, resizable=yes&#x27;</span></span><br><span class="line">  )</span><br><span class="line">  <span class="comment">// 等待扫码登录成功通知</span></span><br><span class="line">  brodacast.<span class="title function_">wait</span>().<span class="title function_">then</span>(<span class="keyword">async</span> (&#123; code &#125;) =&gt; &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;微信扫码登录成功&#x27;)</span></span><br><span class="line">    <span class="comment">// console.log(code)</span></span><br><span class="line">    brodacast.<span class="title function_">clear</span>() <span class="comment">// 微信登录成功,关闭通知</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>从当前窗口中解析 <code>window.location.search</code> 得到用户的 <code>code</code> 数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 微信登录成功之后的窗口数据解析</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> code = <span class="regexp">/code=((.*))&amp;state/</span>.<span class="title function_">exec</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>)[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">if</span> (code) &#123;</span><br><span class="line">    brodacast.<span class="title function_">send</span>(&#123;</span><br><span class="line">      code</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">close</span>() <span class="comment">// 关闭回调网页</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>定义获取微信登录的 <code>access_token</code>接口和微信登录的 用户数据接口</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取微信登录的 access_token</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getWXLoginToken</span> = (<span class="params">appid, secret, code</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/wxlogin/access_token&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      appid,</span><br><span class="line">      secret,</span><br><span class="line">      code</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取微信登录的 用户数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getWXLoginUserInfo</span> = (<span class="params">accessToken, openid</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/sys/wxlogin/userinfo&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      accessToken,</span><br><span class="line">      openid</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>根据获取到的信息执行登录操作</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getWXLoginData, getWXLoginToken, getWXLoginUserInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/sys&#x27;</span></span><br><span class="line"><span class="keyword">import</span> brodacast <span class="keyword">from</span> <span class="string">&#x27;./brodacast&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; oauthLogin &#125; <span class="keyword">from</span> <span class="string">&#x27;./oauth&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">LOGIN_TYPE_WX</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发微信登录</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onWeiXinLogin</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 等待扫码登录成功通知</span></span><br><span class="line">  brodacast.<span class="title function_">wait</span>().<span class="title function_">then</span>(<span class="keyword">async</span> (&#123; code &#125;) =&gt; &#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// 获取 AccessToken 和 openid</span></span><br><span class="line">    <span class="keyword">const</span> &#123; access_token, openid &#125; = <span class="keyword">await</span> <span class="title function_">getWXLoginToken</span>(</span><br><span class="line">      appId,</span><br><span class="line">      appSecret,</span><br><span class="line">      code</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 获取登录用户信息</span></span><br><span class="line">    <span class="keyword">const</span> &#123; nickname, headimgurl &#125; = <span class="keyword">await</span> <span class="title function_">getWXLoginUserInfo</span>(</span><br><span class="line">      access_token,</span><br><span class="line">      openid</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 执行登录操作</span></span><br><span class="line">    <span class="title function_">oauthLogin</span>(<span class="variable constant_">LOGIN_TYPE_WX</span>, &#123;</span><br><span class="line">      openid,</span><br><span class="line">      nickname,</span><br><span class="line">      headimgurl</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此完成了 <code>QQ</code> 扫码登录，微信扫码登录、移动端下的<code>QQ</code>主动吊起登录。但是对于 移动端微信 而言，不能在普通的 <code>H5</code> 下吊起微信 <code>APP</code> 触发登录。<br>根据本章的内容可以发现，整个的第三方登录逻辑还是比较复杂的，特别是微信的第三方登录步骤更加繁琐。并且在调试的时候必须要在线上进行调试（<strong>测试环境</strong>），所以在企业开发时，需要有更大的耐心才可以。</p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>前中台解决方案项目（中）</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%AD%EF%BC%89/">http://www.izdloyl.cn/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%AD%EF%BC%89/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>IZDLOYL</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2024-08-19</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-08-26</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue3/">vue3</a></div><div class="post_share"><div class="social-share" data-image="https://source.fomal.cc/img/default_cover_8.webb" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/23/frontEnd-TypeScript/" title="TypeScript"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">TypeScript</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="前中台解决方案项目（下）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">前中台解决方案项目（下）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="前中台解决方案项目（下）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-19</div><div class="title">前中台解决方案项目（下）</div></div></a></div><div><a href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8A%EF%BC%89/" title="前中台解决方案项目（上）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_9.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-19</div><div class="title">前中台解决方案项目（上）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">IZDLOYL</div><div class="author-info__description">个人博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/IZDLOYL-G"><i class="fab fa-github"></i><span>🛴前往小家...</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/IZDLOYL-G" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1215472755@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #dfc600;"></i></a><a class="social-icon" href="https://res.abeim.cn/api/qq/?qq=1174008660" target="_blank" title="Weixin"><i class="fab fa-weixin" style="color: #48b700;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">welcome to my blog!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#26%E3%80%81%E5%AE%9E%E7%8E%B0%E5%85%A8%E5%B1%8F%E5%B1%95%E7%A4%BA%E5%8A%9F%E8%83%BD"><span class="toc-text">26、实现全屏展示功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27%E3%80%81floating%E5%9F%BA%E7%A1%80%E5%B8%83%E5%B1%80"><span class="toc-text">27、floating基础布局</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86scrollBar%E6%A0%B7%E5%BC%8F"><span class="toc-text">处理scrollBar样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%AB%99%E5%BC%95%E5%AF%BC%E5%8A%9F%E8%83%BD"><span class="toc-text">实现网站引导功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%BC%95%E5%AF%BC%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98"><span class="toc-text">处理引导样式问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#28%E3%80%81%E9%A6%96%E9%A1%B5%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%9B%BE%E7%89%87%E8%AF%A6%E6%83%85%E9%A1%B5"><span class="toc-text">28、首页跳转到图片详情页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VueRouter%E8%BF%87%E6%B8%A1%E5%8A%A8%E6%95%88%E5%88%86%E6%9E%90"><span class="toc-text">VueRouter过渡动效分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EGSAP%E5%AE%9E%E7%8E%B0"><span class="toc-text">基于GSAP实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#29%E3%80%81%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%AF%A6%E6%83%85%E9%A1%B5navbar"><span class="toc-text">29、移动端详情页navbar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BAnavbar"><span class="toc-text">构建navbar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E7%9A%84pins%E9%A1%B5%E9%9D%A2"><span class="toc-text">响应式的pins页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%88%B7%E6%96%B0%E7%A9%BA%E7%99%BD%E9%97%AE%E9%A2%98"><span class="toc-text">解决刷新空白问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#30%E3%80%81%E7%99%BB%E5%BD%95-%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97"><span class="toc-text">30、登录&#x2F;注册模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="toc-text">构建登录模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8vee-validate%E8%BF%9B%E8%A1%8C%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-text">使用vee-validate进行表单校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E7%B1%BB%E8%A1%8C%E4%B8%BA%E9%AA%8C%E8%AF%81%E8%AF%B4%E6%98%8E"><span class="toc-text">人类行为验证说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E7%B1%BB%E8%A1%8C%E4%B8%BA%E9%AA%8C%E8%AF%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">人类行为验证实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E8%A1%8C%E4%B8%BA"><span class="toc-text">处理用户登录行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-text">用户信息的获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-text">退出登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86token%E8%B6%85%E6%97%B6"><span class="toc-text">处理token超时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C"><span class="toc-text">用户注册</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#31%E3%80%81%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6v-input"><span class="toc-text">31、通用组件v-input</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-text">实现组件封装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32%E3%80%81%E7%94%A8%E6%88%B7%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99"><span class="toc-text">32、用户个人资料</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E6%A0%B7%E5%BC%8F"><span class="toc-text">构建基本样式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99"><span class="toc-text">修改个人资料</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E4%B8%8D%E4%BF%9D%E5%AD%98%E5%90%8C%E6%AD%A5%E9%97%AE%E9%A2%98"><span class="toc-text">处理不保存同步问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33%E3%80%81%E4%B8%AA%E4%BA%BA%E8%B5%84%E6%96%99%E5%A4%B4%E5%83%8F"><span class="toc-text">33、个人资料头像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6Dialog"><span class="toc-text">通用组件Dialog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8Dialog%E5%B1%95%E7%A4%BA%E5%A4%B4%E5%83%8F"><span class="toc-text">应用Dialog展示头像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A3%81%E5%89%AA%E5%A4%B4%E5%83%8F%E5%9B%BE%E7%89%87"><span class="toc-text">裁剪头像图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%85%BE%E8%AE%AF%E4%BA%91cos%E5%AD%98%E5%82%A8%E5%AF%B9%E8%B1%A1"><span class="toc-text">腾讯云cos存储对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91oss%E5%AD%98%E5%82%A8"><span class="toc-text">阿里云oss存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%89%B4%E6%9D%83"><span class="toc-text">登录鉴权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34%E3%80%81%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%B7%AF%E7%94%B1%E5%88%87%E6%8D%A2"><span class="toc-text">34、移动端路由切换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-trigger-menu"><span class="toc-text">通用组件  trigger-menu</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%BF%87%E6%B8%A1%E5%8A%A8%E6%95%88"><span class="toc-text">移动端过渡动效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6transition-router-view"><span class="toc-text">通用组件transition-router-view</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%BF%87%E6%B8%A1%E5%8A%A8%E7%94%BB%E5%B1%95%E7%A4%BA%E6%A0%B7%E5%BC%8F%E5%87%BA%E9%94%99"><span class="toc-text">处理过渡动画展示样式出错</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6%E8%99%9A%E6%8B%9F%E4%BB%BB%E5%8A%A1%E6%A0%88"><span class="toc-text">通用组件虚拟任务栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E9%A1%B5%E9%9D%A2%E6%BB%9A%E5%8A%A8%E4%BD%8D%E7%BD%AE"><span class="toc-text">记录页面滚动位置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#35%E3%80%81%E7%B2%BE%E9%80%89VIP%E6%9C%8D%E5%8A%A1"><span class="toc-text">35、精选VIP服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%A0%B7%E5%BC%8F%E6%9E%84%E5%BB%BA"><span class="toc-text">基础样式构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E7%BB%84%E4%BB%B6-%E5%80%92%E8%AE%A1%E6%97%B6"><span class="toc-text">通用组件 - 倒计时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VIP%E6%94%AF%E4%BB%98%E6%A8%A1%E5%9D%97"><span class="toc-text">VIP支付模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#36%E3%80%81%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95"><span class="toc-text">36、第三方登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QQ%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E6%B5%81%E7%A8%8B"><span class="toc-text">QQ开放平台流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96QQ%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-text">获取QQ用户信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E9%A1%B5%E9%9D%A2%E4%BF%A1%E6%81%AF%E4%BC%A0%E8%BE%93"><span class="toc-text">跨页面信息传输</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%88%90QQ%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B"><span class="toc-text">完成QQ登录流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AFQQ%E7%99%BB%E5%BD%95"><span class="toc-text">移动端QQ登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E4%BF%A1%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0%E6%B3%A8%E5%86%8C"><span class="toc-text">微信开放平台注册</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-text">实现微信扫码登录</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/23/frontEnd-nodejs/" title="node"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_2.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="node"/></a><div class="content"><a class="title" href="/2024/08/23/frontEnd-nodejs/" title="node">node</a><time datetime="2024-08-23T08:14:35.116Z" title="发表于 2024-08-23 16:14:35">2024-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/23/frontEnd-JavaScript/" title="JS基本语法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_10.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS基本语法"/></a><div class="content"><a class="title" href="/2024/08/23/frontEnd-JavaScript/" title="JS基本语法">JS基本语法</a><time datetime="2024-08-23T08:06:33.574Z" title="发表于 2024-08-23 16:06:33">2024-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/23/frontEnd-TypeScript/" title="TypeScript"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TypeScript"/></a><div class="content"><a class="title" href="/2024/08/23/frontEnd-TypeScript/" title="TypeScript">TypeScript</a><time datetime="2024-08-23T08:06:10.608Z" title="发表于 2024-08-23 16:06:10">2024-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%AD%EF%BC%89/" title="前中台解决方案项目（中）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前中台解决方案项目（中）"/></a><div class="content"><a class="title" href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%AD%EF%BC%89/" title="前中台解决方案项目（中）">前中台解决方案项目（中）</a><time datetime="2024-08-19T06:41:18.496Z" title="发表于 2024-08-19 14:41:18">2024-08-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="前中台解决方案项目（下）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前中台解决方案项目（下）"/></a><div class="content"><a class="title" href="/2024/08/19/project-%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="前中台解决方案项目（下）">前中台解决方案项目（下）</a><time datetime="2024-08-19T06:41:18.479Z" title="发表于 2024-08-19 14:41:18">2024-08-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By IZDLOYL</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hope you have a nice day!🍭🍭🍭</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/项目/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎮 IZDLOYLの项目 (4)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/算法/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🐱 IZDLOYLの算法笔记 (7)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/vue/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 IZDLOYLの编程学习 (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="http://www.izdloyl.cn/categories/面试/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">💡 IZDLOYLの面试总结 (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="http://www.izdloyl.cn/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #69e8f2}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/23/frontEnd-JavaScript/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_10.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="2024/08/23/frontEnd-JavaScript/" alt="">JS基本语法</a><div class="blog-slider__text">前端学习笔记</div><a class="blog-slider__button" href="2024/08/23/frontEnd-JavaScript/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/23/frontEnd-TypeScript/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="2024/08/23/frontEnd-TypeScript/" alt="">TypeScript</a><div class="blog-slider__text">前端学习笔记</div><a class="blog-slider__button" href="2024/08/23/frontEnd-TypeScript/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/01/frontEnd-vue3/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/wallpaper.jpg" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-01</span><a class="blog-slider__title" href="2024/08/01/frontEnd-vue3/" alt="">vue3</a><div class="blog-slider__text">vue3学习笔记</div><a class="blog-slider__button" href="2024/08/01/frontEnd-vue3/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/23/frontEnd-nodejs/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_2.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="2024/08/23/frontEnd-nodejs/" alt="">node</a><div class="blog-slider__text">前端学习笔记</div><a class="blog-slider__button" href="2024/08/23/frontEnd-nodejs/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/01/frontEnd-vue2/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_5.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-01</span><a class="blog-slider__title" href="2024/08/01/frontEnd-vue2/" alt="">vue2</a><div class="blog-slider__text">vue2学习笔记</div><a class="blog-slider__button" href="2024/08/01/frontEnd-vue2/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/02/algorithm-数组/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_8.webb" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-02</span><a class="blog-slider__title" href="2024/08/02/algorithm-数组/" alt="">数组篇</a><div class="blog-slider__text">代码随想录 - 数组篇</div><a class="blog-slider__button" href="2024/08/02/algorithm-数组/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/02/algorithm-hot100/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_6.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-02</span><a class="blog-slider__title" href="2024/08/02/algorithm-hot100/" alt="">hot100</a><div class="blog-slider__text">LeetCode - hot100</div><a class="blog-slider__button" href="2024/08/02/algorithm-hot100/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/08/02/algorithm-字符串/" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_6.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-02</span><a class="blog-slider__title" href="2024/08/02/algorithm-字符串/" alt="">字符串篇</a><div class="blog-slider__text">代码随想录 - 字符串篇</div><a class="blog-slider__button" href="2024/08/02/algorithm-字符串/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>